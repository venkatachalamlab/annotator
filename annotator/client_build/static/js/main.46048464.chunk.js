(this["webpackJsonpneuron-tracker"]=this["webpackJsonpneuron-tracker"]||[]).push([[0],{137:function(t,n,e){},149:function(t,n,e){"use strict";e.r(n);var r={};e.r(r),e.d(r,"get_state",(function(){return wt})),e.d(r,"get_x",(function(){return yt})),e.d(r,"get_y",(function(){return Ot})),e.d(r,"get_z",(function(){return Mt})),e.d(r,"get_c_idx",(function(){return kt})),e.d(r,"get_t_idx",(function(){return Tt})),e.d(r,"get_shape_x",(function(){return zt})),e.d(r,"get_shape_y",(function(){return Et})),e.d(r,"get_shape_z",(function(){return St})),e.d(r,"get_shape_t",(function(){return At})),e.d(r,"get_views",(function(){return Ct})),e.d(r,"get_scale_x",(function(){return Dt})),e.d(r,"get_scale_y",(function(){return Rt})),e.d(r,"get_scale_z",(function(){return Ut})),e.d(r,"get_LUT",(function(){return Lt})),e.d(r,"get_selected_annotation",(function(){return It})),e.d(r,"get_visible_worldlines",(function(){return Pt})),e.d(r,"get_selected_worldline",(function(){return Ft})),e.d(r,"get_active_provenance",(function(){return qt})),e.d(r,"get_fill_circles",(function(){return Nt})),e.d(r,"get_show_all_annotations",(function(){return Xt})),e.d(r,"get_rpc_list",(function(){return Bt})),e.d(r,"get_rpc_keybindings",(function(){return Vt})),e.d(r,"get_x_idx",(function(){return Wt})),e.d(r,"get_y_idx",(function(){return Yt})),e.d(r,"get_z_idx",(function(){return Ht})),e.d(r,"get_view",(function(){return Gt})),e.d(r,"get_x_url",(function(){return an})),e.d(r,"get_y_url",(function(){return on})),e.d(r,"get_z_url",(function(){return cn})),e.d(r,"get_vol_url",(function(){return sn}));var a={};e.r(a),e.d(a,"get_state",(function(){return un})),e.d(a,"get_worldlines",(function(){return ln})),e.d(a,"get_visible_worldlines",(function(){return dn}));var o={};e.r(o),e.d(o,"get_state",(function(){return _n})),e.d(o,"get_annotation_ids",(function(){return pn})),e.d(o,"get_used_worldline_ids",(function(){return bn})),e.d(o,"get_annotations_list",(function(){return vn})),e.d(o,"get_visible_annotations",(function(){return xn})),e.d(o,"get_selected_annotation_id",(function(){return mn})),e.d(o,"get_selected_annotation",(function(){return jn})),e.d(o,"get_annotations_view3D",(function(){return yn})),e.d(o,"get_x_annotations",(function(){return Mn})),e.d(o,"get_y_annotations",(function(){return kn})),e.d(o,"get_z_annotations",(function(){return Tn}));var i={};e.r(i),e.d(i,"create",(function(){return Sa})),e.d(i,"fromMat4",(function(){return Aa})),e.d(i,"clone",(function(){return Ca})),e.d(i,"copy",(function(){return Da})),e.d(i,"fromValues",(function(){return Ra})),e.d(i,"set",(function(){return Ua})),e.d(i,"identity",(function(){return La})),e.d(i,"transpose",(function(){return Ia})),e.d(i,"invert",(function(){return Pa})),e.d(i,"adjoint",(function(){return Fa})),e.d(i,"determinant",(function(){return qa})),e.d(i,"multiply",(function(){return Na})),e.d(i,"translate",(function(){return Xa})),e.d(i,"rotate",(function(){return Ba})),e.d(i,"scale",(function(){return Va})),e.d(i,"fromTranslation",(function(){return Wa})),e.d(i,"fromRotation",(function(){return Ya})),e.d(i,"fromScaling",(function(){return Ha})),e.d(i,"fromMat2d",(function(){return Ga})),e.d(i,"fromQuat",(function(){return Ka})),e.d(i,"normalFromMat4",(function(){return Ja})),e.d(i,"projection",(function(){return Qa})),e.d(i,"str",(function(){return Za})),e.d(i,"frob",(function(){return $a})),e.d(i,"add",(function(){return to})),e.d(i,"subtract",(function(){return no})),e.d(i,"multiplyScalar",(function(){return eo})),e.d(i,"multiplyScalarAndAdd",(function(){return ro})),e.d(i,"exactEquals",(function(){return ao})),e.d(i,"equals",(function(){return oo})),e.d(i,"mul",(function(){return io})),e.d(i,"sub",(function(){return co}));var c={};e.r(c),e.d(c,"create",(function(){return so})),e.d(c,"clone",(function(){return uo})),e.d(c,"copy",(function(){return lo})),e.d(c,"fromValues",(function(){return fo})),e.d(c,"set",(function(){return ho})),e.d(c,"identity",(function(){return _o})),e.d(c,"transpose",(function(){return po})),e.d(c,"invert",(function(){return bo})),e.d(c,"adjoint",(function(){return vo})),e.d(c,"determinant",(function(){return xo})),e.d(c,"multiply",(function(){return mo})),e.d(c,"translate",(function(){return jo})),e.d(c,"scale",(function(){return go})),e.d(c,"rotate",(function(){return wo})),e.d(c,"rotateX",(function(){return yo})),e.d(c,"rotateY",(function(){return Oo})),e.d(c,"rotateZ",(function(){return Mo})),e.d(c,"fromTranslation",(function(){return ko})),e.d(c,"fromScaling",(function(){return To})),e.d(c,"fromRotation",(function(){return zo})),e.d(c,"fromXRotation",(function(){return Eo})),e.d(c,"fromYRotation",(function(){return So})),e.d(c,"fromZRotation",(function(){return Ao})),e.d(c,"fromRotationTranslation",(function(){return Co})),e.d(c,"fromQuat2",(function(){return Do})),e.d(c,"getTranslation",(function(){return Ro})),e.d(c,"getScaling",(function(){return Uo})),e.d(c,"getRotation",(function(){return Lo})),e.d(c,"fromRotationTranslationScale",(function(){return Io})),e.d(c,"fromRotationTranslationScaleOrigin",(function(){return Po})),e.d(c,"fromQuat",(function(){return Fo})),e.d(c,"frustum",(function(){return qo})),e.d(c,"perspective",(function(){return No})),e.d(c,"perspectiveFromFieldOfView",(function(){return Xo})),e.d(c,"ortho",(function(){return Bo})),e.d(c,"lookAt",(function(){return Vo})),e.d(c,"targetTo",(function(){return Wo})),e.d(c,"str",(function(){return Yo})),e.d(c,"frob",(function(){return Ho})),e.d(c,"add",(function(){return Go})),e.d(c,"subtract",(function(){return Ko})),e.d(c,"multiplyScalar",(function(){return Jo})),e.d(c,"multiplyScalarAndAdd",(function(){return Qo})),e.d(c,"exactEquals",(function(){return Zo})),e.d(c,"equals",(function(){return $o})),e.d(c,"mul",(function(){return ti})),e.d(c,"sub",(function(){return ni}));var s={};e.r(s),e.d(s,"create",(function(){return ei})),e.d(s,"clone",(function(){return ri})),e.d(s,"length",(function(){return ai})),e.d(s,"fromValues",(function(){return oi})),e.d(s,"copy",(function(){return ii})),e.d(s,"set",(function(){return ci})),e.d(s,"add",(function(){return si})),e.d(s,"subtract",(function(){return ui})),e.d(s,"multiply",(function(){return li})),e.d(s,"divide",(function(){return di})),e.d(s,"ceil",(function(){return fi})),e.d(s,"floor",(function(){return hi})),e.d(s,"min",(function(){return _i})),e.d(s,"max",(function(){return pi})),e.d(s,"round",(function(){return bi})),e.d(s,"scale",(function(){return vi})),e.d(s,"scaleAndAdd",(function(){return xi})),e.d(s,"distance",(function(){return mi})),e.d(s,"squaredDistance",(function(){return ji})),e.d(s,"squaredLength",(function(){return gi})),e.d(s,"negate",(function(){return wi})),e.d(s,"inverse",(function(){return yi})),e.d(s,"normalize",(function(){return Oi})),e.d(s,"dot",(function(){return Mi})),e.d(s,"cross",(function(){return ki})),e.d(s,"lerp",(function(){return Ti})),e.d(s,"hermite",(function(){return zi})),e.d(s,"bezier",(function(){return Ei})),e.d(s,"random",(function(){return Si})),e.d(s,"transformMat4",(function(){return Ai})),e.d(s,"transformMat3",(function(){return Ci})),e.d(s,"transformQuat",(function(){return Di})),e.d(s,"rotateX",(function(){return Ri})),e.d(s,"rotateY",(function(){return Ui})),e.d(s,"rotateZ",(function(){return Li})),e.d(s,"angle",(function(){return Ii})),e.d(s,"zero",(function(){return Pi})),e.d(s,"str",(function(){return Fi})),e.d(s,"exactEquals",(function(){return qi})),e.d(s,"equals",(function(){return Ni})),e.d(s,"sub",(function(){return Xi})),e.d(s,"mul",(function(){return Bi})),e.d(s,"div",(function(){return Vi})),e.d(s,"dist",(function(){return Wi})),e.d(s,"sqrDist",(function(){return Yi})),e.d(s,"len",(function(){return Hi})),e.d(s,"sqrLen",(function(){return Gi})),e.d(s,"forEach",(function(){return Ki}));var u={};e.r(u),e.d(u,"create",(function(){return Ji})),e.d(u,"clone",(function(){return Qi})),e.d(u,"fromValues",(function(){return Zi})),e.d(u,"copy",(function(){return $i})),e.d(u,"set",(function(){return tc})),e.d(u,"add",(function(){return nc})),e.d(u,"subtract",(function(){return ec})),e.d(u,"multiply",(function(){return rc})),e.d(u,"divide",(function(){return ac})),e.d(u,"ceil",(function(){return oc})),e.d(u,"floor",(function(){return ic})),e.d(u,"min",(function(){return cc})),e.d(u,"max",(function(){return sc})),e.d(u,"round",(function(){return uc})),e.d(u,"scale",(function(){return lc})),e.d(u,"scaleAndAdd",(function(){return dc})),e.d(u,"distance",(function(){return fc})),e.d(u,"squaredDistance",(function(){return hc})),e.d(u,"length",(function(){return _c})),e.d(u,"squaredLength",(function(){return pc})),e.d(u,"negate",(function(){return bc})),e.d(u,"inverse",(function(){return vc})),e.d(u,"normalize",(function(){return xc})),e.d(u,"dot",(function(){return mc})),e.d(u,"cross",(function(){return jc})),e.d(u,"lerp",(function(){return gc})),e.d(u,"random",(function(){return wc})),e.d(u,"transformMat4",(function(){return yc})),e.d(u,"transformQuat",(function(){return Oc})),e.d(u,"zero",(function(){return Mc})),e.d(u,"str",(function(){return kc})),e.d(u,"exactEquals",(function(){return Tc})),e.d(u,"equals",(function(){return zc})),e.d(u,"sub",(function(){return Ec})),e.d(u,"mul",(function(){return Sc})),e.d(u,"div",(function(){return Ac})),e.d(u,"dist",(function(){return Cc})),e.d(u,"sqrDist",(function(){return Dc})),e.d(u,"len",(function(){return Rc})),e.d(u,"sqrLen",(function(){return Uc})),e.d(u,"forEach",(function(){return Lc}));var l={};e.r(l),e.d(l,"create",(function(){return Ic})),e.d(l,"identity",(function(){return Pc})),e.d(l,"setAxisAngle",(function(){return Fc})),e.d(l,"getAxisAngle",(function(){return qc})),e.d(l,"getAngle",(function(){return Nc})),e.d(l,"multiply",(function(){return Xc})),e.d(l,"rotateX",(function(){return Bc})),e.d(l,"rotateY",(function(){return Vc})),e.d(l,"rotateZ",(function(){return Wc})),e.d(l,"calculateW",(function(){return Yc})),e.d(l,"exp",(function(){return Hc})),e.d(l,"ln",(function(){return Gc})),e.d(l,"pow",(function(){return Kc})),e.d(l,"slerp",(function(){return Jc})),e.d(l,"random",(function(){return Qc})),e.d(l,"invert",(function(){return Zc})),e.d(l,"conjugate",(function(){return $c})),e.d(l,"fromMat3",(function(){return ts})),e.d(l,"fromEuler",(function(){return ns})),e.d(l,"str",(function(){return es})),e.d(l,"clone",(function(){return rs})),e.d(l,"fromValues",(function(){return as})),e.d(l,"copy",(function(){return os})),e.d(l,"set",(function(){return is})),e.d(l,"add",(function(){return cs})),e.d(l,"mul",(function(){return ss})),e.d(l,"scale",(function(){return us})),e.d(l,"dot",(function(){return ls})),e.d(l,"lerp",(function(){return ds})),e.d(l,"length",(function(){return fs})),e.d(l,"len",(function(){return hs})),e.d(l,"squaredLength",(function(){return _s})),e.d(l,"sqrLen",(function(){return ps})),e.d(l,"normalize",(function(){return bs})),e.d(l,"exactEquals",(function(){return vs})),e.d(l,"equals",(function(){return xs})),e.d(l,"rotationTo",(function(){return ms})),e.d(l,"sqlerp",(function(){return js})),e.d(l,"setAxes",(function(){return gs}));var d={};e.r(d),e.d(d,"create",(function(){return ws})),e.d(d,"clone",(function(){return ys})),e.d(d,"fromValues",(function(){return Os})),e.d(d,"copy",(function(){return Ms})),e.d(d,"set",(function(){return ks})),e.d(d,"add",(function(){return Ts})),e.d(d,"subtract",(function(){return zs})),e.d(d,"multiply",(function(){return Es})),e.d(d,"divide",(function(){return Ss})),e.d(d,"ceil",(function(){return As})),e.d(d,"floor",(function(){return Cs})),e.d(d,"min",(function(){return Ds})),e.d(d,"max",(function(){return Rs})),e.d(d,"round",(function(){return Us})),e.d(d,"scale",(function(){return Ls})),e.d(d,"scaleAndAdd",(function(){return Is})),e.d(d,"distance",(function(){return Ps})),e.d(d,"squaredDistance",(function(){return Fs})),e.d(d,"length",(function(){return qs})),e.d(d,"squaredLength",(function(){return Ns})),e.d(d,"negate",(function(){return Xs})),e.d(d,"inverse",(function(){return Bs})),e.d(d,"normalize",(function(){return Vs})),e.d(d,"dot",(function(){return Ws})),e.d(d,"cross",(function(){return Ys})),e.d(d,"lerp",(function(){return Hs})),e.d(d,"random",(function(){return Gs})),e.d(d,"transformMat2",(function(){return Ks})),e.d(d,"transformMat2d",(function(){return Js})),e.d(d,"transformMat3",(function(){return Qs})),e.d(d,"transformMat4",(function(){return Zs})),e.d(d,"rotate",(function(){return $s})),e.d(d,"angle",(function(){return tu})),e.d(d,"zero",(function(){return nu})),e.d(d,"str",(function(){return eu})),e.d(d,"exactEquals",(function(){return ru})),e.d(d,"equals",(function(){return au})),e.d(d,"len",(function(){return ou})),e.d(d,"sub",(function(){return iu})),e.d(d,"mul",(function(){return cu})),e.d(d,"div",(function(){return su})),e.d(d,"dist",(function(){return uu})),e.d(d,"sqrDist",(function(){return lu})),e.d(d,"sqrLen",(function(){return du})),e.d(d,"forEach",(function(){return fu}));var f=e(49),h=e(0),_=e.n(h),p=e(19),b=e.n(p),v=e(23),x=e(109),m=e(25),j=e(13),g=e(111),w=e(110),y=e(190),O=e(80),M=e(79),k=(e(137),{x:.5,y:.5,z:.5,c_idx:0,t_idx:0,shape_x:0,shape_y:0,shape_z:0,views:["slice","mip","vol"],shape_t:0,scale_x:1,scale_y:1,scale_z:1,LUT:{red:[0,150],green:[0,150],blue:[0,150]},selected_annotation:null,visible_worldlines:[],selected_worldline:null,active_provenance:"ANTT",fill_circles:!0,show_all_annotations:!1,rpc_list:[{name:"None found",default_args:"",docstring:""}],rpc_keybindings:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,0:0},rpc_args:{1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""}}),T=function(t,n,e){return Math.max(Math.min(t,e),0)},z={set_state:function(t,n){return n.payload},set_x:function(t,n){t.x=T(n.payload,0,1)},adjust_x:function(t,n){t.x=T(t.x+n.payload,0,1)},set_y:function(t,n){t.y=T(n.payload,0,1)},adjust_y:function(t,n){t.y=T(t.y+n.payload,0,1)},set_z:function(t,n){t.z=T(n.payload,0,1)},adjust_z:function(t,n){t.z=T(t.z+n.payload,0,1)},set_c_idx:function(t,n){t.c_idx=n.payload},adjust_c_idx:function(t,n){var e=t.c_idx+n.payload,r=t.views.length;t.c_idx=(e%r+r)%r},set_t_idx:function(t,n){t.t_idx=T(n.payload,0,t.shape_t-1)},set_scale_x:function(t,n){t.scale_x=n.payload},set_scale_y:function(t,n){t.scale_y=n.payload},set_scale_z:function(t,n){t.scale_z=n.payload},set_shape_x:function(t,n){t.shape_x=n.payload},set_shape_y:function(t,n){t.shape_y=n.payload},set_shape_z:function(t,n){t.shape_z=n.payload},set_LUT_color:function(t,n){t.LUT[n.payload[0]]=[n.payload[1],n.payload[2]]},set_selected_annotation_local:function(t,n){t.selected_annotation=n.payload},set_selected_worldline_local:function(t,n){t.selected_worldline=n.payload},set_active_provenance:function(t,n){t.active_provenance=n.payload},set_fill_circles:function(t,n){t.fill_circles=n.payload},toggle_fill_circles:function(t,n){t.fill_circles=!t.fill_circles},set_show_all_annotations:function(t,n){t.show_all_annotations=n.payload},toggle_all_annotations:function(t,n){t.show_all_annotations=!t.show_all_annotations},set_rpc_list:function(t,n){t.rpc_list=n.payload},set_rpc_keybinding:function(t,n){t.rpc_keybindings[n.payload[0]]=n.payload[1]},set_rpc_args:function(t,n){t.rpc_args=n.payload},set_rpc_arg:function(t,n){t.rpc_args[n.payload[0]]=n.payload[1]},center_on_annotation:function(t,n){t.x=Number(n.payload.x),t.y=Number(n.payload.y),t.z=Number(n.payload.z)}},E=Object(j.c)({name:"annotation_window",initialState:k,reducers:z}),S=E.actions,A=E.reducer,C=e(96),D=e(4),R=e.n(D),U=e(12),L=e(5),I=e(78),P=Symbol("newer"),F=Symbol("older");function q(t,n){"number"!==typeof t&&(n=t,t=0),this.size=0,this.limit=t,this.oldest=this.newest=void 0,this._keymap=new Map,n&&(this.assign(n),t<1&&(this.limit=this.size))}function N(t,n){this.key=t,this.value=n,this[P]=void 0,this[F]=void 0}function X(t){this.entry=t}function B(t){this.entry=t}function V(t){this.entry=t}q.prototype._markEntryAsUsed=function(t){t!==this.newest&&(t[P]&&(t===this.oldest&&(this.oldest=t[P]),t[P][F]=t[F]),t[F]&&(t[F][P]=t[P]),t[P]=void 0,t[F]=this.newest,this.newest&&(this.newest[P]=t),this.newest=t)},q.prototype.assign=function(t){var n,e=this.limit||Number.MAX_VALUE;this._keymap.clear();for(var r=t[Symbol.iterator](),a=r.next();!a.done;a=r.next()){var o=new N(a.value[0],a.value[1]);if(this._keymap.set(o.key,o),n?(n[P]=o,o[F]=n):this.oldest=o,n=o,0===e--)throw new Error("overflow")}this.newest=n,this.size=this._keymap.size},q.prototype.get=function(t){var n=this._keymap.get(t);if(n)return this._markEntryAsUsed(n),n.value},q.prototype.set=function(t,n){var e=this._keymap.get(t);return e?(e.value=n,this._markEntryAsUsed(e),this):(this._keymap.set(t,e=new N(t,n)),this.newest?(this.newest[P]=e,e[F]=this.newest):this.oldest=e,this.newest=e,++this.size,this.size>this.limit&&this.shift(),this)},q.prototype.shift=function(){var t=this.oldest;if(t)return this.oldest[P]?(this.oldest=this.oldest[P],this.oldest[F]=void 0):(this.oldest=void 0,this.newest=void 0),t[P]=t[F]=void 0,this._keymap.delete(t.key),--this.size,[t.key,t.value]},q.prototype.find=function(t){var n=this._keymap.get(t);return n?n.value:void 0},q.prototype.has=function(t){return this._keymap.has(t)},q.prototype.delete=function(t){var n=this._keymap.get(t);if(n)return this._keymap.delete(n.key),n[P]&&n[F]?(n[F][P]=n[P],n[P][F]=n[F]):n[P]?(n[P][F]=void 0,this.oldest=n[P]):n[F]?(n[F][P]=void 0,this.newest=n[F]):this.oldest=this.newest=void 0,this.size--,n.value},q.prototype.clear=function(){this.oldest=this.newest=void 0,this.size=0,this._keymap.clear()},X.prototype[Symbol.iterator]=function(){return this},X.prototype.next=function(){var t=this.entry;return t?(this.entry=t[P],{done:!1,value:[t.key,t.value]}):{done:!0,value:void 0}},B.prototype[Symbol.iterator]=function(){return this},B.prototype.next=function(){var t=this.entry;return t?(this.entry=t[P],{done:!1,value:t.key}):{done:!0,value:void 0}},V.prototype[Symbol.iterator]=function(){return this},V.prototype.next=function(){var t=this.entry;return t?(this.entry=t[P],{done:!1,value:t.value}):{done:!0,value:void 0}},q.prototype.keys=function(){return new B(this.oldest)},q.prototype.values=function(){return new V(this.oldest)},q.prototype.entries=function(){return this},q.prototype[Symbol.iterator]=function(){return new X(this.oldest)},q.prototype.forEach=function(t,n){"object"!==typeof n&&(n=this);for(var e=this.oldest;e;)t.call(n,e.value,e.key,this),e=e[P]},q.prototype.toJSON=function(){for(var t=new Array(this.size),n=0,e=this.oldest;e;)t[n++]={key:e.key,value:e.value},e=e[P];return t},q.prototype.toString=function(){for(var t="",n=this.oldest;n;)t+=String(n.key)+":"+n.value,(n=n[P])&&(t+=" < ");return t};var W=new q(5e3),Y=new q(1e3),H=function(){return fetch("/metadata").then((function(t){return t.json()}))};function G(t,n){return K.apply(this,arguments)}function K(){return(K=Object(I.a)(R.a.mark((function t(n,e){var r;return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!W.has(n)){t.next=4;break}if(void 0===(r=W.get(n))){t.next=4;break}return t.abrupt("return",r);case 4:return t.next=6,fetch(n,{signal:e}).then((function(t){return t.arrayBuffer()})).then((function(t){var e=new Uint8ClampedArray(t);return W.set(n,e),e})).catch((function(t){"AbortError"===t.name||console.error(t)}));case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var J=function(t){return fetch("/annotations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((function(t){return t.json()}))};function Q(t){if(Y.has(t)){var n=Y.get(t);if(void 0!==n)return n}}function Z(t,n){return $.apply(this,arguments)}function $(){return($=Object(I.a)(R.a.mark((function t(n,e){return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("/t/".concat(n,"/annotations"),{signal:e}).then((function(t){return t.json()})).then((function(t){return Y.set(n,t),t})).catch((function(t){"AbortError"===t.name||console.error(t)}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var tt=function(t){return fetch("/annotations/".concat(t.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((function(t){return t.json()}))},nt=function(t){return fetch("/annotations/".concat(t),{method:"DELETE"})},et=function(){return fetch("/worldlines",{method:"POST"}).then((function(t){return t.json()}))},rt=function(){return fetch("/worldlines",{method:"GET"}).then((function(t){return t.json()}))},at=function(t){return fetch("/worldlines/".concat(t.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((function(t){return t.json()}))},ot=function(t){return fetch("/worldlines/".concat(t),{method:"DELETE"})},it=function(){return fetch("/save",{method:"POST"}).then((function(t){return t.json()})).then((function(t){window.alert("Save successful: ".concat(t.path)),console.log("Saved to: ",t)})).catch((function(t){window.alert("Save failed. See console."),console.error("Error:",t)}))},ct=function(){return fetch("/load",{method:"POST"}).then((function(t){return t.json()})).then((function(t){window.alert("Load successful: ".concat(t.path))})).catch((function(t){window.alert("Load failed. See console."),console.error("Error:",t)}))},st=function(){return fetch("/rpc").then((function(t){return t.json()}))},ut=function(t,n,e){return fetch("/rpc",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({method:t,arg:n,state:e})}).then((function(t){return t.json()}))},lt=Object(j.c)({name:"annotations",initialState:{},reducers:{set_state:function(t,n){return n.payload},set_annotation_local:function(t,n){t[n.payload.id]=n.payload},delete_annotation_local:function(t,n){delete t[n.payload]}}}),dt=lt.actions,ft=lt.reducer,ht=Object(j.c)({name:"provenances",initialState:{},reducers:{set_state:function(t,n){return n.payload},set_provenance_selected:function(t,n){t[n.payload[0]].visible=n.payload[1]},set_all_selected:function(t,n){for(var e in t)t[e].visible=n.payload}}}),_t=ht.actions,pt=ht.reducer,bt=e(9),vt=e(31),xt=e.n(vt),mt=function(t){return t.annotations},jt=function(t,n){return Math.max(Math.floor(t*n-1e-6),0)},gt=function(t,n){return 255/(n[1]-n[0])*(t-n[0])},wt=function(t){return t.annotation_window},yt=Object(bt.a)(wt,(function(t){return t.x})),Ot=Object(bt.a)(wt,(function(t){return t.y})),Mt=Object(bt.a)(wt,(function(t){return t.z})),kt=Object(bt.a)(wt,(function(t){return t.c_idx})),Tt=Object(bt.a)(wt,(function(t){return t.t_idx})),zt=Object(bt.a)(wt,(function(t){return t.shape_x})),Et=Object(bt.a)(wt,(function(t){return t.shape_y})),St=Object(bt.a)(wt,(function(t){return t.shape_z})),At=Object(bt.a)(wt,(function(t){return t.shape_t})),Ct=Object(bt.a)(wt,(function(t){return t.views})),Dt=Object(bt.a)(wt,(function(t){return t.scale_x})),Rt=Object(bt.a)(wt,(function(t){return t.scale_y})),Ut=Object(bt.a)(wt,(function(t){return t.scale_z})),Lt=Object(bt.a)(wt,(function(t){return t.LUT})),It=Object(bt.a)(wt,(function(t){return t.selected_annotation})),Pt=Object(bt.a)(wt,(function(t){return t.visible_worldlines})),Ft=Object(bt.a)(wt,(function(t){return t.selected_worldline})),qt=Object(bt.a)(wt,(function(t){return t.active_provenance})),Nt=Object(bt.a)(wt,(function(t){return t.fill_circles})),Xt=Object(bt.a)(wt,(function(t){return t.show_all_annotations})),Bt=Object(bt.a)(wt,(function(t){return t.rpc_list})),Vt=Object(bt.a)(wt,(function(t){return t.rpc_keybindings})),Wt=Object(bt.a)([yt,zt],jt),Yt=Object(bt.a)([Ot,Et],jt),Ht=Object(bt.a)([Mt,St],jt),Gt=Object(bt.a)(Ct,kt,(function(t,n){return t[n]})),Kt=function(t){return Object(bt.a)(Gt,(function(n){switch(n){case"slice":return t;case"mip":return"mip_".concat(t);default:return t}}))},Jt=Kt("x"),Qt=Kt("y"),Zt=Kt("z"),$t=function(t,n){return Object(bt.a)(Gt,n,(function(t,n){switch(t){case"slice":return n;case"mip":return 0;default:return n}}))},tn=$t(0,Wt),nn=$t(0,Yt),en=$t(0,Ht),rn=function(t,n,e){return"/t/".concat(t,"/data/").concat(n,"/").concat(e)},an=Object(bt.a)(Tt,Jt,tn,rn),on=Object(bt.a)(Tt,Qt,nn,rn),cn=Object(bt.a)(Tt,Zt,en,rn),sn=Object(bt.a)(Tt,(function(t){return rn(t,"gvol",1)})),un=function(t){return t.worldlines},ln=Object(bt.a)(un,(function(t){return t.worldlines})),dn=Object(bt.a)(ln,(function(t){return Object.entries(t).filter((function(t){return t[1].visible})).map((function(t){return Number(t[0])}))})),fn=function(t){return t.provenances},hn=Object(bt.a)(fn,(function(t){return console.log(t),Object.entries(t).filter((function(t){return t[1].visible})).map((function(t){return t[1].id}))})),_n=mt,pn=Object(bt.a)(_n,xt.a.keys),bn=Object(bt.a)(_n,(function(t){return xt.a.values(xt.a.mapValues("worldline_id")(t))})),vn=Object(bt.a)(_n,(function(t){return Object.entries(t).map((function(t){return t[1]}))})),xn=Object(bt.a)(_n,dn,hn,(function(t,n,e){return xt.a.pickBy((function(t){return n.includes(t.worldline_id)&&e.includes(t.provenance)}))(t)})),mn=Object(bt.a)(_n,It,Ft,(function(t,n,e){return n&&n>0?n:e&&e>0?Number(xt.a.findKey({worldline_id:e})(t)):null})),jn=Object(bt.a)(_n,mn,(function(t,n){return n?t[n]:null})),gn=function(t,n){return n.color},wn=Object(bt.a)(xn,un,mn,(function(t,n,e){return xt.a.mapValues((function(t){var r,a=(r=t,n.worldlines[r.worldline_id]);return Object(U.a)(Object(U.a)({},t),{},{color:gn(0,a),selected:t.id===e})}))(t)})),yn=Object(bt.a)(wn,xt.a.mapValues(xt.a.pick(["id","x","y","z","color","selected"]))),On=function(t,n,e,r,a,o){var i=xt.a.pickBy((function(t){return o-Math.abs(t[n]-a)>0}))(t);return xt.a.mapValues((function(t){return{id:t.id,x:t[e],y:t[r],color:t.color,selected:t.selected,radius:4}}))(i)},Mn=Object(bt.a)(yn,yt,Xt,(function(t,n,e){return On(t,"x","z","y",n,e?2:.02)})),kn=Object(bt.a)(yn,Ot,Xt,(function(t,n,e){return On(t,"y","x","z",n,e?2:.02)})),Tn=Object(bt.a)(yn,Mt,Xt,(function(t,n,e){return On(t,"z","x","y",n,e?2:.07)})),zn=R.a.mark(Cn),En=R.a.mark(Dn),Sn={fetch_provenances:"provenances/fetch_provenances"},An={fetch_provenances:Object(j.b)(Sn.fetch_provenances)};function Cn(t){var n,e,r;return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(L.f)(vn);case 2:return n=t.sent,e=new Set(n.map((function(t){return t.provenance}))),r={},e.forEach((function(t){r[t]={id:t,visible:!0}})),t.next=8,Object(L.d)(_t.set_state(r));case 8:case"end":return t.stop()}}),zn)}function Dn(){return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(L.g)(Sn.fetch_provenances,Cn);case 2:case"end":return t.stop()}}),En)}var Rn=[Dn],Un=e(18),Ln=e(179),In=e(183),Pn=e(185),Fn=e(101),qn=e.n(Fn),Nn=e(184),Xn=e(2),Bn=function(t){return Object(Xn.jsxs)("div",{style:{float:"left",position:"relative",height:"30px",width:"100px"},children:[Object(Xn.jsx)("input",{type:"checkbox",checked:t.provenance.visible,onChange:function(n){return t.on_check(n.target.checked)},style:{float:"left",marginTop:"8px"}}),Object(Xn.jsx)("div",{style:{float:"left",fontFamily:"monospace",fontSize:"14px",color:"#C0C0C0",marginTop:"5px",border:"0px",width:"20px"},children:t.provenance.id})]})},Vn=Object(v.b)((function(t){return{state:fn(t)}}),(function(t){return{actions:Object(Un.b)(Object(U.a)({},_t),t),saga_actions:Object(Un.b)(Object(U.a)({},An),t),set_selected_worldline:Object(Un.b)(kr.set_selected_worldline,t)}}))((function(t){var n=Object.values(t.state).map((function(n){return Object(Xn.jsx)(Bn,{provenance:n,on_check:function(e){return t.actions.set_provenance_selected([n.id,e])}},n.id)}));return Object(Xn.jsx)(Ln.a,{elevation:3,variant:"outlined",square:!0,style:{position:"relative",top:"50px",width:"340px",height:"auto"},children:Object(Xn.jsxs)(In.a,{children:[Object(Xn.jsx)("h3",{children:"Provenances:"}),Object(Xn.jsx)(Nn.a,{color:"default",onClick:function(n){return t.actions.set_all_selected(!0)},style:{position:"absolute",left:"140px",top:"28px"},children:"all"}),Object(Xn.jsx)(Nn.a,{color:"default",onClick:function(n){return t.actions.set_all_selected(!1)},style:{position:"absolute",left:"190px",top:"28px"},children:"none"}),n||null,Object(Xn.jsx)(Pn.a,{"aria-label":"fetch",onClick:t.saga_actions.fetch_provenances,style:{position:"absolute",left:"250px",top:"25px"},children:Object(Xn.jsx)(qn.a,{fontSize:"small"})})]})})})),Wn=R.a.mark(ae),Yn=R.a.mark(oe),Hn=R.a.mark(ce),Gn=R.a.mark(se),Kn=R.a.mark(ue),Jn=R.a.mark(le),Qn=R.a.mark(de),Zn=R.a.mark(fe),$n=R.a.mark(he),te=R.a.mark(_e),ne=R.a.mark(pe),ee={insert_annotation:"annotations/insert_annotation",insert_annotation_here:"annotations/insert_annotation_here",get_annotations:"annotations/get_annotations",update_annotation:"annotations/update_annotation",delete_annotation:"annotations/delete_annotation"},re={insert_annotation:Object(j.b)(ee.insert_annotation),insert_annotation_here:Object(j.b)(ee.insert_annotation_here),get_annotations:Object(j.b)(ee.get_annotations),update_annotation:Object(j.b)(ee.update_annotation),delete_annotation:Object(j.b)(ee.delete_annotation)};function ae(t){var n;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(L.b)(J,t.payload);case 2:return n=e.sent,e.next=5,Object(L.d)(dt.set_annotation_local(n));case 5:return e.next=7,Object(L.d)(kr.set_selected_annotation(n.id));case 7:case"end":return e.stop()}}),Wn)}function oe(){var t,n,e,r,a,o,i,c,s,u;return R.a.wrap((function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,Object(L.f)();case 2:return t=l.sent,n=t.annotation_window,e=n.x,r=n.y,a=n.z,o=n.t_idx,i=n.selected_worldline,c=n.active_provenance,null===(s=i)&&(s=0),u={x:e,y:r,z:a,t_idx:o,worldline_id:s,provenance:c},l.next=9,Object(L.d)(re.insert_annotation(u));case 9:case"end":return l.stop()}}),Yn)}var ie=new AbortController;function ce(t){var n,e,r,a;return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(L.f)(Tt);case 2:return n=t.sent,t.next=5,Object(L.b)(Q,n);case 5:if(void 0===(e=t.sent)){t.next=9;break}return t.next=9,Object(L.d)(dt.set_state(e));case 9:return ie.abort(),ie=new AbortController,t.next=13,Object(L.b)(Z,n,ie.signal);case 13:return r=t.sent,t.next=16,Object(L.d)(dt.set_state(r));case 16:return t.next=18,Object(L.d)(S.set_selected_annotation_local(null));case 18:return t.next=20,Object(L.f)(jn);case 20:if(!(a=t.sent)){t.next=24;break}return t.next=24,Object(L.d)(S.center_on_annotation(a));case 24:return t.next=26,Object(L.d)(An.fetch_provenances());case 26:case"end":return t.stop()}}),Hn)}function se(t){var n;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(L.b)(tt,t.payload);case 2:return n=e.sent,e.next=5,Object(L.d)(dt.set_annotation_local(n));case 5:return e.next=7,Object(L.d)(kr.set_selected_annotation(n.id));case 7:case"end":return e.stop()}}),Gn)}function ue(t){var n;return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(L.f)(mn);case 2:return n=t.sent,t.next=5,Object(L.b)(nt,n);case 5:if(!t.sent.ok){t.next=11;break}return t.next=9,Object(L.d)(dt.delete_annotation_local(n));case 9:return t.next=11,Object(L.d)(S.set_selected_annotation_local(null));case 11:case"end":return t.stop()}}),Kn)}function le(){return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(L.g)(ee.insert_annotation,ae);case 2:case"end":return t.stop()}}),Jn)}function de(){return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(L.g)(ee.insert_annotation_here,oe);case 2:case"end":return t.stop()}}),Qn)}function fe(){return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(L.h)(ee.get_annotations,ce);case 2:case"end":return t.stop()}}),Zn)}function he(){return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(L.h)("annotation_window/set_t_idx",ce);case 2:case"end":return t.stop()}}),$n)}function _e(){return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(L.g)(ee.update_annotation,se);case 2:case"end":return t.stop()}}),te)}function pe(){return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(L.g)(ee.delete_annotation,ue);case 2:case"end":return t.stop()}}),ne)}var be=[le,de,fe,he,_e,pe],ve=function(t){var n=Object.entries(t.annotations).map((function(n){return function(t){return Object(Xn.jsx)("circle",{cx:t.x*t.size_x,cy:t.y*t.size_y,r:t.selected?2*t.radius:t.radius,stroke:t.fill_circles?"white":t.color,strokeWidth:"1",fill:t.fill_circles?t.color:"none",onClick:function(n){t.selected?t.deselect(t.id):t.select(t.id),n.preventDefault(),n.stopPropagation()},onDoubleClick:function(t){t.preventDefault(),t.stopPropagation()}},t.id)}(Object(U.a)(Object(U.a)({},n[1]),{},{size_x:t.size_x,size_y:t.size_y,select:t.select,deselect:t.deselect,fill_circles:t.fill_circles}))}));return Object(Xn.jsxs)("g",{children:[" ",n," "]})},xe=e(41),me=e(34),je=e(193),ge=e(103),we=e.n(ge),ye=e(102),Oe=e.n(ye),Me=Object(v.b)((function(t){return{annotation:jn(t)}}),(function(t){return{saga_actions:Object(Un.b)(Object(U.a)({},re),t)}}))((function(t){var n=_.a.useState(t.annotation),e=Object(me.a)(n,2),r=e[0],a=e[1];_.a.useEffect((function(){a(t.annotation)}),[t.annotation]);var o=[Object(Xn.jsx)("div",{style:{position:"absolute"},children:"select an annotation"},"null")];if(null!=r){var i=function(t,n){var e=t;return Object(Xn.jsx)(je.a,{type:"string",label:n,value:null!==r[e]?r[e]:"",onChange:function(t){return function(t,n){var e=Object(U.a)(Object(U.a)({},r),{},Object(xe.a)({},t,n));console.log(t,n,e),a(e)}(e,t.target.value)},style:{position:"relative",width:"100px",height:"30px",margin:"10px"},InputProps:{style:{fontFamily:"monospace"}}},e)};o=[["x","x"],["y","y"],["z","z"],["t_idx","t"],["id","id"],["worldline_id","track"],["parent_id","parent_id"],["provenance","provenance"]].map((function(t){return i(t[0],t[1])}))}return Object(Xn.jsx)(Ln.a,{elevation:3,variant:"outlined",square:!0,style:{position:"relative",width:"340px",height:"300px",top:"20px"},children:Object(Xn.jsxs)(In.a,{children:[Object(Xn.jsx)("h3",{children:"Annotation"}),Object(Xn.jsx)(Pn.a,{"aria-label":"done",onClick:function(){return t.saga_actions.update_annotation(r)},style:{position:"absolute",left:"230px",top:"20px"},children:Object(Xn.jsx)(Oe.a,{fontSize:"small"})}),Object(Xn.jsx)(Pn.a,{"aria-label":"delete",onClick:t.saga_actions.delete_annotation,style:{position:"absolute",left:"280px",top:"20px"},children:Object(Xn.jsx)(we.a,{fontSize:"small"})}),o]})})})),ke={set_state:function(t,n){return n.payload},set_worldlines_local:function(t,n){t.worldlines=n.payload},set_worldline_lists_local:function(t,n){t.worldline_lists=n.payload,t.selected_lists=[]},set_worldline_local:function(t,n){t.worldlines[n.payload.id]=n.payload},update_worldline_local:function(t,n){void 0!==n.payload.id&&(t.worldlines[n.payload.id]=Object(U.a)(Object(U.a)({},t.worldlines[n.payload.id]),n.payload))},delete_worldline_local:function(t,n){delete t.worldlines[n.payload]}},Te=Object(j.c)({name:"worldlines",initialState:{worldlines:{},worldline_lists:null,selected_lists:[]},reducers:ke}),ze=Te.actions,Ee=Te.reducer,Se=R.a.mark(Xe),Ae=R.a.mark(Be),Ce=R.a.mark(Ve),De=R.a.mark(We),Re=R.a.mark(Ye),Ue=R.a.mark(He),Le=R.a.mark(Ge),Ie=R.a.mark(Ke),Pe=R.a.mark(Je),Fe=R.a.mark(Qe),qe={create_worldline:"worldlines/create_worldline",get_worldlines:"worldlines/get_worldlines",update_worldline:"worldlines/update_worldline",delete_worldline:"worldlines/delete_worldline",set_all_visible:"worldlines/set_all_visible"},Ne={create_worldline:Object(j.b)(qe.create_worldline),get_worldlines:Object(j.b)(qe.get_worldlines),update_worldline:Object(j.b)(qe.update_worldline),delete_worldline:Object(j.b)(qe.delete_worldline),set_all_visible:Object(j.b)(qe.set_all_visible)};function Xe(t){var n,e;return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(L.b)(et);case 2:return n=t.sent,e=Object(U.a)(Object(U.a)({},n),{},{visible:!0}),t.next=6,Object(L.d)(ze.set_worldline_local(e));case 6:case"end":return t.stop()}}),Se)}function Be(t){var n,e,r,a,o;return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(L.b)(rt);case 2:for(n=t.sent,e={},r=0,a=Object.values(n);r<a.length;r++)o=a[r],e[Number(o.id)]={id:Number(o.id),name:String(o.name),color:String(o.color),visible:!0};return t.next=7,Object(L.d)(ze.set_worldlines_local(e));case 7:case"end":return t.stop()}}),Ae)}function Ve(t){var n;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(L.b)(at,t.payload);case 2:return n=e.sent,e.next=5,Object(L.d)(ze.update_worldline_local(n));case 5:case"end":return e.stop()}}),Ce)}function We(t){var n;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(L.b)(ot,t.payload);case 2:if(!((n=e.sent)>=0)){e.next=6;break}return e.next=6,Object(L.d)(ze.delete_worldline_local(n));case 6:case"end":return e.stop()}}),De)}function Ye(t){var n,e;return R.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Object(L.f)(ln);case 2:return n=r.sent,e=xt.a.mapValues((function(n){return Object(U.a)(Object(U.a)({},n),{},{visible:t.payload})}))(n),r.next=6,Object(L.d)(ze.set_worldlines_local(e));case 6:case"end":return r.stop()}}),Re)}function He(){return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(L.g)(qe.create_worldline,Xe);case 2:case"end":return t.stop()}}),Ue)}function Ge(){return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(L.g)(qe.get_worldlines,Be);case 2:case"end":return t.stop()}}),Le)}function Ke(){return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(L.g)(qe.update_worldline,Ve);case 2:case"end":return t.stop()}}),Ie)}function Je(){return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(L.g)(qe.delete_worldline,We);case 2:case"end":return t.stop()}}),Pe)}function Qe(){return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(L.g)(qe.set_all_visible,Ye);case 2:case"end":return t.stop()}}),Fe)}var Ze=[He,Ge,Ke,Je,Qe],$e=e(104),tr=e.n($e),nr=function(t){var n=function(t){var n=t.worldline.name;return n&&"null"!==n?n:String(t.worldline.id)},e=Object(h.useState)(n(t)),r=Object(me.a)(e,2),a=r[0],o=r[1];return _.a.useEffect((function(){o(n(t))}),[t]),Object(Xn.jsxs)("div",{style:{float:"left",position:"relative",height:"30px",width:"100px"},children:[Object(Xn.jsx)("input",{type:"checkbox",checked:t.worldline.visible,onChange:function(n){return t.on_check(n.target.checked)},style:{float:"left",marginTop:"8px"}}),Object(Xn.jsx)("div",{style:{float:"left",fontFamily:"monospace",fontSize:"10px",color:"#C0C0C0",marginTop:"8px",border:"0px",width:"20px"},children:t.worldline.id}),Object(Xn.jsx)("input",{type:"text",onBlur:function(n){return t.on_rename(n.target.value)},onChange:function(t){return o(t.target.value)},value:a,style:{float:"left",marginTop:"5px",fontFamily:"monospace",color:"white",backgroundColor:"#666",border:"0px",width:"40px"}}),Object(Xn.jsx)("div",{style:{backgroundColor:t.worldline.color,float:"left",marginTop:"5px",border:"0px",padding:"0px",width:"16px",height:"18px"},children:Object(Xn.jsx)("input",{type:"color",value:t.worldline.color,onChange:function(n){return t.on_recolor(n.target.value)},style:{float:"left",opacity:"0",marginTop:"5px",border:"0px",padding:"0px",width:"16px",height:"16px"}})})]})},er=Object(v.b)((function(t){return{state:un(t)}}),(function(t){return{actions:Object(Un.b)(Object(U.a)({},ze),t),saga_actions:Object(Un.b)(Object(U.a)({},Ne),t),set_selected_worldline:Object(Un.b)(kr.set_selected_worldline,t)}}))((function(t){var n=Object.values(t.state.worldlines).map((function(n){return Object(Xn.jsx)(nr,{worldline:n,on_check:function(e){t.actions.update_worldline_local({id:n.id,visible:e}),e&&t.set_selected_worldline(n.id)},on_rename:function(e){return t.saga_actions.update_worldline({id:n.id,name:e})},on_recolor:function(e){return t.saga_actions.update_worldline({id:n.id,color:e})}},n.id)}));return Object(Xn.jsx)(Ln.a,{elevation:3,variant:"outlined",square:!0,style:{position:"relative",top:"90px",width:"340px",height:"auto"},children:Object(Xn.jsxs)(In.a,{children:[Object(Xn.jsx)("h3",{children:"Tracks:"}),Object(Xn.jsx)(Nn.a,{color:"default",onClick:function(n){return t.saga_actions.set_all_visible(!0)},style:{position:"absolute",left:"90px",top:"28px"},children:"all"}),Object(Xn.jsx)(Nn.a,{color:"default",onClick:function(n){return t.saga_actions.set_all_visible(!1)},style:{position:"absolute",left:"160px",top:"28px"},children:"none"}),n,Object(Xn.jsx)(Pn.a,{"aria-label":"add",onClick:function(){return t.saga_actions.create_worldline()},style:{position:"absolute",left:"220px",top:"25px"},children:Object(Xn.jsx)(tr.a,{fontSize:"small"})})]})})})),rr=R.a.mark(Tr),ar=R.a.mark(zr),or=R.a.mark(Er),ir=R.a.mark(Sr),cr=R.a.mark(Ar),sr=R.a.mark(Cr),ur=R.a.mark(Dr),lr=R.a.mark(Rr),dr=R.a.mark(Ur),fr=R.a.mark(Lr),hr=R.a.mark(Ir),_r=R.a.mark(Pr),pr=R.a.mark(Fr),br=R.a.mark(qr),vr=R.a.mark(Nr),xr=R.a.mark(Xr),mr=R.a.mark(Br),jr=R.a.mark(Vr),gr=R.a.mark(Wr),wr=R.a.mark(Yr),yr=R.a.mark(Hr),Or=R.a.mark(Gr),Mr={fetch_state:"annotation_window/fetch_state",set_selected_annotation:"annotation_window/set_selected_annotation",set_selected_worldline:"annotation_window/set_selected_worldline",center_on_current_annotation:"annotation_window/center_on_current_annotation",adjust_t:"annotation_window/adjust_t",click:"annotation_window/click",doubleclick:"annotation_window/doubleclick",save:"annotation_window/save",load:"annotation_window/load",rpc:"annotation_window/rpc",rpc_from_key:"annotation_window/rpc_from_key"},kr={fetch_state:Object(j.b)(Mr.fetch_state),set_selected_annotation:Object(j.b)(Mr.set_selected_annotation),set_selected_worldline:Object(j.b)(Mr.set_selected_worldline),center_on_current_annotation:Object(j.b)(Mr.center_on_current_annotation),adjust_t:Object(j.b)(Mr.adjust_t),click:Object(j.b)(Mr.click),doubleclick:Object(j.b)(Mr.doubleclick),save:Object(j.b)(Mr.save),load:Object(j.b)(Mr.load),rpc:Object(j.b)(Mr.rpc),rpc_from_key:Object(j.b)(Mr.rpc_from_key)};function Tr(){var t,n,e;return R.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Object(L.b)(H);case 2:return t=r.sent,r.next=5,Object(L.b)(st);case 5:return n=r.sent,e=Object(U.a)(Object(U.a)({},k),{},{shape_x:t.shape_x,shape_y:t.shape_y,shape_z:t.shape_z,shape_t:t.shape_t,scale_x:700/t.shape_x,scale_y:700/t.shape_x,scale_z:120/t.shape_z,rpc_list:n.payload}),r.next=9,Object(L.d)(S.set_state(e));case 9:case"end":return r.stop()}}),rr)}function zr(t){var n,e;return R.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.payload){r.next=7;break}return r.next=3,Object(L.d)(S.set_selected_annotation_local(null));case 3:return r.next=5,Object(L.d)(S.set_selected_worldline_local(null));case 5:r.next=21;break;case 7:return r.next=9,Object(L.f)(mt);case 9:if(n=r.sent,void 0!==(e=n[t.payload])){r.next=14;break}return console.error("Annotation ".concat(t.payload," not found.")),r.abrupt("return");case 14:return r.next=16,Object(L.d)(S.set_selected_annotation_local(e.id));case 16:if(!(e.worldline_id>0)){r.next=19;break}return r.next=19,Object(L.d)(S.set_selected_worldline_local(e.worldline_id));case 19:return r.next=21,Object(L.d)(kr.center_on_current_annotation());case 21:case"end":return r.stop()}}),ar)}function Er(t){var n;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(n=t.payload)){e.next=5;break}return e.next=4,Object(L.d)(S.set_selected_worldline_local(null));case 4:return e.abrupt("return");case 5:return e.next=7,Object(L.f)(a.get_worldlines);case 7:if(e.sent[n]){e.next=11;break}return window.alert("Bad track: ".concat(n,". Please select an existing one or ")+"create a new one."),e.abrupt("return");case 11:return e.next=13,Object(L.d)(S.set_selected_worldline_local(n));case 13:return e.next=15,Object(L.d)(S.set_selected_annotation_local(null));case 15:if(null===n){e.next=18;break}return e.next=18,Object(L.d)(ze.update_worldline_local({id:n,visible:!0}));case 18:return e.next=20,Object(L.d)(kr.center_on_current_annotation());case 20:case"end":return e.stop()}}),or)}function Sr(){var t;return R.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(L.f)(o.get_selected_annotation);case 2:if(null===(t=n.sent)||void 0===t){n.next=6;break}return n.next=6,Object(L.d)(S.center_on_annotation(t));case 6:case"end":return n.stop()}}),ir)}function Ar(t){var n;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(L.f)(r.get_t_idx);case 2:return n=e.sent,e.next=5,Object(L.d)(S.set_t_idx(n+t.payload));case 5:case"end":return e.stop()}}),cr)}function Cr(t){return R.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.payload.x){n.next=3;break}return n.next=3,Object(L.d)(S.set_x(t.payload.x));case 3:if(!t.payload.y){n.next=6;break}return n.next=6,Object(L.d)(S.set_y(t.payload.y));case 6:if(!t.payload.z){n.next=9;break}return n.next=9,Object(L.d)(S.set_z(t.payload.z));case 9:case"end":return n.stop()}}),sr)}function Dr(t){return R.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(L.d)(kr.click(t.payload));case 2:return n.next=4,Object(L.d)(re.insert_annotation_here());case 4:case"end":return n.stop()}}),ur)}function Rr(){return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(L.b)(it);case 2:case"end":return t.stop()}}),lr)}function Ur(){return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(L.b)(ct);case 2:return t.next=4,Object(L.d)(re.get_annotations());case 4:return t.next=6,Object(L.d)(Ne.get_worldlines());case 6:case"end":return t.stop()}}),dr)}function Lr(t){var n,e,a,o,i,c,s,u,l;return R.a.wrap((function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,Object(L.f)(r.get_state);case 2:return n=d.sent,e=n.rpc_list[t.payload[0]],a=e.name,o=t.payload[1],d.next=8,Object(L.b)(ut,a,o,n);case 8:if(i=d.sent,console.log(i),"ok"!==i.status){d.next=34;break}c=Object(C.a)(i.callbacks),d.prev=12,c.s();case 14:if((s=c.n()).done){d.next=24;break}return u=s.value,l=parseInt(u.payload),String(l)===u.payload&&(u.payload=l),d.next=20,Object(L.e)(u);case 20:return d.next=22,Object(L.c)(100);case 22:d.next=14;break;case 24:d.next=29;break;case 26:d.prev=26,d.t0=d.catch(12),c.e(d.t0);case 29:return d.prev=29,c.f(),d.finish(29);case 32:d.next=35;break;case 34:"error"===i.status&&(window.alert(i.exception),console.error(i.traceback));case 35:case"end":return d.stop()}}),fr,null,[[12,26,29,32]])}function Ir(t){var n,e,a;return R.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,Object(L.f)(r.get_state);case 2:return n=o.sent,e=n.rpc_keybindings[t.payload],a=n.rpc_args[t.payload],o.next=7,Object(L.d)(kr.rpc([e,a]));case 7:case"end":return o.stop()}}),hr)}function Pr(){return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(L.h)(Mr.fetch_state,Tr);case 2:case"end":return t.stop()}}),_r)}function Fr(){return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(L.h)(Mr.set_selected_annotation,zr);case 2:case"end":return t.stop()}}),pr)}function qr(){return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(L.h)(Mr.set_selected_worldline,Er);case 2:case"end":return t.stop()}}),br)}function Nr(){return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(L.h)(Mr.center_on_current_annotation,Sr);case 2:case"end":return t.stop()}}),vr)}function Xr(){return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(L.h)(Mr.adjust_t,Ar);case 2:case"end":return t.stop()}}),xr)}function Br(){return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(L.h)(Mr.click,Cr);case 2:case"end":return t.stop()}}),mr)}function Vr(){return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(L.h)(Mr.doubleclick,Dr);case 2:case"end":return t.stop()}}),jr)}function Wr(){return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(L.h)(Mr.save,Rr);case 2:case"end":return t.stop()}}),gr)}function Yr(){return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(L.h)(Mr.load,Ur);case 2:case"end":return t.stop()}}),wr)}function Hr(){return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(L.g)(Mr.rpc,Lr);case 2:case"end":return t.stop()}}),yr)}function Gr(){return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(L.g)(Mr.rpc_from_key,Ir);case 2:case"end":return t.stop()}}),Or)}var Kr=[Pr,Fr,qr,Nr,Xr,Br,Vr,Wr,Yr,Hr,Gr],Jr=e(77),Qr=e(56),Zr=e(57),$r=e(67),ta=e(59),na=e(58),ea=function(t){Object(ta.a)(e,t);var n=Object(na.a)(e);function e(t){var r;return Object(Qr.a)(this,e),(r=n.call(this,t)).state={value:"0"},r.handleChange=r.handleChange.bind(Object($r.a)(r)),r.handleSubmit=r.handleSubmit.bind(Object($r.a)(r)),r}return Object(Zr.a)(e,[{key:"handleChange",value:function(t){this.setState({value:t.target.value})}},{key:"handleSubmit",value:function(t){this.props.action(this.props.input_parser(this.state.value)),t.preventDefault()}},{key:"render",value:function(){return Object(Xn.jsxs)("form",{onSubmit:this.handleSubmit,children:[Object(Xn.jsx)("input",{type:"submit",value:this.props.name}),Object(Xn.jsx)("input",{type:"text",defaultValue:this.state.value,onChange:this.handleChange})]})}}]),e}(_.a.Component),ra=function(t){return Object(Xn.jsx)(ea,Object(U.a)(Object(U.a)({},t),{},{input_parser:parseFloat}))},aa=(Object(v.b)((function(t){return{state:wt(t),x_idx:Wt(t)}}),Object(U.a)(Object(U.a)({},S),kr))((function(t){var n=t.state,e=t.x_idx,r=Object(Jr.a)(t,["state","x_idx"]),a={bare_state:n,derived_state:{x_idx:e}},o=JSON.stringify(a,null,4);return Object(Xn.jsxs)("div",{children:[Object(Xn.jsx)("pre",{children:Object(Xn.jsxs)("code",{children:["annotation_window: ",o]})}),Object(Xn.jsx)("br",{}),"Simple Actions:",Object(Xn.jsx)(ra,{name:"set_shape_x",action:r.set_shape_x}),Object(Xn.jsx)(ra,{name:"set_x",action:r.set_x}),Object(Xn.jsx)(ra,{name:"adjust_x",action:r.adjust_x}),Object(Xn.jsx)(ra,{name:"set_scale_x",action:r.set_scale_x}),Object(Xn.jsx)("br",{}),"Async Actions:",Object(Xn.jsx)("br",{}),Object(Xn.jsx)("button",{onClick:function(){return r.fetch_state()},children:"fetch_state"})]})})),e(198)),oa=function(t){return{select:function(n){return t(kr.set_selected_annotation(n))},deselect:function(){return t(kr.set_selected_annotation(null))},click:function(n){return t(kr.click(n))},doubleclick:function(n){return t(kr.doubleclick(n))}}},ia=Object(v.b)((function(t){return{height:r.get_shape_y(t),width:r.get_shape_z(t),height_scale:r.get_scale_y(t),width_scale:r.get_scale_z(t),data_url:r.get_x_url(t),x:r.get_z(t),y:r.get_y(t),x_dim:"z",y_dim:"y",annotations:o.get_x_annotations(t),fill_circles:r.get_fill_circles(t),LUT:r.get_LUT(t)}}),oa),ca=Object(v.b)((function(t){return{height:r.get_shape_z(t),width:r.get_shape_x(t),height_scale:r.get_scale_z(t),width_scale:r.get_scale_x(t),data_url:r.get_y_url(t),x:r.get_x(t),y:r.get_z(t),x_dim:"x",y_dim:"z",annotations:o.get_y_annotations(t),fill_circles:r.get_fill_circles(t),LUT:r.get_LUT(t)}}),oa),sa=Object(v.b)((function(t){return{height:r.get_shape_y(t),width:r.get_shape_x(t),height_scale:r.get_scale_y(t),width_scale:r.get_scale_x(t),data_url:r.get_z_url(t),x:r.get_x(t),y:r.get_y(t),x_dim:"x",y_dim:"y",annotations:o.get_z_annotations(t),fill_circles:r.get_fill_circles(t),LUT:r.get_LUT(t)}}),oa),ua=function(t){Object(ta.a)(e,t);var n=Object(na.a)(e);function e(t){var r;return Object(Qr.a)(this,e),(r=n.call(this,t)).state=void 0,r.abort_controller=void 0,r.fetch_and_draw=function(){r.abort_controller.abort(),r.abort_controller=new AbortController,G(r.props.data_url,r.abort_controller.signal).then((function(t){return r.setState({data:t})})).then(r.draw_to_canvas)},r.draw_to_canvas=function(){if(null!=r.state.data&&r.props.width>0&&r.props.height>0){var t=(a=r.state.data,o=r.props.LUT,a.map((function(t,n){switch(n%4){case 0:return gt(t,o.red);case 1:return gt(t,o.green);case 2:return gt(t,o.blue);default:return t}}))),n=r.refs.canvas.getContext("2d"),e=new ImageData(t,r.props.width,r.props.height);null===n||void 0===n||n.putImageData(e,0,0)}var a,o},r.make_click_handler=function(t){return function(n){var e,a=n.target.getBoundingClientRect(),o=n.clientX-a.left,i=n.clientY-a.top,c=o/(r.props.width*r.props.width_scale),s=i/(r.props.height*r.props.height_scale);t((e={},Object(xe.a)(e,r.props.x_dim,c),Object(xe.a)(e,r.props.y_dim,s),e))}},r.handle_click=r.make_click_handler(r.props.click),r.handle_doubleclick=r.make_click_handler(r.props.doubleclick),r.abort_controller=new AbortController,r.state={data:null},r}return Object(Zr.a)(e,[{key:"componentDidMount",value:function(){this.fetch_and_draw()}},{key:"componentDidUpdate",value:function(t){this.props.data_url!==t.data_url?this.fetch_and_draw():this.props.LUT!==t.LUT&&this.draw_to_canvas()}},{key:"render",value:function(){var t=this.props.width*this.props.width_scale,n=this.props.height*this.props.height_scale,e=Object(Xn.jsx)("line",{x1:0,y1:this.props.y*n,x2:t,y2:this.props.y*n,strokeWidth:"0.4",stroke:"grey"}),r=Object(Xn.jsx)("line",{x1:this.props.x*t,y1:0,x2:this.props.x*t,y2:n,strokeWidth:"0.4",stroke:"grey"});return Object(Xn.jsxs)("div",{style:{position:"relative",left:this.props.left,top:this.props.top,right:"0px"},children:[Object(Xn.jsx)("canvas",{ref:"canvas",width:this.props.width,height:this.props.height,style:{position:"absolute",left:"0px",top:"0px",zIndex:1,width:this.props.width*this.props.width_scale,height:this.props.height*this.props.height_scale}}),Object(Xn.jsxs)("svg",{ref:"svg",width:this.props.width*this.props.width_scale,height:this.props.height*this.props.height_scale,onClick:this.handle_click,onDoubleClick:this.handle_doubleclick,style:{position:"absolute",left:"0px",top:"0px",zIndex:2},children:[Object(Xn.jsx)(ve,{annotations:this.props.annotations,size_x:this.props.width*this.props.width_scale,size_y:this.props.height*this.props.height_scale,select:this.props.select,deselect:this.props.deselect,fill_circles:this.props.fill_circles}),e,r]})]})}}]),e}(h.Component),la=ia(ua),da=ca(ua),fa=sa(ua),ha=e(29),_a=e(81),pa=e(196),ba=e(8),va=e(107),xa=e.n(va),ma=e(106),ja=e.n(ma),ga=e(195),wa=e(197),ya=e(188),Oa=e(191),Ma=Object(ba.a)({tooltip:{maxWidth:600,margin:10,padding:10,position:"absolute",top:-50}})(pa.a),ka=Object(v.b)((function(t){return{window_state:r.get_state(t)}}),(function(t){return{actions:Object(Un.b)(Object(U.a)({},S),t),saga_actions:Object(Un.b)(Object(U.a)({},kr),t)}}))((function(t){var n=_.a.useState(t.window_state),e=Object(me.a)(n,2),r=e[0],a=e[1];_.a.useEffect((function(){a(Object(U.a)(Object(U.a)({},t.window_state),{},{x:parseFloat(t.window_state.x.toFixed(3)),y:parseFloat(t.window_state.y.toFixed(3)),z:parseFloat(t.window_state.z.toFixed(3))}))}),[t.window_state]);var o=function(){t.actions.set_x(r.x),t.actions.set_y(r.y),t.actions.set_z(r.z),t.actions.set_t_idx(r.t_idx);var n=r.selected_annotation;null===n||""===String(n)?t.saga_actions.set_selected_annotation(null):t.saga_actions.set_selected_annotation(Number(n));var e=r.selected_worldline;null===e||""===String(e)?t.saga_actions.set_selected_worldline(null):t.saga_actions.set_selected_worldline(Number(e)),t.actions.set_active_provenance(r.active_provenance),t.actions.set_rpc_args(r.rpc_args),t.actions.set_rpc_list(r.rpc_list)},i=function(t,n){var e=t;return Object(Xn.jsx)(je.a,{type:"string",label:n,value:null!==r[e]?r[e]:"",onChange:function(t){return function(t,n){var e=Object(U.a)(Object(U.a)({},r),{},Object(xe.a)({},t,n));a(e)}(e,t.target.value)},onBlur:o,style:{position:"relative",width:"80px",margin:"10px"},InputLabelProps:{style:{fontSize:14}},InputProps:{style:{fontFamily:"monospace"}}},e)},c=[["x","x"],["y","y"],["z","z"],["t_idx","t"],["selected_annotation","anno."],["selected_worldline","track"],["active_provenance","prov"]].map((function(t){return i(t[0],t[1])})),s="1234567890".split("").map((function(n){var e,i=Object(_a.get)(r.rpc_keybindings,n,0),c=Object(_a.get)(r.rpc_list,i);return e=c?Object(_a.get)(c,"docstring",""):"",Object(Xn.jsx)(_.a.Fragment,{children:Object(Xn.jsx)(Ma,{interactive:!0,title:Object(Xn.jsx)("pre",{style:{fontSize:14},children:e}),placement:"right",children:Object(Xn.jsxs)(ya.a,{style:{width:810,margin:10,top:10,marginBottom:50},children:[Object(Xn.jsxs)(ga.a,{id:"action-".concat(n,"-select-label"),children:["Key ",n]}),Object(Xn.jsx)(Oa.a,{labelId:"action-".concat(n,"-select-label"),id:"action-".concat(n,"-select"),value:i,onChange:function(e){return function(n,e){t.actions.set_rpc_keybinding([n,e]),t.actions.set_rpc_arg([n,r.rpc_list[e].default_args])}(n,Number(e.target.value))},style:{width:250,position:"absolute",fontFamily:"monospace"},children:t.window_state.rpc_list.map((function(t,n){return Object(Xn.jsx)(wa.a,{style:{fontFamily:"monospace"},value:n,children:t.name},n)}))}),Object(Xn.jsx)(je.a,{type:"string",label:"arg",value:r.rpc_args[n],onChange:function(t){return function(t,n){var e=r.rpc_keybindings[t],o=Object(ha.b)(r,(function(r){r.rpc_args[t]=n,r.rpc_list[e].default_args=n}));a(o)}(n,t.target.value)},onBlur:o,style:{position:"absolute",left:300,width:400},InputProps:{style:{fontFamily:"monospace"}}})]})})},n)}));return Object(Xn.jsx)(Ln.a,{elevation:3,variant:"outlined",square:!0,style:{position:"absolute",left:t.left,top:t.top,width:"840px",height:"1000px"},children:Object(Xn.jsxs)(In.a,{children:[Object(Xn.jsx)("h3",{children:"Annotation Window"}),Object(Xn.jsx)(pa.a,{title:"Load from disk",children:Object(Xn.jsx)(Pn.a,{"aria-label":"load",onClick:function(){return t.saga_actions.load()},style:{position:"absolute",left:"650px",top:"5px"},children:Object(Xn.jsx)(ja.a,{fontSize:"small"})})}),Object(Xn.jsx)(pa.a,{title:"Save to disk",children:Object(Xn.jsx)(Pn.a,{"aria-label":"save",onClick:function(){return t.saga_actions.save()},style:{position:"absolute",left:"700px",top:"5px"},children:Object(Xn.jsx)(xa.a,{fontSize:"small"})})}),c,Object(Xn.jsx)(pa.a,{title:"Keyboard shortcut: o",children:Object(Xn.jsxs)("div",{style:{width:150,float:"left"},children:[Object(Xn.jsx)("input",{type:"checkbox",checked:t.window_state.fill_circles,id:"fill-circles-cb",onChange:function(n){return t.actions.set_fill_circles(n.target.checked)},style:{marginTop:"30px"}}),Object(Xn.jsx)("label",{children:"Fill circles"})]})}),Object(Xn.jsx)(pa.a,{title:"Keyboard shortcut: a",children:Object(Xn.jsxs)("div",{style:{width:150,float:"left"},children:[Object(Xn.jsx)("input",{type:"checkbox",checked:t.window_state.show_all_annotations,id:"all-annotations-cb",onChange:function(n){return t.actions.set_show_all_annotations(n.target.checked)},style:{marginTop:"30px"}}),Object(Xn.jsx)("label",{children:"Show all"})]})}),s]})})})),Ta=1e-6,za="undefined"!==typeof Float32Array?Float32Array:Array,Ea=Math.random;Math.PI;Math.hypot||(Math.hypot=function(){for(var t=0,n=arguments.length;n--;)t+=arguments[n]*arguments[n];return Math.sqrt(t)});function Sa(){var t=new za(9);return za!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Aa(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[4],t[4]=n[5],t[5]=n[6],t[6]=n[8],t[7]=n[9],t[8]=n[10],t}function Ca(t){var n=new za(9);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n}function Da(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t}function Ra(t,n,e,r,a,o,i,c,s){var u=new za(9);return u[0]=t,u[1]=n,u[2]=e,u[3]=r,u[4]=a,u[5]=o,u[6]=i,u[7]=c,u[8]=s,u}function Ua(t,n,e,r,a,o,i,c,s,u){return t[0]=n,t[1]=e,t[2]=r,t[3]=a,t[4]=o,t[5]=i,t[6]=c,t[7]=s,t[8]=u,t}function La(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Ia(t,n){if(t===n){var e=n[1],r=n[2],a=n[5];t[1]=n[3],t[2]=n[6],t[3]=e,t[5]=n[7],t[6]=r,t[7]=a}else t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8];return t}function Pa(t,n){var e=n[0],r=n[1],a=n[2],o=n[3],i=n[4],c=n[5],s=n[6],u=n[7],l=n[8],d=l*i-c*u,f=-l*o+c*s,h=u*o-i*s,_=e*d+r*f+a*h;return _?(_=1/_,t[0]=d*_,t[1]=(-l*r+a*u)*_,t[2]=(c*r-a*i)*_,t[3]=f*_,t[4]=(l*e-a*s)*_,t[5]=(-c*e+a*o)*_,t[6]=h*_,t[7]=(-u*e+r*s)*_,t[8]=(i*e-r*o)*_,t):null}function Fa(t,n){var e=n[0],r=n[1],a=n[2],o=n[3],i=n[4],c=n[5],s=n[6],u=n[7],l=n[8];return t[0]=i*l-c*u,t[1]=a*u-r*l,t[2]=r*c-a*i,t[3]=c*s-o*l,t[4]=e*l-a*s,t[5]=a*o-e*c,t[6]=o*u-i*s,t[7]=r*s-e*u,t[8]=e*i-r*o,t}function qa(t){var n=t[0],e=t[1],r=t[2],a=t[3],o=t[4],i=t[5],c=t[6],s=t[7],u=t[8];return n*(u*o-i*s)+e*(-u*a+i*c)+r*(s*a-o*c)}function Na(t,n,e){var r=n[0],a=n[1],o=n[2],i=n[3],c=n[4],s=n[5],u=n[6],l=n[7],d=n[8],f=e[0],h=e[1],_=e[2],p=e[3],b=e[4],v=e[5],x=e[6],m=e[7],j=e[8];return t[0]=f*r+h*i+_*u,t[1]=f*a+h*c+_*l,t[2]=f*o+h*s+_*d,t[3]=p*r+b*i+v*u,t[4]=p*a+b*c+v*l,t[5]=p*o+b*s+v*d,t[6]=x*r+m*i+j*u,t[7]=x*a+m*c+j*l,t[8]=x*o+m*s+j*d,t}function Xa(t,n,e){var r=n[0],a=n[1],o=n[2],i=n[3],c=n[4],s=n[5],u=n[6],l=n[7],d=n[8],f=e[0],h=e[1];return t[0]=r,t[1]=a,t[2]=o,t[3]=i,t[4]=c,t[5]=s,t[6]=f*r+h*i+u,t[7]=f*a+h*c+l,t[8]=f*o+h*s+d,t}function Ba(t,n,e){var r=n[0],a=n[1],o=n[2],i=n[3],c=n[4],s=n[5],u=n[6],l=n[7],d=n[8],f=Math.sin(e),h=Math.cos(e);return t[0]=h*r+f*i,t[1]=h*a+f*c,t[2]=h*o+f*s,t[3]=h*i-f*r,t[4]=h*c-f*a,t[5]=h*s-f*o,t[6]=u,t[7]=l,t[8]=d,t}function Va(t,n,e){var r=e[0],a=e[1];return t[0]=r*n[0],t[1]=r*n[1],t[2]=r*n[2],t[3]=a*n[3],t[4]=a*n[4],t[5]=a*n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t}function Wa(t,n){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=n[0],t[7]=n[1],t[8]=1,t}function Ya(t,n){var e=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=e,t[2]=0,t[3]=-e,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Ha(t,n){return t[0]=n[0],t[1]=0,t[2]=0,t[3]=0,t[4]=n[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Ga(t,n){return t[0]=n[0],t[1]=n[1],t[2]=0,t[3]=n[2],t[4]=n[3],t[5]=0,t[6]=n[4],t[7]=n[5],t[8]=1,t}function Ka(t,n){var e=n[0],r=n[1],a=n[2],o=n[3],i=e+e,c=r+r,s=a+a,u=e*i,l=r*i,d=r*c,f=a*i,h=a*c,_=a*s,p=o*i,b=o*c,v=o*s;return t[0]=1-d-_,t[3]=l-v,t[6]=f+b,t[1]=l+v,t[4]=1-u-_,t[7]=h-p,t[2]=f-b,t[5]=h+p,t[8]=1-u-d,t}function Ja(t,n){var e=n[0],r=n[1],a=n[2],o=n[3],i=n[4],c=n[5],s=n[6],u=n[7],l=n[8],d=n[9],f=n[10],h=n[11],_=n[12],p=n[13],b=n[14],v=n[15],x=e*c-r*i,m=e*s-a*i,j=e*u-o*i,g=r*s-a*c,w=r*u-o*c,y=a*u-o*s,O=l*p-d*_,M=l*b-f*_,k=l*v-h*_,T=d*b-f*p,z=d*v-h*p,E=f*v-h*b,S=x*E-m*z+j*T+g*k-w*M+y*O;return S?(S=1/S,t[0]=(c*E-s*z+u*T)*S,t[1]=(s*k-i*E-u*M)*S,t[2]=(i*z-c*k+u*O)*S,t[3]=(a*z-r*E-o*T)*S,t[4]=(e*E-a*k+o*M)*S,t[5]=(r*k-e*z-o*O)*S,t[6]=(p*y-b*w+v*g)*S,t[7]=(b*j-_*y-v*m)*S,t[8]=(_*w-p*j+v*x)*S,t):null}function Qa(t,n,e){return t[0]=2/n,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/e,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function Za(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function $a(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function to(t,n,e){return t[0]=n[0]+e[0],t[1]=n[1]+e[1],t[2]=n[2]+e[2],t[3]=n[3]+e[3],t[4]=n[4]+e[4],t[5]=n[5]+e[5],t[6]=n[6]+e[6],t[7]=n[7]+e[7],t[8]=n[8]+e[8],t}function no(t,n,e){return t[0]=n[0]-e[0],t[1]=n[1]-e[1],t[2]=n[2]-e[2],t[3]=n[3]-e[3],t[4]=n[4]-e[4],t[5]=n[5]-e[5],t[6]=n[6]-e[6],t[7]=n[7]-e[7],t[8]=n[8]-e[8],t}function eo(t,n,e){return t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t[3]=n[3]*e,t[4]=n[4]*e,t[5]=n[5]*e,t[6]=n[6]*e,t[7]=n[7]*e,t[8]=n[8]*e,t}function ro(t,n,e,r){return t[0]=n[0]+e[0]*r,t[1]=n[1]+e[1]*r,t[2]=n[2]+e[2]*r,t[3]=n[3]+e[3]*r,t[4]=n[4]+e[4]*r,t[5]=n[5]+e[5]*r,t[6]=n[6]+e[6]*r,t[7]=n[7]+e[7]*r,t[8]=n[8]+e[8]*r,t}function ao(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]&&t[6]===n[6]&&t[7]===n[7]&&t[8]===n[8]}function oo(t,n){var e=t[0],r=t[1],a=t[2],o=t[3],i=t[4],c=t[5],s=t[6],u=t[7],l=t[8],d=n[0],f=n[1],h=n[2],_=n[3],p=n[4],b=n[5],v=n[6],x=n[7],m=n[8];return Math.abs(e-d)<=Ta*Math.max(1,Math.abs(e),Math.abs(d))&&Math.abs(r-f)<=Ta*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(a-h)<=Ta*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(o-_)<=Ta*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(i-p)<=Ta*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(c-b)<=Ta*Math.max(1,Math.abs(c),Math.abs(b))&&Math.abs(s-v)<=Ta*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(u-x)<=Ta*Math.max(1,Math.abs(u),Math.abs(x))&&Math.abs(l-m)<=Ta*Math.max(1,Math.abs(l),Math.abs(m))}var io=Na,co=no;function so(){var t=new za(16);return za!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function uo(t){var n=new za(16);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n}function lo(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t}function fo(t,n,e,r,a,o,i,c,s,u,l,d,f,h,_,p){var b=new za(16);return b[0]=t,b[1]=n,b[2]=e,b[3]=r,b[4]=a,b[5]=o,b[6]=i,b[7]=c,b[8]=s,b[9]=u,b[10]=l,b[11]=d,b[12]=f,b[13]=h,b[14]=_,b[15]=p,b}function ho(t,n,e,r,a,o,i,c,s,u,l,d,f,h,_,p,b){return t[0]=n,t[1]=e,t[2]=r,t[3]=a,t[4]=o,t[5]=i,t[6]=c,t[7]=s,t[8]=u,t[9]=l,t[10]=d,t[11]=f,t[12]=h,t[13]=_,t[14]=p,t[15]=b,t}function _o(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function po(t,n){if(t===n){var e=n[1],r=n[2],a=n[3],o=n[6],i=n[7],c=n[11];t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=e,t[6]=n[9],t[7]=n[13],t[8]=r,t[9]=o,t[11]=n[14],t[12]=a,t[13]=i,t[14]=c}else t[0]=n[0],t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=n[1],t[5]=n[5],t[6]=n[9],t[7]=n[13],t[8]=n[2],t[9]=n[6],t[10]=n[10],t[11]=n[14],t[12]=n[3],t[13]=n[7],t[14]=n[11],t[15]=n[15];return t}function bo(t,n){var e=n[0],r=n[1],a=n[2],o=n[3],i=n[4],c=n[5],s=n[6],u=n[7],l=n[8],d=n[9],f=n[10],h=n[11],_=n[12],p=n[13],b=n[14],v=n[15],x=e*c-r*i,m=e*s-a*i,j=e*u-o*i,g=r*s-a*c,w=r*u-o*c,y=a*u-o*s,O=l*p-d*_,M=l*b-f*_,k=l*v-h*_,T=d*b-f*p,z=d*v-h*p,E=f*v-h*b,S=x*E-m*z+j*T+g*k-w*M+y*O;return S?(S=1/S,t[0]=(c*E-s*z+u*T)*S,t[1]=(a*z-r*E-o*T)*S,t[2]=(p*y-b*w+v*g)*S,t[3]=(f*w-d*y-h*g)*S,t[4]=(s*k-i*E-u*M)*S,t[5]=(e*E-a*k+o*M)*S,t[6]=(b*j-_*y-v*m)*S,t[7]=(l*y-f*j+h*m)*S,t[8]=(i*z-c*k+u*O)*S,t[9]=(r*k-e*z-o*O)*S,t[10]=(_*w-p*j+v*x)*S,t[11]=(d*j-l*w-h*x)*S,t[12]=(c*M-i*T-s*O)*S,t[13]=(e*T-r*M+a*O)*S,t[14]=(p*m-_*g-b*x)*S,t[15]=(l*g-d*m+f*x)*S,t):null}function vo(t,n){var e=n[0],r=n[1],a=n[2],o=n[3],i=n[4],c=n[5],s=n[6],u=n[7],l=n[8],d=n[9],f=n[10],h=n[11],_=n[12],p=n[13],b=n[14],v=n[15],x=e*c-r*i,m=e*s-a*i,j=e*u-o*i,g=r*s-a*c,w=r*u-o*c,y=a*u-o*s,O=l*p-d*_,M=l*b-f*_,k=l*v-h*_,T=d*b-f*p,z=d*v-h*p,E=f*v-h*b;return t[0]=c*E-s*z+u*T,t[1]=a*z-r*E-o*T,t[2]=p*y-b*w+v*g,t[3]=f*w-d*y-h*g,t[4]=s*k-i*E-u*M,t[5]=e*E-a*k+o*M,t[6]=b*j-_*y-v*m,t[7]=l*y-f*j+h*m,t[8]=i*z-c*k+u*O,t[9]=r*k-e*z-o*O,t[10]=_*w-p*j+v*x,t[11]=d*j-l*w-h*x,t[12]=c*M-i*T-s*O,t[13]=e*T-r*M+a*O,t[14]=p*m-_*g-b*x,t[15]=l*g-d*m+f*x,t}function xo(t){var n=t[0],e=t[1],r=t[2],a=t[3],o=t[4],i=t[5],c=t[6],s=t[7],u=t[8],l=t[9],d=t[10],f=t[11],h=t[12],_=t[13],p=t[14],b=n*i-e*o,v=n*c-r*o,x=e*c-r*i,m=u*_-l*h,j=u*p-d*h,g=l*p-d*_;return s*(n*g-e*j+r*m)-a*(o*g-i*j+c*m)+t[15]*(u*x-l*v+d*b)-f*(h*x-_*v+p*b)}function mo(t,n,e){var r=n[0],a=n[1],o=n[2],i=n[3],c=n[4],s=n[5],u=n[6],l=n[7],d=n[8],f=n[9],h=n[10],_=n[11],p=n[12],b=n[13],v=n[14],x=n[15],m=e[0],j=e[1],g=e[2],w=e[3];return t[0]=m*r+j*c+g*d+w*p,t[1]=m*a+j*s+g*f+w*b,t[2]=m*o+j*u+g*h+w*v,t[3]=m*i+j*l+g*_+w*x,m=e[4],j=e[5],g=e[6],w=e[7],t[4]=m*r+j*c+g*d+w*p,t[5]=m*a+j*s+g*f+w*b,t[6]=m*o+j*u+g*h+w*v,t[7]=m*i+j*l+g*_+w*x,m=e[8],j=e[9],g=e[10],w=e[11],t[8]=m*r+j*c+g*d+w*p,t[9]=m*a+j*s+g*f+w*b,t[10]=m*o+j*u+g*h+w*v,t[11]=m*i+j*l+g*_+w*x,m=e[12],j=e[13],g=e[14],w=e[15],t[12]=m*r+j*c+g*d+w*p,t[13]=m*a+j*s+g*f+w*b,t[14]=m*o+j*u+g*h+w*v,t[15]=m*i+j*l+g*_+w*x,t}function jo(t,n,e){var r,a,o,i,c,s,u,l,d,f,h,_,p=e[0],b=e[1],v=e[2];return n===t?(t[12]=n[0]*p+n[4]*b+n[8]*v+n[12],t[13]=n[1]*p+n[5]*b+n[9]*v+n[13],t[14]=n[2]*p+n[6]*b+n[10]*v+n[14],t[15]=n[3]*p+n[7]*b+n[11]*v+n[15]):(r=n[0],a=n[1],o=n[2],i=n[3],c=n[4],s=n[5],u=n[6],l=n[7],d=n[8],f=n[9],h=n[10],_=n[11],t[0]=r,t[1]=a,t[2]=o,t[3]=i,t[4]=c,t[5]=s,t[6]=u,t[7]=l,t[8]=d,t[9]=f,t[10]=h,t[11]=_,t[12]=r*p+c*b+d*v+n[12],t[13]=a*p+s*b+f*v+n[13],t[14]=o*p+u*b+h*v+n[14],t[15]=i*p+l*b+_*v+n[15]),t}function go(t,n,e){var r=e[0],a=e[1],o=e[2];return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=n[3]*r,t[4]=n[4]*a,t[5]=n[5]*a,t[6]=n[6]*a,t[7]=n[7]*a,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=n[11]*o,t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t}function wo(t,n,e,r){var a,o,i,c,s,u,l,d,f,h,_,p,b,v,x,m,j,g,w,y,O,M,k,T,z=r[0],E=r[1],S=r[2],A=Math.hypot(z,E,S);return A<Ta?null:(z*=A=1/A,E*=A,S*=A,a=Math.sin(e),i=1-(o=Math.cos(e)),c=n[0],s=n[1],u=n[2],l=n[3],d=n[4],f=n[5],h=n[6],_=n[7],p=n[8],b=n[9],v=n[10],x=n[11],m=z*z*i+o,j=E*z*i+S*a,g=S*z*i-E*a,w=z*E*i-S*a,y=E*E*i+o,O=S*E*i+z*a,M=z*S*i+E*a,k=E*S*i-z*a,T=S*S*i+o,t[0]=c*m+d*j+p*g,t[1]=s*m+f*j+b*g,t[2]=u*m+h*j+v*g,t[3]=l*m+_*j+x*g,t[4]=c*w+d*y+p*O,t[5]=s*w+f*y+b*O,t[6]=u*w+h*y+v*O,t[7]=l*w+_*y+x*O,t[8]=c*M+d*k+p*T,t[9]=s*M+f*k+b*T,t[10]=u*M+h*k+v*T,t[11]=l*M+_*k+x*T,n!==t&&(t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t)}function yo(t,n,e){var r=Math.sin(e),a=Math.cos(e),o=n[4],i=n[5],c=n[6],s=n[7],u=n[8],l=n[9],d=n[10],f=n[11];return n!==t&&(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[4]=o*a+u*r,t[5]=i*a+l*r,t[6]=c*a+d*r,t[7]=s*a+f*r,t[8]=u*a-o*r,t[9]=l*a-i*r,t[10]=d*a-c*r,t[11]=f*a-s*r,t}function Oo(t,n,e){var r=Math.sin(e),a=Math.cos(e),o=n[0],i=n[1],c=n[2],s=n[3],u=n[8],l=n[9],d=n[10],f=n[11];return n!==t&&(t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[0]=o*a-u*r,t[1]=i*a-l*r,t[2]=c*a-d*r,t[3]=s*a-f*r,t[8]=o*r+u*a,t[9]=i*r+l*a,t[10]=c*r+d*a,t[11]=s*r+f*a,t}function Mo(t,n,e){var r=Math.sin(e),a=Math.cos(e),o=n[0],i=n[1],c=n[2],s=n[3],u=n[4],l=n[5],d=n[6],f=n[7];return n!==t&&(t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[0]=o*a+u*r,t[1]=i*a+l*r,t[2]=c*a+d*r,t[3]=s*a+f*r,t[4]=u*a-o*r,t[5]=l*a-i*r,t[6]=d*a-c*r,t[7]=f*a-s*r,t}function ko(t,n){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function To(t,n){return t[0]=n[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=n[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function zo(t,n,e){var r,a,o,i=e[0],c=e[1],s=e[2],u=Math.hypot(i,c,s);return u<Ta?null:(i*=u=1/u,c*=u,s*=u,r=Math.sin(n),o=1-(a=Math.cos(n)),t[0]=i*i*o+a,t[1]=c*i*o+s*r,t[2]=s*i*o-c*r,t[3]=0,t[4]=i*c*o-s*r,t[5]=c*c*o+a,t[6]=s*c*o+i*r,t[7]=0,t[8]=i*s*o+c*r,t[9]=c*s*o-i*r,t[10]=s*s*o+a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function Eo(t,n){var e=Math.sin(n),r=Math.cos(n);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=e,t[7]=0,t[8]=0,t[9]=-e,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function So(t,n){var e=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=0,t[2]=-e,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=e,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Ao(t,n){var e=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=e,t[2]=0,t[3]=0,t[4]=-e,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Co(t,n,e){var r=n[0],a=n[1],o=n[2],i=n[3],c=r+r,s=a+a,u=o+o,l=r*c,d=r*s,f=r*u,h=a*s,_=a*u,p=o*u,b=i*c,v=i*s,x=i*u;return t[0]=1-(h+p),t[1]=d+x,t[2]=f-v,t[3]=0,t[4]=d-x,t[5]=1-(l+p),t[6]=_+b,t[7]=0,t[8]=f+v,t[9]=_-b,t[10]=1-(l+h),t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function Do(t,n){var e=new za(3),r=-n[0],a=-n[1],o=-n[2],i=n[3],c=n[4],s=n[5],u=n[6],l=n[7],d=r*r+a*a+o*o+i*i;return d>0?(e[0]=2*(c*i+l*r+s*o-u*a)/d,e[1]=2*(s*i+l*a+u*r-c*o)/d,e[2]=2*(u*i+l*o+c*a-s*r)/d):(e[0]=2*(c*i+l*r+s*o-u*a),e[1]=2*(s*i+l*a+u*r-c*o),e[2]=2*(u*i+l*o+c*a-s*r)),Co(t,n,e),t}function Ro(t,n){return t[0]=n[12],t[1]=n[13],t[2]=n[14],t}function Uo(t,n){var e=n[0],r=n[1],a=n[2],o=n[4],i=n[5],c=n[6],s=n[8],u=n[9],l=n[10];return t[0]=Math.hypot(e,r,a),t[1]=Math.hypot(o,i,c),t[2]=Math.hypot(s,u,l),t}function Lo(t,n){var e=new za(3);Uo(e,n);var r=1/e[0],a=1/e[1],o=1/e[2],i=n[0]*r,c=n[1]*a,s=n[2]*o,u=n[4]*r,l=n[5]*a,d=n[6]*o,f=n[8]*r,h=n[9]*a,_=n[10]*o,p=i+l+_,b=0;return p>0?(b=2*Math.sqrt(p+1),t[3]=.25*b,t[0]=(d-h)/b,t[1]=(f-s)/b,t[2]=(c-u)/b):i>l&&i>_?(b=2*Math.sqrt(1+i-l-_),t[3]=(d-h)/b,t[0]=.25*b,t[1]=(c+u)/b,t[2]=(f+s)/b):l>_?(b=2*Math.sqrt(1+l-i-_),t[3]=(f-s)/b,t[0]=(c+u)/b,t[1]=.25*b,t[2]=(d+h)/b):(b=2*Math.sqrt(1+_-i-l),t[3]=(c-u)/b,t[0]=(f+s)/b,t[1]=(d+h)/b,t[2]=.25*b),t}function Io(t,n,e,r){var a=n[0],o=n[1],i=n[2],c=n[3],s=a+a,u=o+o,l=i+i,d=a*s,f=a*u,h=a*l,_=o*u,p=o*l,b=i*l,v=c*s,x=c*u,m=c*l,j=r[0],g=r[1],w=r[2];return t[0]=(1-(_+b))*j,t[1]=(f+m)*j,t[2]=(h-x)*j,t[3]=0,t[4]=(f-m)*g,t[5]=(1-(d+b))*g,t[6]=(p+v)*g,t[7]=0,t[8]=(h+x)*w,t[9]=(p-v)*w,t[10]=(1-(d+_))*w,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function Po(t,n,e,r,a){var o=n[0],i=n[1],c=n[2],s=n[3],u=o+o,l=i+i,d=c+c,f=o*u,h=o*l,_=o*d,p=i*l,b=i*d,v=c*d,x=s*u,m=s*l,j=s*d,g=r[0],w=r[1],y=r[2],O=a[0],M=a[1],k=a[2],T=(1-(p+v))*g,z=(h+j)*g,E=(_-m)*g,S=(h-j)*w,A=(1-(f+v))*w,C=(b+x)*w,D=(_+m)*y,R=(b-x)*y,U=(1-(f+p))*y;return t[0]=T,t[1]=z,t[2]=E,t[3]=0,t[4]=S,t[5]=A,t[6]=C,t[7]=0,t[8]=D,t[9]=R,t[10]=U,t[11]=0,t[12]=e[0]+O-(T*O+S*M+D*k),t[13]=e[1]+M-(z*O+A*M+R*k),t[14]=e[2]+k-(E*O+C*M+U*k),t[15]=1,t}function Fo(t,n){var e=n[0],r=n[1],a=n[2],o=n[3],i=e+e,c=r+r,s=a+a,u=e*i,l=r*i,d=r*c,f=a*i,h=a*c,_=a*s,p=o*i,b=o*c,v=o*s;return t[0]=1-d-_,t[1]=l+v,t[2]=f-b,t[3]=0,t[4]=l-v,t[5]=1-u-_,t[6]=h+p,t[7]=0,t[8]=f+b,t[9]=h-p,t[10]=1-u-d,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function qo(t,n,e,r,a,o,i){var c=1/(e-n),s=1/(a-r),u=1/(o-i);return t[0]=2*o*c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*s,t[6]=0,t[7]=0,t[8]=(e+n)*c,t[9]=(a+r)*s,t[10]=(i+o)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=i*o*2*u,t[15]=0,t}function No(t,n,e,r,a){var o,i=1/Math.tan(n/2);return t[0]=i/e,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=a&&a!==1/0?(o=1/(r-a),t[10]=(a+r)*o,t[14]=2*a*r*o):(t[10]=-1,t[14]=-2*r),t}function Xo(t,n,e,r){var a=Math.tan(n.upDegrees*Math.PI/180),o=Math.tan(n.downDegrees*Math.PI/180),i=Math.tan(n.leftDegrees*Math.PI/180),c=Math.tan(n.rightDegrees*Math.PI/180),s=2/(i+c),u=2/(a+o);return t[0]=s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=-(i-c)*s*.5,t[9]=(a-o)*u*.5,t[10]=r/(e-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*e/(e-r),t[15]=0,t}function Bo(t,n,e,r,a,o,i){var c=1/(n-e),s=1/(r-a),u=1/(o-i);return t[0]=-2*c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(n+e)*c,t[13]=(a+r)*s,t[14]=(i+o)*u,t[15]=1,t}function Vo(t,n,e,r){var a,o,i,c,s,u,l,d,f,h,_=n[0],p=n[1],b=n[2],v=r[0],x=r[1],m=r[2],j=e[0],g=e[1],w=e[2];return Math.abs(_-j)<Ta&&Math.abs(p-g)<Ta&&Math.abs(b-w)<Ta?_o(t):(l=_-j,d=p-g,f=b-w,a=x*(f*=h=1/Math.hypot(l,d,f))-m*(d*=h),o=m*(l*=h)-v*f,i=v*d-x*l,(h=Math.hypot(a,o,i))?(a*=h=1/h,o*=h,i*=h):(a=0,o=0,i=0),c=d*i-f*o,s=f*a-l*i,u=l*o-d*a,(h=Math.hypot(c,s,u))?(c*=h=1/h,s*=h,u*=h):(c=0,s=0,u=0),t[0]=a,t[1]=c,t[2]=l,t[3]=0,t[4]=o,t[5]=s,t[6]=d,t[7]=0,t[8]=i,t[9]=u,t[10]=f,t[11]=0,t[12]=-(a*_+o*p+i*b),t[13]=-(c*_+s*p+u*b),t[14]=-(l*_+d*p+f*b),t[15]=1,t)}function Wo(t,n,e,r){var a=n[0],o=n[1],i=n[2],c=r[0],s=r[1],u=r[2],l=a-e[0],d=o-e[1],f=i-e[2],h=l*l+d*d+f*f;h>0&&(l*=h=1/Math.sqrt(h),d*=h,f*=h);var _=s*f-u*d,p=u*l-c*f,b=c*d-s*l;return(h=_*_+p*p+b*b)>0&&(_*=h=1/Math.sqrt(h),p*=h,b*=h),t[0]=_,t[1]=p,t[2]=b,t[3]=0,t[4]=d*b-f*p,t[5]=f*_-l*b,t[6]=l*p-d*_,t[7]=0,t[8]=l,t[9]=d,t[10]=f,t[11]=0,t[12]=a,t[13]=o,t[14]=i,t[15]=1,t}function Yo(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function Ho(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function Go(t,n,e){return t[0]=n[0]+e[0],t[1]=n[1]+e[1],t[2]=n[2]+e[2],t[3]=n[3]+e[3],t[4]=n[4]+e[4],t[5]=n[5]+e[5],t[6]=n[6]+e[6],t[7]=n[7]+e[7],t[8]=n[8]+e[8],t[9]=n[9]+e[9],t[10]=n[10]+e[10],t[11]=n[11]+e[11],t[12]=n[12]+e[12],t[13]=n[13]+e[13],t[14]=n[14]+e[14],t[15]=n[15]+e[15],t}function Ko(t,n,e){return t[0]=n[0]-e[0],t[1]=n[1]-e[1],t[2]=n[2]-e[2],t[3]=n[3]-e[3],t[4]=n[4]-e[4],t[5]=n[5]-e[5],t[6]=n[6]-e[6],t[7]=n[7]-e[7],t[8]=n[8]-e[8],t[9]=n[9]-e[9],t[10]=n[10]-e[10],t[11]=n[11]-e[11],t[12]=n[12]-e[12],t[13]=n[13]-e[13],t[14]=n[14]-e[14],t[15]=n[15]-e[15],t}function Jo(t,n,e){return t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t[3]=n[3]*e,t[4]=n[4]*e,t[5]=n[5]*e,t[6]=n[6]*e,t[7]=n[7]*e,t[8]=n[8]*e,t[9]=n[9]*e,t[10]=n[10]*e,t[11]=n[11]*e,t[12]=n[12]*e,t[13]=n[13]*e,t[14]=n[14]*e,t[15]=n[15]*e,t}function Qo(t,n,e,r){return t[0]=n[0]+e[0]*r,t[1]=n[1]+e[1]*r,t[2]=n[2]+e[2]*r,t[3]=n[3]+e[3]*r,t[4]=n[4]+e[4]*r,t[5]=n[5]+e[5]*r,t[6]=n[6]+e[6]*r,t[7]=n[7]+e[7]*r,t[8]=n[8]+e[8]*r,t[9]=n[9]+e[9]*r,t[10]=n[10]+e[10]*r,t[11]=n[11]+e[11]*r,t[12]=n[12]+e[12]*r,t[13]=n[13]+e[13]*r,t[14]=n[14]+e[14]*r,t[15]=n[15]+e[15]*r,t}function Zo(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]&&t[6]===n[6]&&t[7]===n[7]&&t[8]===n[8]&&t[9]===n[9]&&t[10]===n[10]&&t[11]===n[11]&&t[12]===n[12]&&t[13]===n[13]&&t[14]===n[14]&&t[15]===n[15]}function $o(t,n){var e=t[0],r=t[1],a=t[2],o=t[3],i=t[4],c=t[5],s=t[6],u=t[7],l=t[8],d=t[9],f=t[10],h=t[11],_=t[12],p=t[13],b=t[14],v=t[15],x=n[0],m=n[1],j=n[2],g=n[3],w=n[4],y=n[5],O=n[6],M=n[7],k=n[8],T=n[9],z=n[10],E=n[11],S=n[12],A=n[13],C=n[14],D=n[15];return Math.abs(e-x)<=Ta*Math.max(1,Math.abs(e),Math.abs(x))&&Math.abs(r-m)<=Ta*Math.max(1,Math.abs(r),Math.abs(m))&&Math.abs(a-j)<=Ta*Math.max(1,Math.abs(a),Math.abs(j))&&Math.abs(o-g)<=Ta*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(i-w)<=Ta*Math.max(1,Math.abs(i),Math.abs(w))&&Math.abs(c-y)<=Ta*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(s-O)<=Ta*Math.max(1,Math.abs(s),Math.abs(O))&&Math.abs(u-M)<=Ta*Math.max(1,Math.abs(u),Math.abs(M))&&Math.abs(l-k)<=Ta*Math.max(1,Math.abs(l),Math.abs(k))&&Math.abs(d-T)<=Ta*Math.max(1,Math.abs(d),Math.abs(T))&&Math.abs(f-z)<=Ta*Math.max(1,Math.abs(f),Math.abs(z))&&Math.abs(h-E)<=Ta*Math.max(1,Math.abs(h),Math.abs(E))&&Math.abs(_-S)<=Ta*Math.max(1,Math.abs(_),Math.abs(S))&&Math.abs(p-A)<=Ta*Math.max(1,Math.abs(p),Math.abs(A))&&Math.abs(b-C)<=Ta*Math.max(1,Math.abs(b),Math.abs(C))&&Math.abs(v-D)<=Ta*Math.max(1,Math.abs(v),Math.abs(D))}var ti=mo,ni=Ko;function ei(){var t=new za(3);return za!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function ri(t){var n=new za(3);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n}function ai(t){var n=t[0],e=t[1],r=t[2];return Math.hypot(n,e,r)}function oi(t,n,e){var r=new za(3);return r[0]=t,r[1]=n,r[2]=e,r}function ii(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t}function ci(t,n,e,r){return t[0]=n,t[1]=e,t[2]=r,t}function si(t,n,e){return t[0]=n[0]+e[0],t[1]=n[1]+e[1],t[2]=n[2]+e[2],t}function ui(t,n,e){return t[0]=n[0]-e[0],t[1]=n[1]-e[1],t[2]=n[2]-e[2],t}function li(t,n,e){return t[0]=n[0]*e[0],t[1]=n[1]*e[1],t[2]=n[2]*e[2],t}function di(t,n,e){return t[0]=n[0]/e[0],t[1]=n[1]/e[1],t[2]=n[2]/e[2],t}function fi(t,n){return t[0]=Math.ceil(n[0]),t[1]=Math.ceil(n[1]),t[2]=Math.ceil(n[2]),t}function hi(t,n){return t[0]=Math.floor(n[0]),t[1]=Math.floor(n[1]),t[2]=Math.floor(n[2]),t}function _i(t,n,e){return t[0]=Math.min(n[0],e[0]),t[1]=Math.min(n[1],e[1]),t[2]=Math.min(n[2],e[2]),t}function pi(t,n,e){return t[0]=Math.max(n[0],e[0]),t[1]=Math.max(n[1],e[1]),t[2]=Math.max(n[2],e[2]),t}function bi(t,n){return t[0]=Math.round(n[0]),t[1]=Math.round(n[1]),t[2]=Math.round(n[2]),t}function vi(t,n,e){return t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t}function xi(t,n,e,r){return t[0]=n[0]+e[0]*r,t[1]=n[1]+e[1]*r,t[2]=n[2]+e[2]*r,t}function mi(t,n){var e=n[0]-t[0],r=n[1]-t[1],a=n[2]-t[2];return Math.hypot(e,r,a)}function ji(t,n){var e=n[0]-t[0],r=n[1]-t[1],a=n[2]-t[2];return e*e+r*r+a*a}function gi(t){var n=t[0],e=t[1],r=t[2];return n*n+e*e+r*r}function wi(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t}function yi(t,n){return t[0]=1/n[0],t[1]=1/n[1],t[2]=1/n[2],t}function Oi(t,n){var e=n[0],r=n[1],a=n[2],o=e*e+r*r+a*a;return o>0&&(o=1/Math.sqrt(o)),t[0]=n[0]*o,t[1]=n[1]*o,t[2]=n[2]*o,t}function Mi(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]}function ki(t,n,e){var r=n[0],a=n[1],o=n[2],i=e[0],c=e[1],s=e[2];return t[0]=a*s-o*c,t[1]=o*i-r*s,t[2]=r*c-a*i,t}function Ti(t,n,e,r){var a=n[0],o=n[1],i=n[2];return t[0]=a+r*(e[0]-a),t[1]=o+r*(e[1]-o),t[2]=i+r*(e[2]-i),t}function zi(t,n,e,r,a,o){var i=o*o,c=i*(2*o-3)+1,s=i*(o-2)+o,u=i*(o-1),l=i*(3-2*o);return t[0]=n[0]*c+e[0]*s+r[0]*u+a[0]*l,t[1]=n[1]*c+e[1]*s+r[1]*u+a[1]*l,t[2]=n[2]*c+e[2]*s+r[2]*u+a[2]*l,t}function Ei(t,n,e,r,a,o){var i=1-o,c=i*i,s=o*o,u=c*i,l=3*o*c,d=3*s*i,f=s*o;return t[0]=n[0]*u+e[0]*l+r[0]*d+a[0]*f,t[1]=n[1]*u+e[1]*l+r[1]*d+a[1]*f,t[2]=n[2]*u+e[2]*l+r[2]*d+a[2]*f,t}function Si(t,n){n=n||1;var e=2*Ea()*Math.PI,r=2*Ea()-1,a=Math.sqrt(1-r*r)*n;return t[0]=Math.cos(e)*a,t[1]=Math.sin(e)*a,t[2]=r*n,t}function Ai(t,n,e){var r=n[0],a=n[1],o=n[2],i=e[3]*r+e[7]*a+e[11]*o+e[15];return i=i||1,t[0]=(e[0]*r+e[4]*a+e[8]*o+e[12])/i,t[1]=(e[1]*r+e[5]*a+e[9]*o+e[13])/i,t[2]=(e[2]*r+e[6]*a+e[10]*o+e[14])/i,t}function Ci(t,n,e){var r=n[0],a=n[1],o=n[2];return t[0]=r*e[0]+a*e[3]+o*e[6],t[1]=r*e[1]+a*e[4]+o*e[7],t[2]=r*e[2]+a*e[5]+o*e[8],t}function Di(t,n,e){var r=e[0],a=e[1],o=e[2],i=e[3],c=n[0],s=n[1],u=n[2],l=a*u-o*s,d=o*c-r*u,f=r*s-a*c,h=a*f-o*d,_=o*l-r*f,p=r*d-a*l,b=2*i;return l*=b,d*=b,f*=b,h*=2,_*=2,p*=2,t[0]=c+l+h,t[1]=s+d+_,t[2]=u+f+p,t}function Ri(t,n,e,r){var a=[],o=[];return a[0]=n[0]-e[0],a[1]=n[1]-e[1],a[2]=n[2]-e[2],o[0]=a[0],o[1]=a[1]*Math.cos(r)-a[2]*Math.sin(r),o[2]=a[1]*Math.sin(r)+a[2]*Math.cos(r),t[0]=o[0]+e[0],t[1]=o[1]+e[1],t[2]=o[2]+e[2],t}function Ui(t,n,e,r){var a=[],o=[];return a[0]=n[0]-e[0],a[1]=n[1]-e[1],a[2]=n[2]-e[2],o[0]=a[2]*Math.sin(r)+a[0]*Math.cos(r),o[1]=a[1],o[2]=a[2]*Math.cos(r)-a[0]*Math.sin(r),t[0]=o[0]+e[0],t[1]=o[1]+e[1],t[2]=o[2]+e[2],t}function Li(t,n,e,r){var a=[],o=[];return a[0]=n[0]-e[0],a[1]=n[1]-e[1],a[2]=n[2]-e[2],o[0]=a[0]*Math.cos(r)-a[1]*Math.sin(r),o[1]=a[0]*Math.sin(r)+a[1]*Math.cos(r),o[2]=a[2],t[0]=o[0]+e[0],t[1]=o[1]+e[1],t[2]=o[2]+e[2],t}function Ii(t,n){var e=t[0],r=t[1],a=t[2],o=n[0],i=n[1],c=n[2],s=Math.sqrt(e*e+r*r+a*a)*Math.sqrt(o*o+i*i+c*c),u=s&&Mi(t,n)/s;return Math.acos(Math.min(Math.max(u,-1),1))}function Pi(t){return t[0]=0,t[1]=0,t[2]=0,t}function Fi(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function qi(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]}function Ni(t,n){var e=t[0],r=t[1],a=t[2],o=n[0],i=n[1],c=n[2];return Math.abs(e-o)<=Ta*Math.max(1,Math.abs(e),Math.abs(o))&&Math.abs(r-i)<=Ta*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(a-c)<=Ta*Math.max(1,Math.abs(a),Math.abs(c))}var Xi=ui,Bi=li,Vi=di,Wi=mi,Yi=ji,Hi=ai,Gi=gi,Ki=function(){var t=ei();return function(n,e,r,a,o,i){var c,s;for(e||(e=3),r||(r=0),s=a?Math.min(a*e+r,n.length):n.length,c=r;c<s;c+=e)t[0]=n[c],t[1]=n[c+1],t[2]=n[c+2],o(t,t,i),n[c]=t[0],n[c+1]=t[1],n[c+2]=t[2];return n}}();function Ji(){var t=new za(4);return za!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Qi(t){var n=new za(4);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n}function Zi(t,n,e,r){var a=new za(4);return a[0]=t,a[1]=n,a[2]=e,a[3]=r,a}function $i(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t}function tc(t,n,e,r,a){return t[0]=n,t[1]=e,t[2]=r,t[3]=a,t}function nc(t,n,e){return t[0]=n[0]+e[0],t[1]=n[1]+e[1],t[2]=n[2]+e[2],t[3]=n[3]+e[3],t}function ec(t,n,e){return t[0]=n[0]-e[0],t[1]=n[1]-e[1],t[2]=n[2]-e[2],t[3]=n[3]-e[3],t}function rc(t,n,e){return t[0]=n[0]*e[0],t[1]=n[1]*e[1],t[2]=n[2]*e[2],t[3]=n[3]*e[3],t}function ac(t,n,e){return t[0]=n[0]/e[0],t[1]=n[1]/e[1],t[2]=n[2]/e[2],t[3]=n[3]/e[3],t}function oc(t,n){return t[0]=Math.ceil(n[0]),t[1]=Math.ceil(n[1]),t[2]=Math.ceil(n[2]),t[3]=Math.ceil(n[3]),t}function ic(t,n){return t[0]=Math.floor(n[0]),t[1]=Math.floor(n[1]),t[2]=Math.floor(n[2]),t[3]=Math.floor(n[3]),t}function cc(t,n,e){return t[0]=Math.min(n[0],e[0]),t[1]=Math.min(n[1],e[1]),t[2]=Math.min(n[2],e[2]),t[3]=Math.min(n[3],e[3]),t}function sc(t,n,e){return t[0]=Math.max(n[0],e[0]),t[1]=Math.max(n[1],e[1]),t[2]=Math.max(n[2],e[2]),t[3]=Math.max(n[3],e[3]),t}function uc(t,n){return t[0]=Math.round(n[0]),t[1]=Math.round(n[1]),t[2]=Math.round(n[2]),t[3]=Math.round(n[3]),t}function lc(t,n,e){return t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t[3]=n[3]*e,t}function dc(t,n,e,r){return t[0]=n[0]+e[0]*r,t[1]=n[1]+e[1]*r,t[2]=n[2]+e[2]*r,t[3]=n[3]+e[3]*r,t}function fc(t,n){var e=n[0]-t[0],r=n[1]-t[1],a=n[2]-t[2],o=n[3]-t[3];return Math.hypot(e,r,a,o)}function hc(t,n){var e=n[0]-t[0],r=n[1]-t[1],a=n[2]-t[2],o=n[3]-t[3];return e*e+r*r+a*a+o*o}function _c(t){var n=t[0],e=t[1],r=t[2],a=t[3];return Math.hypot(n,e,r,a)}function pc(t){var n=t[0],e=t[1],r=t[2],a=t[3];return n*n+e*e+r*r+a*a}function bc(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=-n[3],t}function vc(t,n){return t[0]=1/n[0],t[1]=1/n[1],t[2]=1/n[2],t[3]=1/n[3],t}function xc(t,n){var e=n[0],r=n[1],a=n[2],o=n[3],i=e*e+r*r+a*a+o*o;return i>0&&(i=1/Math.sqrt(i)),t[0]=e*i,t[1]=r*i,t[2]=a*i,t[3]=o*i,t}function mc(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]+t[3]*n[3]}function jc(t,n,e,r){var a=e[0]*r[1]-e[1]*r[0],o=e[0]*r[2]-e[2]*r[0],i=e[0]*r[3]-e[3]*r[0],c=e[1]*r[2]-e[2]*r[1],s=e[1]*r[3]-e[3]*r[1],u=e[2]*r[3]-e[3]*r[2],l=n[0],d=n[1],f=n[2],h=n[3];return t[0]=d*u-f*s+h*c,t[1]=-l*u+f*i-h*o,t[2]=l*s-d*i+h*a,t[3]=-l*c+d*o-f*a,t}function gc(t,n,e,r){var a=n[0],o=n[1],i=n[2],c=n[3];return t[0]=a+r*(e[0]-a),t[1]=o+r*(e[1]-o),t[2]=i+r*(e[2]-i),t[3]=c+r*(e[3]-c),t}function wc(t,n){var e,r,a,o,i,c;n=n||1;do{i=(e=2*Ea()-1)*e+(r=2*Ea()-1)*r}while(i>=1);do{c=(a=2*Ea()-1)*a+(o=2*Ea()-1)*o}while(c>=1);var s=Math.sqrt((1-i)/c);return t[0]=n*e,t[1]=n*r,t[2]=n*a*s,t[3]=n*o*s,t}function yc(t,n,e){var r=n[0],a=n[1],o=n[2],i=n[3];return t[0]=e[0]*r+e[4]*a+e[8]*o+e[12]*i,t[1]=e[1]*r+e[5]*a+e[9]*o+e[13]*i,t[2]=e[2]*r+e[6]*a+e[10]*o+e[14]*i,t[3]=e[3]*r+e[7]*a+e[11]*o+e[15]*i,t}function Oc(t,n,e){var r=n[0],a=n[1],o=n[2],i=e[0],c=e[1],s=e[2],u=e[3],l=u*r+c*o-s*a,d=u*a+s*r-i*o,f=u*o+i*a-c*r,h=-i*r-c*a-s*o;return t[0]=l*u+h*-i+d*-s-f*-c,t[1]=d*u+h*-c+f*-i-l*-s,t[2]=f*u+h*-s+l*-c-d*-i,t[3]=n[3],t}function Mc(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function kc(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function Tc(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]}function zc(t,n){var e=t[0],r=t[1],a=t[2],o=t[3],i=n[0],c=n[1],s=n[2],u=n[3];return Math.abs(e-i)<=Ta*Math.max(1,Math.abs(e),Math.abs(i))&&Math.abs(r-c)<=Ta*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(a-s)<=Ta*Math.max(1,Math.abs(a),Math.abs(s))&&Math.abs(o-u)<=Ta*Math.max(1,Math.abs(o),Math.abs(u))}var Ec=ec,Sc=rc,Ac=ac,Cc=fc,Dc=hc,Rc=_c,Uc=pc,Lc=function(){var t=Ji();return function(n,e,r,a,o,i){var c,s;for(e||(e=4),r||(r=0),s=a?Math.min(a*e+r,n.length):n.length,c=r;c<s;c+=e)t[0]=n[c],t[1]=n[c+1],t[2]=n[c+2],t[3]=n[c+3],o(t,t,i),n[c]=t[0],n[c+1]=t[1],n[c+2]=t[2],n[c+3]=t[3];return n}}();function Ic(){var t=new za(4);return za!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Pc(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Fc(t,n,e){e*=.5;var r=Math.sin(e);return t[0]=r*n[0],t[1]=r*n[1],t[2]=r*n[2],t[3]=Math.cos(e),t}function qc(t,n){var e=2*Math.acos(n[3]),r=Math.sin(e/2);return r>Ta?(t[0]=n[0]/r,t[1]=n[1]/r,t[2]=n[2]/r):(t[0]=1,t[1]=0,t[2]=0),e}function Nc(t,n){var e=ls(t,n);return Math.acos(2*e*e-1)}function Xc(t,n,e){var r=n[0],a=n[1],o=n[2],i=n[3],c=e[0],s=e[1],u=e[2],l=e[3];return t[0]=r*l+i*c+a*u-o*s,t[1]=a*l+i*s+o*c-r*u,t[2]=o*l+i*u+r*s-a*c,t[3]=i*l-r*c-a*s-o*u,t}function Bc(t,n,e){e*=.5;var r=n[0],a=n[1],o=n[2],i=n[3],c=Math.sin(e),s=Math.cos(e);return t[0]=r*s+i*c,t[1]=a*s+o*c,t[2]=o*s-a*c,t[3]=i*s-r*c,t}function Vc(t,n,e){e*=.5;var r=n[0],a=n[1],o=n[2],i=n[3],c=Math.sin(e),s=Math.cos(e);return t[0]=r*s-o*c,t[1]=a*s+i*c,t[2]=o*s+r*c,t[3]=i*s-a*c,t}function Wc(t,n,e){e*=.5;var r=n[0],a=n[1],o=n[2],i=n[3],c=Math.sin(e),s=Math.cos(e);return t[0]=r*s+a*c,t[1]=a*s-r*c,t[2]=o*s+i*c,t[3]=i*s-o*c,t}function Yc(t,n){var e=n[0],r=n[1],a=n[2];return t[0]=e,t[1]=r,t[2]=a,t[3]=Math.sqrt(Math.abs(1-e*e-r*r-a*a)),t}function Hc(t,n){var e=n[0],r=n[1],a=n[2],o=n[3],i=Math.sqrt(e*e+r*r+a*a),c=Math.exp(o),s=i>0?c*Math.sin(i)/i:0;return t[0]=e*s,t[1]=r*s,t[2]=a*s,t[3]=c*Math.cos(i),t}function Gc(t,n){var e=n[0],r=n[1],a=n[2],o=n[3],i=Math.sqrt(e*e+r*r+a*a),c=i>0?Math.atan2(i,o)/i:0;return t[0]=e*c,t[1]=r*c,t[2]=a*c,t[3]=.5*Math.log(e*e+r*r+a*a+o*o),t}function Kc(t,n,e){return Gc(t,n),us(t,t,e),Hc(t,t),t}function Jc(t,n,e,r){var a,o,i,c,s,u=n[0],l=n[1],d=n[2],f=n[3],h=e[0],_=e[1],p=e[2],b=e[3];return(o=u*h+l*_+d*p+f*b)<0&&(o=-o,h=-h,_=-_,p=-p,b=-b),1-o>Ta?(a=Math.acos(o),i=Math.sin(a),c=Math.sin((1-r)*a)/i,s=Math.sin(r*a)/i):(c=1-r,s=r),t[0]=c*u+s*h,t[1]=c*l+s*_,t[2]=c*d+s*p,t[3]=c*f+s*b,t}function Qc(t){var n=Ea(),e=Ea(),r=Ea(),a=Math.sqrt(1-n),o=Math.sqrt(n);return t[0]=a*Math.sin(2*Math.PI*e),t[1]=a*Math.cos(2*Math.PI*e),t[2]=o*Math.sin(2*Math.PI*r),t[3]=o*Math.cos(2*Math.PI*r),t}function Zc(t,n){var e=n[0],r=n[1],a=n[2],o=n[3],i=e*e+r*r+a*a+o*o,c=i?1/i:0;return t[0]=-e*c,t[1]=-r*c,t[2]=-a*c,t[3]=o*c,t}function $c(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=n[3],t}function ts(t,n){var e,r=n[0]+n[4]+n[8];if(r>0)e=Math.sqrt(r+1),t[3]=.5*e,e=.5/e,t[0]=(n[5]-n[7])*e,t[1]=(n[6]-n[2])*e,t[2]=(n[1]-n[3])*e;else{var a=0;n[4]>n[0]&&(a=1),n[8]>n[3*a+a]&&(a=2);var o=(a+1)%3,i=(a+2)%3;e=Math.sqrt(n[3*a+a]-n[3*o+o]-n[3*i+i]+1),t[a]=.5*e,e=.5/e,t[3]=(n[3*o+i]-n[3*i+o])*e,t[o]=(n[3*o+a]+n[3*a+o])*e,t[i]=(n[3*i+a]+n[3*a+i])*e}return t}function ns(t,n,e,r){var a=.5*Math.PI/180;n*=a,e*=a,r*=a;var o=Math.sin(n),i=Math.cos(n),c=Math.sin(e),s=Math.cos(e),u=Math.sin(r),l=Math.cos(r);return t[0]=o*s*l-i*c*u,t[1]=i*c*l+o*s*u,t[2]=i*s*u-o*c*l,t[3]=i*s*l+o*c*u,t}function es(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var rs=Qi,as=Zi,os=$i,is=tc,cs=nc,ss=Xc,us=lc,ls=mc,ds=gc,fs=_c,hs=fs,_s=pc,ps=_s,bs=xc,vs=Tc,xs=zc,ms=function(){var t=ei(),n=oi(1,0,0),e=oi(0,1,0);return function(r,a,o){var i=Mi(a,o);return i<-.999999?(ki(t,n,a),Hi(t)<1e-6&&ki(t,e,a),Oi(t,t),Fc(r,t,Math.PI),r):i>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(ki(t,a,o),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=1+i,bs(r,r))}}(),js=function(){var t=Ic(),n=Ic();return function(e,r,a,o,i,c){return Jc(t,r,i,c),Jc(n,a,o,c),Jc(e,t,n,2*c*(1-c)),e}}(),gs=function(){var t=Sa();return function(n,e,r,a){return t[0]=r[0],t[3]=r[1],t[6]=r[2],t[1]=a[0],t[4]=a[1],t[7]=a[2],t[2]=-e[0],t[5]=-e[1],t[8]=-e[2],bs(n,ts(n,t))}}();function ws(){var t=new za(2);return za!=Float32Array&&(t[0]=0,t[1]=0),t}function ys(t){var n=new za(2);return n[0]=t[0],n[1]=t[1],n}function Os(t,n){var e=new za(2);return e[0]=t,e[1]=n,e}function Ms(t,n){return t[0]=n[0],t[1]=n[1],t}function ks(t,n,e){return t[0]=n,t[1]=e,t}function Ts(t,n,e){return t[0]=n[0]+e[0],t[1]=n[1]+e[1],t}function zs(t,n,e){return t[0]=n[0]-e[0],t[1]=n[1]-e[1],t}function Es(t,n,e){return t[0]=n[0]*e[0],t[1]=n[1]*e[1],t}function Ss(t,n,e){return t[0]=n[0]/e[0],t[1]=n[1]/e[1],t}function As(t,n){return t[0]=Math.ceil(n[0]),t[1]=Math.ceil(n[1]),t}function Cs(t,n){return t[0]=Math.floor(n[0]),t[1]=Math.floor(n[1]),t}function Ds(t,n,e){return t[0]=Math.min(n[0],e[0]),t[1]=Math.min(n[1],e[1]),t}function Rs(t,n,e){return t[0]=Math.max(n[0],e[0]),t[1]=Math.max(n[1],e[1]),t}function Us(t,n){return t[0]=Math.round(n[0]),t[1]=Math.round(n[1]),t}function Ls(t,n,e){return t[0]=n[0]*e,t[1]=n[1]*e,t}function Is(t,n,e,r){return t[0]=n[0]+e[0]*r,t[1]=n[1]+e[1]*r,t}function Ps(t,n){var e=n[0]-t[0],r=n[1]-t[1];return Math.hypot(e,r)}function Fs(t,n){var e=n[0]-t[0],r=n[1]-t[1];return e*e+r*r}function qs(t){var n=t[0],e=t[1];return Math.hypot(n,e)}function Ns(t){var n=t[0],e=t[1];return n*n+e*e}function Xs(t,n){return t[0]=-n[0],t[1]=-n[1],t}function Bs(t,n){return t[0]=1/n[0],t[1]=1/n[1],t}function Vs(t,n){var e=n[0],r=n[1],a=e*e+r*r;return a>0&&(a=1/Math.sqrt(a)),t[0]=n[0]*a,t[1]=n[1]*a,t}function Ws(t,n){return t[0]*n[0]+t[1]*n[1]}function Ys(t,n,e){var r=n[0]*e[1]-n[1]*e[0];return t[0]=t[1]=0,t[2]=r,t}function Hs(t,n,e,r){var a=n[0],o=n[1];return t[0]=a+r*(e[0]-a),t[1]=o+r*(e[1]-o),t}function Gs(t,n){n=n||1;var e=2*Ea()*Math.PI;return t[0]=Math.cos(e)*n,t[1]=Math.sin(e)*n,t}function Ks(t,n,e){var r=n[0],a=n[1];return t[0]=e[0]*r+e[2]*a,t[1]=e[1]*r+e[3]*a,t}function Js(t,n,e){var r=n[0],a=n[1];return t[0]=e[0]*r+e[2]*a+e[4],t[1]=e[1]*r+e[3]*a+e[5],t}function Qs(t,n,e){var r=n[0],a=n[1];return t[0]=e[0]*r+e[3]*a+e[6],t[1]=e[1]*r+e[4]*a+e[7],t}function Zs(t,n,e){var r=n[0],a=n[1];return t[0]=e[0]*r+e[4]*a+e[12],t[1]=e[1]*r+e[5]*a+e[13],t}function $s(t,n,e,r){var a=n[0]-e[0],o=n[1]-e[1],i=Math.sin(r),c=Math.cos(r);return t[0]=a*c-o*i+e[0],t[1]=a*i+o*c+e[1],t}function tu(t,n){var e=t[0],r=t[1],a=n[0],o=n[1],i=Math.sqrt(e*e+r*r)*Math.sqrt(a*a+o*o),c=i&&(e*a+r*o)/i;return Math.acos(Math.min(Math.max(c,-1),1))}function nu(t){return t[0]=0,t[1]=0,t}function eu(t){return"vec2("+t[0]+", "+t[1]+")"}function ru(t,n){return t[0]===n[0]&&t[1]===n[1]}function au(t,n){var e=t[0],r=t[1],a=n[0],o=n[1];return Math.abs(e-a)<=Ta*Math.max(1,Math.abs(e),Math.abs(a))&&Math.abs(r-o)<=Ta*Math.max(1,Math.abs(r),Math.abs(o))}var ou=qs,iu=zs,cu=Es,su=Ss,uu=Ps,lu=Fs,du=Ns,fu=function(){var t=ws();return function(n,e,r,a,o,i){var c,s;for(e||(e=2),r||(r=0),s=a?Math.min(a*e+r,n.length):n.length,c=r;c<s;c+=e)t[0]=n[c],t[1]=n[c+1],o(t,t,i),n[c]=t[0],n[c+1]=t[1];return n}}(),hu=function(t,n,e){var r=this;this.program=_u(t,n,e);var a=/uniform[^;]+[ ](\w+);/g,o=/uniform[^;]+[ ](\w+);/;this.uniforms={};var i=n.match(a),c=e.match(a);for(var s in i&&i.forEach((function(t){var n=t.match(o);r.uniforms[n[1]]=-1})),c&&c.forEach((function(t){var n=t.match(o);r.uniforms[n[1]]=-1})),this.uniforms)this.uniforms[s]=t.getUniformLocation(this.program,s)};hu.prototype.use=function(t){t.useProgram(this.program)};var _u=function(t,n,e){var r=t.createShader(t.VERTEX_SHADER);if(t.shaderSource(r,n),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))return alert("Vertex shader failed to compile, see console for log"),console.log(t.getShaderInfoLog(r)),null;var a=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(a,e),t.compileShader(a),!t.getShaderParameter(a,t.COMPILE_STATUS))return alert("Fragment shader failed to compile, see console for log"),console.log(t.getShaderInfoLog(a)),null;var o=t.createProgram();return t.attachShader(o,r),t.attachShader(o,a),t.linkProgram(o),t.getProgramParameter(o,t.LINK_STATUS)?o:(alert("Shader failed to link, see console for log"),console.log(t.getProgramInfoLog(o)),null)},pu=function(t,n,e,r,a){var o=s.set(s.create(),t[0],t[1],t[2]),u=s.set(s.create(),n[0],n[1],n[2]),d=s.set(s.create(),e[0],e[1],e[2]);s.normalize(d,d);var f=s.sub(s.create(),u,o),h=s.len(f);s.normalize(f,f);var _=s.cross(s.create(),f,d);s.normalize(_,_);var p=s.cross(s.create(),_,f);s.normalize(p,p),s.cross(_,f,p),s.normalize(_,_),this.zoomSpeed=r,this.invScreen=[1/a[0],1/a[1]],this.centerTranslation=c.fromTranslation(c.create(),n),c.invert(this.centerTranslation,this.centerTranslation);var b=s.set(s.create(),0,0,-1*h);this.translation=c.fromTranslation(c.create(),b);var v=i.fromValues(_[0],_[1],_[2],p[0],p[1],p[2],-f[0],-f[1],-f[2]);i.transpose(v,v),this.rotation=l.fromMat3(l.create(),v),l.normalize(this.rotation,this.rotation),this.camera=c.create(),this.invCamera=c.create(),this.updateCameraMatrix()};pu.prototype.rotate=function(t,n){var e=d.set(d.create(),vu(2*t[0]*this.invScreen[0]-1,-1,1),vu(1-2*t[1]*this.invScreen[1],-1,1)),r=d.set(d.create(),vu(2*n[0]*this.invScreen[0]-1,-1,1),vu(1-2*n[1]*this.invScreen[1],-1,1)),a=bu(e),o=bu(r);this.rotation=l.mul(this.rotation,a,this.rotation),this.rotation=l.mul(this.rotation,o,this.rotation),this.updateCameraMatrix()},pu.prototype.zoom=function(t){var n=s.set(s.create(),0,0,t*this.invScreen[1]*this.zoomSpeed),e=c.fromTranslation(c.create(),n);this.translation=c.mul(this.translation,e,this.translation),this.translation[14]>=-.2&&(this.translation[14]=-.2),this.updateCameraMatrix()},pu.prototype.pan=function(t){var n=u.set(u.create(),t[0]*this.invScreen[0]*Math.abs(this.translation[14]),t[1]*this.invScreen[1]*Math.abs(this.translation[14]),0,0),e=u.transformMat4(u.create(),n,this.invCamera),r=c.fromTranslation(c.create(),e);this.centerTranslation=c.mul(this.centerTranslation,r,this.centerTranslation),this.updateCameraMatrix()},pu.prototype.updateCameraMatrix=function(){var t=c.fromQuat(c.create(),this.rotation);this.camera=c.mul(this.camera,t,this.centerTranslation),this.camera=c.mul(this.camera,this.translation,this.camera),this.invCamera=c.invert(this.invCamera,this.camera)},pu.prototype.eyePos=function(){return[this.invCamera[12],this.invCamera[13],this.invCamera[14]]},pu.prototype.eyeDir=function(){var t=u.set(u.create(),0,0,-1,0);return t=u.transformMat4(t,t,this.invCamera),[(t=u.normalize(t,t))[0],t[1],t[2]]},pu.prototype.upDir=function(){var t=u.set(u.create(),0,1,0,0);return t=u.transformMat4(t,t,this.invCamera),[(t=u.normalize(t,t))[0],t[1],t[2]]};var bu=function(t){var n=d.dot(t,t);if(n<=1)return l.set(l.create(),t[0],t[1],Math.sqrt(1-n),0);var e=d.normalize(d.create(),t);return l.set(l.create(),e[0],e[1],0,0)},vu=function(t,n,e){return t<n?n:t>e?e:t},xu=function(t,n){var e=[n[0]-t[0],n[1]-t[1]];return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2))},mu=function(t,n){this.len=0,this.capacity=t,"uint8"==n?this.buffer=new Uint8Array(t):"int8"==n?this.buffer=new Int8Array(t):"uint16"==n?this.buffer=new Uint16Array(t):"int16"==n?this.buffer=new Int16Array(t):"uint32"==n?this.buffer=new Uint32Array(t):"int32"==n?this.buffer=new Int32Array(t):"float32"==n?this.buffer=new Float32Array(t):"float64"==n?this.buffer=new Float64Array(t):console.log("ERROR: unsupported type "+n)};mu.prototype.append=function(t){if(this.len+t.length>=this.capacity){var n=Math.floor(1.5*this.capacity),e=new this.buffer.constructor(n);e.set(this.buffer),this.capacity=n,this.buffer=e}this.buffer.set(t,this.len),this.len+=t.length},mu.prototype.clear=function(){this.len=0},mu.prototype.stride=function(){return this.buffer.BYTES_PER_ELEMENT},mu.prototype.view=function(t,n){return new this.buffer.constructor(this.buffer.buffer,t,n)};var ju=function(t){this.camera=t,this.mousemove=null,this.press=null,this.wheel=null,this.twoFingerDrag=null,this.pinch=null};ju.prototype.registerForCanvas=function(t){var n=null,e=this;t.addEventListener("mousemove",(function(r){r.preventDefault();var a=t.getBoundingClientRect(),o=[r.clientX-a.left,r.clientY-a.top];n?e.mousemove&&e.mousemove(n,o,r):n=[r.clientX-a.left,r.clientY-a.top],n=o})),t.addEventListener("mousedown",(function(n){n.preventDefault();var r=t.getBoundingClientRect(),a=[n.clientX-r.left,n.clientY-r.top];e.press&&e.press(a,n)})),t.addEventListener("wheel",(function(t){t.preventDefault(),e.wheel&&e.wheel(-t.deltaY)})),t.oncontextmenu=function(t){t.preventDefault()};var r={};t.addEventListener("touchstart",(function(n){var a=t.getBoundingClientRect();n.preventDefault();for(var o=0;o<n.changedTouches.length;++o){var i=n.changedTouches[o];r[i.identifier]=[i.clientX-a.left,i.clientY-a.top],1==n.changedTouches.length&&e.press&&e.press(r[i.identifier],n)}})),t.addEventListener("touchmove",(function(n){n.preventDefault();var a=t.getBoundingClientRect();if(1==Object.keys(r).length){if(e.mousemove){var o=n.changedTouches[0],i=r[o.identifier],c=[o.clientX-a.left,o.clientY-a.top];n.buttons=1,e.mousemove(i,c,n)}}else{for(var s={},u=0;u<n.changedTouches.length;++u){s[(o=n.changedTouches[u]).identifier]=[o.clientX-a.left,o.clientY-a.top]}var l=[];for(o in r)o in s||(s[o]=r[o]),l.push(r[o]);var f=[];for(o in s)f.push(s[o]);var h=[d.set(d.create(),f[0][0]-l[0][0],f[0][1]-l[0][1]),d.set(d.create(),f[1][0]-l[1][0],f[1][1]-l[1][1])],_=[d.create(),d.create()];d.normalize(_[0],h[0]),d.normalize(_[1],h[1]);var p=d.set(d.create(),l[1][0]-l[0][0],l[1][1]-l[0][1]);d.normalize(p,p);var b=d.lerp(d.create(),h[0],h[1],.5);d.normalize(b,b);var v=[d.dot(p,_[0]),d.dot(p,_[1])],x=[d.dot(b,_[0]),d.dot(b,_[1])];if(e.pinch&&Math.abs(v[0])>.5&&Math.abs(v[1])>.5&&Math.sign(v[0])!=Math.sign(v[1])){var m=xu(l[0],l[1]),j=xu(f[0],f[1]);e.pinch(j-m)}else if(e.twoFingerDrag&&Math.abs(x[0])>.5&&Math.abs(x[1])>.5&&Math.sign(x[0])==Math.sign(x[1])){var g=d.lerp(d.create(),h[0],h[1],.5);g[1]=-g[1],e.twoFingerDrag(g)}}for(u=0;u<n.changedTouches.length;++u){o=n.changedTouches[u];r[o.identifier]=[o.clientX-a.left,o.clientY-a.top]}}));var a=function(t){t.preventDefault();for(var n=0;n<t.changedTouches.length;++n){var e=t.changedTouches[n];delete r[e.identifier]}};t.addEventListener("touchcancel",a),t.addEventListener("touchend",a)};var gu=[1,1,0,0,1,0,1,1,1,0,1,1,0,0,1,0,1,0,0,0,0,1,1,0,1,0,0,1,1,1,1,0,1,0,0,1,1,0,0,0,0,0],wu=Object(v.b)((function(t){return{shape_x:r.get_shape_x(t),shape_y:r.get_shape_y(t),shape_z:r.get_shape_z(t),scale_x:r.get_scale_x(t),scale_y:r.get_scale_y(t),scale_z:r.get_scale_z(t),height:r.get_shape_y(t)*r.get_scale_y(t)+r.get_shape_z(t)*r.get_scale_z(t),width:r.get_shape_x(t)*r.get_scale_x(t)+r.get_shape_z(t)*r.get_scale_z(t),data_url:r.get_vol_url(t),x:r.get_x(t),y:r.get_y(t),z:r.get_z(t),LUT:r.get_LUT(t)}})),yu=function(t){Object(ta.a)(e,t);var n=Object(na.a)(e);function e(t){var r;return Object(Qr.a)(this,e),(r=n.call(this,t)).state=void 0,r.abort_controller=void 0,r.canvas=null,r.gl=null,r.shader=null,r.volumeTexture=null,r.proj=c.create(),r.camera=new pu(s.create(),s.create(),s.create(),2,[500,500]),r.projView=c.create(),r.targetFrameTime=50,r.samplingRate=1,r.WIDTH=640,r.HEIGHT=480,r.fetch_and_draw=function(){r.abort_controller.abort(),r.abort_controller=new AbortController,G(r.props.data_url,r.abort_controller.signal).then((function(t){return r.setState({data:t})})).then(r.draw_to_canvas)},r.draw_to_canvas=function(){if(null!==r.state.data&&void 0!==r.state.data&&0!==r.props.width&&0!==r.props.height&&null!==r.gl&&null!==r.camera){var t,n,e=r.gl,a=[r.props.shape_x,r.props.shape_y,r.props.shape_z],o=(t=r.state.data,n=r.props.LUT,t.map((function(t){return gt(t,n.green)}))),i=e.createTexture();e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_3D,i),e.texStorage3D(e.TEXTURE_3D,1,e.R8,a[0],a[1],a[2]),e.texParameteri(e.TEXTURE_3D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_3D,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_3D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_3D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texSubImage3D(e.TEXTURE_3D,0,0,0,0,a[0],a[1],a[2],e.RED,e.UNSIGNED_BYTE,o);var s=Math.max(a[0],Math.max(a[1],a[2])),u=[a[0]/s*r.props.scale_x,a[1]/s*r.props.scale_y,a[2]/s*r.props.scale_z];e.uniform3iv(r.shader.uniforms.volume_dims,a),e.uniform3fv(r.shader.uniforms.volume_scale,u),r.volumeTexture?(e.deleteTexture(r.volumeTexture),r.volumeTexture=i):(r.volumeTexture=i,setInterval((function(){if(!document.hidden){var t=new Date;e.clearColor(0,0,0,1),e.clear(e.COLOR_BUFFER_BIT),r.projView=c.mul(r.projView,r.proj,r.camera.camera),e.uniformMatrix4fv(r.shader.uniforms.proj_view,!1,r.projView);var n=[r.camera.invCamera[12],r.camera.invCamera[13],r.camera.invCamera[14]];e.uniform3fv(r.shader.uniforms.eye_pos,n),e.drawArrays(e.TRIANGLE_STRIP,0,gu.length/3),e.finish();var a=((new Date).getTime()-t.getTime())/r.targetFrameTime;r.samplingRate<a&&(r.samplingRate=.8*r.samplingRate+.2*a,e.uniform1f(r.shader.uniforms.dt_scale,r.samplingRate))}}),r.targetFrameTime))}},r.abort_controller=new AbortController,r.state={data:null},r.WIDTH=t.width,r.HEIGHT=t.height,r.proj=c.perspective(c.create(),60*Math.PI/180,r.WIDTH/r.HEIGHT,.1,100),r.camera=new pu(e.defaultEye,e.center,e.up,2,[r.WIDTH,r.HEIGHT]),r}return Object(Zr.a)(e,[{key:"componentDidMount",value:function(){this.canvas=this.refs.canvas,this.gl=this.canvas.getContext("webgl2");var t=this.gl,n=new ju(this.camera);n.mousemove=function(t,n,e){1===e.buttons?this.camera.rotate(t,n):2===e.buttons&&this.camera.pan([n[0]-t[0],t[1]-n[1]])},n.wheel=function(t){this.camera.zoom(t)},n.pinch=n.wheel,n.twoFingerDrag=function(t){this.camera.pan(t)},n.registerForCanvas(this.canvas);var e=t.createVertexArray();t.bindVertexArray(e);var r=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,new Float32Array(gu),t.STATIC_DRAW),t.enableVertexAttribArray(0),t.vertexAttribPointer(0,3,t.FLOAT,!1,0,0),this.shader=new hu(t,"#version 300 es\n#line 4\nlayout(location=0) in vec3 pos;\nuniform mat4 proj_view;\nuniform vec3 eye_pos;\nuniform vec3 volume_scale;\n\nout vec3 vray_dir;\nflat out vec3 transformed_eye;\n\nvoid main(void) {\n\t// TODO: For non-uniform size volumes we need to transform them differently as well\n\t// to center them properly\n\tvec3 volume_translation = vec3(0.5) - volume_scale * 0.5;\n\tgl_Position = proj_view * vec4(pos * volume_scale + volume_translation, 1);\n\ttransformed_eye = (eye_pos - volume_translation) / volume_scale;\n\tvray_dir = pos - transformed_eye;\n}","#version 300 es\n#line 24\nprecision highp int;\nprecision highp float;\nuniform highp sampler3D volume;\nuniform highp sampler2D colormap;\nuniform ivec3 volume_dims;\nuniform float dt_scale;\n\nin vec3 vray_dir;\nflat in vec3 transformed_eye;\nout vec4 color;\n\nvec2 intersect_box(vec3 orig, vec3 dir) {\n\tconst vec3 box_min = vec3(0);\n\tconst vec3 box_max = vec3(1);\n\tvec3 inv_dir = 1.0 / dir;\n\tvec3 tmin_tmp = (box_min - orig) * inv_dir;\n\tvec3 tmax_tmp = (box_max - orig) * inv_dir;\n\tvec3 tmin = min(tmin_tmp, tmax_tmp);\n\tvec3 tmax = max(tmin_tmp, tmax_tmp);\n\tfloat t0 = max(tmin.x, max(tmin.y, tmin.z));\n\tfloat t1 = min(tmax.x, min(tmax.y, tmax.z));\n\treturn vec2(t0, t1);\n}\n\n// Pseudo-random number gen from\n// http://www.reedbeta.com/blog/quick-and-easy-gpu-random-numbers-in-d3d11/\n// with some tweaks for the range of values\nfloat wang_hash(int seed) {\n\tseed = (seed ^ 61) ^ (seed >> 16);\n\tseed *= 9;\n\tseed = seed ^ (seed >> 4);\n\tseed *= 0x27d4eb2d;\n\tseed = seed ^ (seed >> 15);\n\treturn float(seed % 2147483647) / float(2147483647);\n}\n\nfloat linear_to_srgb(float x) {\n\tif (x <= 0.0031308f) {\n\t\treturn 12.92f * x;\n\t}\n\treturn 1.055f * pow(x, 1.f / 2.4f) - 0.055f;\n}\n\nvoid main(void) {\n\tvec3 ray_dir = normalize(vray_dir);\n\tvec2 t_hit = intersect_box(transformed_eye, ray_dir);\n\tif (t_hit.x > t_hit.y) {\n\t\tdiscard;\n\t}\n\tt_hit.x = max(t_hit.x, 0.0);\n\tvec3 dt_vec = 1.0 / (vec3(volume_dims) * abs(ray_dir));\n\tfloat dt = dt_scale * min(dt_vec.x, min(dt_vec.y, dt_vec.z));\n\tfloat offset = wang_hash(int(gl_FragCoord.x + 640.0 * gl_FragCoord.y));\n\tvec3 p = transformed_eye + (t_hit.x + offset * dt) * ray_dir;\n\tfor (float t = t_hit.x; t < t_hit.y; t += dt) {\n\t\tfloat val = texture(volume, p).r;\n\t\tvec4 val_color = vec4(texture(colormap, vec2(val, 0.5)).rgb, val);\n\t\t// Opacity correction\n\t\tval_color.a = 1.0 - pow(1.0 - val_color.a, dt_scale);\n\t\tcolor.rgb += (1.0 - color.a) * val_color.a * val_color.rgb;\n\t\tcolor.a += (1.0 - color.a) * val_color.a;\n\t\tif (color.a >= 0.95) {\n\t\t\tbreak;\n\t\t}\n\t\tp += ray_dir * dt;\n\t}\n    color.r = linear_to_srgb(color.r);\n    color.g = linear_to_srgb(color.g);\n    color.b = linear_to_srgb(color.b);\n}"),this.shader.use(t),t.uniform1i(this.shader.uniforms.volume,0),t.uniform1i(this.shader.uniforms.colormap,1),t.uniform1f(this.shader.uniforms.dt_scale,this.samplingRate),t.enable(t.CULL_FACE),t.cullFace(t.FRONT),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA);var a=new Image;a.onload=function(t,n){return function(){var e=t.createTexture();t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,e),t.texStorage2D(t.TEXTURE_2D,1,t.SRGB8_ALPHA8,180,1),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_R,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,180,1,t.RGBA,t.UNSIGNED_BYTE,a),n()}}(t,this.draw_to_canvas),a.src="webgl_colormaps/samsel-linear-green.png",this.fetch_and_draw()}},{key:"componentDidUpdate",value:function(t){this.props.data_url!==t.data_url?this.fetch_and_draw():this.props.LUT!==t.LUT&&this.draw_to_canvas()}},{key:"render",value:function(){return Object(Xn.jsx)("div",{style:{position:"relative",left:this.props.left,top:this.props.top,right:"0px"},children:Object(Xn.jsx)("canvas",{ref:"canvas",width:this.props.width,height:this.props.height,style:{position:"absolute",left:"0px",top:"0px",zIndex:1}})})}}]),e}(h.Component);yu.defaultEye=s.set(s.create(),.5,.5,1.5),yu.center=s.set(s.create(),.5,.5,.5),yu.up=s.set(s.create(),0,1,0);var Ou=wu(yu),Mu=function(t){return Object(Xn.jsx)(aa.a,{style:{position:"absolute",left:t.left,top:t.top,width:"horizontal"===t.orientation?t.length:0,height:"vertical"===t.orientation?t.length:0},color:"primary",orientation:t.orientation,defaultValue:.5,value:t.flip?1-t.val:t.val,min:0,max:1,step:1e-4,track:!1,scale:t.flip?function(t){return 1-t}:function(t){return t},onChange:function(n,e){return t.handler(t.flip?1-e:e)}})},ku=function(t){return Object(Xn.jsx)(aa.a,{style:{position:"absolute",left:t.left,top:t.top,width:t.length},color:"secondary",orientation:"horizontal",defaultValue:0,value:t.val,min:0,max:t.max_val,track:!1,step:1,onChange:function(n,e){return t.handler(e)}})},Tu=function(t){var n=_.a.useState([0,255]),e=Object(me.a)(n,2),r=e[0],a=e[1];return Object(Xn.jsx)(aa.a,{style:{position:"absolute",left:t.left,top:t.top,width:t.length,color:t.color},value:r,min:0,max:255,onChange:function(n,e){a(e),t.handler(e)},valueLabelDisplay:"auto"})},zu=Object(v.b)((function(t){return{window_state:wt(t),annotations_z:o.get_z_annotations(t),annotations_3D:o.get_annotations_view3D(t),size_x:zt(t)*Dt(t),size_y:Et(t)*Rt(t),size_z:St(t)*Ut(t),x:yt(t),y:Ot(t),z:Mt(t),t_idx:Tt(t),shape_t:At(t),LUT:Lt(t),view:Gt(t)}}),(function(t){return{actions:Object(Un.b)(Object(U.a)({},S),t),saga_actions:Object(Un.b)(Object(U.a)({},kr),t),delete_annotation:function(){return t(re.delete_annotation())}}}))((function(t){var n,e=20,r=20,a=10,o=e+t.size_x+a,i=r+t.size_y+a,c=i+t.size_z,s=o+t.size_z+20,u=o,l=c,d=s,f=20+i-r,h=c+20,p=t.size_x+t.size_z+a,b=s+50,v=p/3-20,x=h+50,m=20+v+50,j=m+v+50,g=x+50;n="vol"===t.view?Object(Xn.jsx)(Ou,{left:e,top:r}):Object(Xn.jsxs)(_.a.Fragment,{children:[Object(Xn.jsx)(fa,{left:e,top:r}),Object(Xn.jsx)(la,{left:o,top:20}),Object(Xn.jsx)(da,{left:20,top:i})]});var w=Object(Xn.jsx)(Mu,{left:20,top:c,length:t.size_x,orientation:"horizontal",flip:!1,val:t.x,handler:t.actions.set_x}),y=Object(Xn.jsx)(Mu,{left:s,top:20,length:t.size_y,orientation:"vertical",flip:!0,val:t.y,handler:t.actions.set_y}),O=Object(Xn.jsx)(Mu,{left:u,top:l,length:t.size_z,orientation:"horizontal",flip:!1,val:t.z,handler:t.actions.set_z}),M=Object(Xn.jsx)(Mu,{left:d,top:f,length:t.size_z,orientation:"vertical",flip:!0,val:t.z,handler:t.actions.set_z}),k=Object(Xn.jsx)(ku,{left:20,top:h,length:p,val:t.t_idx,max_val:t.shape_t-1,handler:t.actions.set_t_idx}),T=Object(Xn.jsx)(Tu,{left:20,top:x,length:v,val:t.LUT.red,color:"red",handler:function(n){var e=Object(me.a)(n,2),r=e[0],a=e[1];return t.actions.set_LUT_color(["red",r,a])}}),z=Object(Xn.jsx)(Tu,{left:m,top:x,length:v,val:t.LUT.green,color:"green",handler:function(n){var e=Object(me.a)(n,2),r=e[0],a=e[1];return t.actions.set_LUT_color(["green",r,a])}}),E=Object(Xn.jsx)(Tu,{left:j,top:x,length:v,val:t.LUT.blue,color:"blue",handler:function(n){var e=Object(me.a)(n,2),r=e[0],a=e[1];return t.actions.set_LUT_color(["blue",r,a])}});return Object(Xn.jsxs)("div",{style:{position:"absolute"},children:[Object(Xn.jsxs)("div",{tabIndex:0,onKeyDown:function(n){var e=String.fromCharCode(n.which),r=n.ctrlKey,a=n.shiftKey;switch(e){case"F":a?t.saga_actions.adjust_t(10):t.saga_actions.adjust_t(1);break;case"D":a?t.saga_actions.adjust_t(-10):t.saga_actions.adjust_t(-1);break;case"V":a?t.actions.set_z(t.z+.2):r?t.actions.set_z(t.z+.02):t.actions.set_z(t.z+.05);break;case"C":a?t.actions.set_z(t.z-.2):r?t.actions.set_z(t.z-.01):t.actions.set_z(t.z-.05);break;case"R":t.actions.adjust_c_idx(1);break;case"E":t.actions.adjust_c_idx(-1);break;case".":t.delete_annotation();break;case"S":r&&t.saga_actions.save();break;case"O":t.actions.toggle_fill_circles();break;case"A":t.actions.toggle_all_annotations();break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"0":r||a||t.saga_actions.rpc_from_key(e)}n.preventDefault()},onKeyUp:function(t){},children:[n,w,y,O,M,k,T,z,E]}),Object(Xn.jsx)(ka,{left:20,top:g}),Object(Xn.jsxs)("div",{style:{position:"absolute",left:b,width:"340px"},children:[Object(Xn.jsx)(Me,{}),Object(Xn.jsx)(Vn,{}),Object(Xn.jsx)(er,{})]})]})})),Eu=function(){return Object(Xn.jsx)("div",{children:Object(Xn.jsx)(zu,{})})},Su=e(108),Au=e.n(Su),Cu={annotation_window:S,annotations:dt,worldlines:ze,provenances:_t},Du=Object(Un.c)({annotation_window:A,annotations:ft,worldlines:Ee,provenances:pt}),Ru=R.a.mark(Uu);function Uu(){return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(L.a)([].concat(Object(f.a)(Kr),Object(f.a)(be),Object(f.a)(Ze),Object(f.a)(Rn)).map((function(t){return t()})));case 2:case"end":return t.stop()}}),Ru)}var Lu={annotation_window:kr,annotations:re,worldlines:Ne,provenances:An},Iu=Object(v.b)((function(t){return{state:t,x_idx:Wt(t)}}),Object(U.a)(Object(U.a)(Object(U.a)(Object(U.a)({},Cu.annotation_window),Cu.annotations),Lu.annotation_window),Lu.annotations))((function(t){var n=t.state,e=t.x_idx,r=Object(Jr.a)(t,["state","x_idx"]),a={bare_state:n,derived_state:{x_idx:e}};return Object(Xn.jsxs)("div",{children:[Object(Xn.jsx)(Au.a,{theme:"monokai",src:a}),Object(Xn.jsx)("br",{}),"Simple Actions:",Object(Xn.jsx)(ra,{name:"set_shape_x",action:r.set_shape_x}),Object(Xn.jsx)(ra,{name:"set_x",action:r.set_x}),Object(Xn.jsx)(ra,{name:"set_t_idx",action:r.set_t_idx}),Object(Xn.jsx)(ra,{name:"adjust_x",action:r.adjust_x}),Object(Xn.jsx)(ra,{name:"set_scale_x",action:r.set_scale_x}),Object(Xn.jsx)("br",{}),"Async Actions:",Object(Xn.jsx)("br",{}),Object(Xn.jsx)("button",{onClick:function(){return r.fetch_state()},children:"fetch_state"}),Object(Xn.jsx)("button",{onClick:function(){return r.insert_annotation_here()},children:"insert_annotation"}),Object(Xn.jsx)(ra,{name:"fetch_annotations",action:r.get_annotations})]})}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Pu=Object(g.a)(),Fu=[].concat(Object(f.a)(Object(j.d)({thunk:!1})),[Pu]),qu=Object(j.a)({reducer:Du,middleware:Fu});Pu.run(Uu);var Nu=Object(w.a)({palette:{type:"dark",primary:O.a,secondary:M.a},typography:{fontFamily:["source-code-pro","-apple-system","BlinkMacSystemFont",'"Segoe UI"',"Roboto",'"Helvetica Neue"',"Arial","sans-serif",'"Apple Color Emoji"','"Segoe UI Emoji"','"Segoe UI Symbol"'].join(",")}});b.a.render(Object(Xn.jsx)(v.a,{store:qu,children:Object(Xn.jsx)(y.a,{theme:Nu,children:Object(Xn.jsx)(x.a,{children:Object(Xn.jsxs)(m.c,{children:[Object(Xn.jsx)(m.a,{exact:!0,path:"/",component:Eu}),Object(Xn.jsx)(m.a,{path:"/AppTest",component:Iu})]})})})}),document.getElementById("root")),qu.dispatch(Lu.annotation_window.fetch_state()),qu.dispatch(Lu.worldlines.get_worldlines()),qu.dispatch(Lu.annotations.get_annotations()),qu.dispatch(Lu.provenances.fetch_provenances()),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))}},[[149,1,2]]]);
//# sourceMappingURL=main.46048464.chunk.js.map