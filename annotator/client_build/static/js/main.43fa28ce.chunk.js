(this["webpackJsonpneuron-tracker"]=this["webpackJsonpneuron-tracker"]||[]).push([[0],{118:function(t,e,n){t.exports=n(141)},127:function(t,e,n){},141:function(t,e,n){"use strict";n.r(e);var r={};n.r(r),n.d(r,"get_state",(function(){return mt})),n.d(r,"get_x",(function(){return vt})),n.d(r,"get_y",(function(){return bt})),n.d(r,"get_z",(function(){return xt})),n.d(r,"get_c_idx",(function(){return gt})),n.d(r,"get_t_idx",(function(){return wt})),n.d(r,"get_shape_x",(function(){return yt})),n.d(r,"get_shape_y",(function(){return Mt})),n.d(r,"get_shape_z",(function(){return jt})),n.d(r,"get_shape_t",(function(){return Ot})),n.d(r,"get_views",(function(){return Et})),n.d(r,"get_scale_x",(function(){return kt})),n.d(r,"get_scale_y",(function(){return Tt})),n.d(r,"get_scale_z",(function(){return zt})),n.d(r,"get_LUT",(function(){return St})),n.d(r,"get_selected_annotation",(function(){return At})),n.d(r,"get_visible_worldlines",(function(){return Ct})),n.d(r,"get_selected_worldline",(function(){return Dt})),n.d(r,"get_active_provenance",(function(){return Rt})),n.d(r,"get_fill_circles",(function(){return Ut})),n.d(r,"get_show_all_annotations",(function(){return Lt})),n.d(r,"get_rpc_list",(function(){return It})),n.d(r,"get_rpc_keybindings",(function(){return Pt})),n.d(r,"get_x_idx",(function(){return Ft})),n.d(r,"get_y_idx",(function(){return qt})),n.d(r,"get_z_idx",(function(){return Nt})),n.d(r,"get_view",(function(){return Xt})),n.d(r,"get_x_url",(function(){return Zt})),n.d(r,"get_y_url",(function(){return $t})),n.d(r,"get_z_url",(function(){return te})),n.d(r,"get_vol_url",(function(){return ee}));var a={};n.r(a),n.d(a,"get_state",(function(){return ae})),n.d(a,"get_worldlines",(function(){return oe})),n.d(a,"get_visible_worldlines",(function(){return ie}));var o={};n.r(o),n.d(o,"get_state",(function(){return ce})),n.d(o,"get_annotation_ids",(function(){return ue})),n.d(o,"get_used_worldline_ids",(function(){return se})),n.d(o,"get_annotations_list",(function(){return le})),n.d(o,"get_visible_annotations",(function(){return fe})),n.d(o,"get_selected_annotation_id",(function(){return de})),n.d(o,"get_selected_annotation",(function(){return he})),n.d(o,"get_annotations_view3D",(function(){return me})),n.d(o,"get_x_annotations",(function(){return be})),n.d(o,"get_y_annotations",(function(){return xe})),n.d(o,"get_z_annotations",(function(){return ge}));var i={};n.r(i),n.d(i,"create",(function(){return ha})),n.d(i,"fromMat4",(function(){return _a})),n.d(i,"clone",(function(){return pa})),n.d(i,"copy",(function(){return ma})),n.d(i,"fromValues",(function(){return va})),n.d(i,"set",(function(){return ba})),n.d(i,"identity",(function(){return xa})),n.d(i,"transpose",(function(){return ga})),n.d(i,"invert",(function(){return wa})),n.d(i,"adjoint",(function(){return ya})),n.d(i,"determinant",(function(){return Ma})),n.d(i,"multiply",(function(){return ja})),n.d(i,"translate",(function(){return Oa})),n.d(i,"rotate",(function(){return Ea})),n.d(i,"scale",(function(){return ka})),n.d(i,"fromTranslation",(function(){return Ta})),n.d(i,"fromRotation",(function(){return za})),n.d(i,"fromScaling",(function(){return Sa})),n.d(i,"fromMat2d",(function(){return Aa})),n.d(i,"fromQuat",(function(){return Ca})),n.d(i,"normalFromMat4",(function(){return Da})),n.d(i,"projection",(function(){return Ra})),n.d(i,"str",(function(){return Ua})),n.d(i,"frob",(function(){return La})),n.d(i,"add",(function(){return Ia})),n.d(i,"subtract",(function(){return Pa})),n.d(i,"multiplyScalar",(function(){return Fa})),n.d(i,"multiplyScalarAndAdd",(function(){return qa})),n.d(i,"exactEquals",(function(){return Na})),n.d(i,"equals",(function(){return Xa})),n.d(i,"mul",(function(){return Ba})),n.d(i,"sub",(function(){return Va}));var c={};n.r(c),n.d(c,"create",(function(){return Wa})),n.d(c,"clone",(function(){return Ya})),n.d(c,"copy",(function(){return Ha})),n.d(c,"fromValues",(function(){return Ga})),n.d(c,"set",(function(){return Ka})),n.d(c,"identity",(function(){return Ja})),n.d(c,"transpose",(function(){return Qa})),n.d(c,"invert",(function(){return Za})),n.d(c,"adjoint",(function(){return $a})),n.d(c,"determinant",(function(){return to})),n.d(c,"multiply",(function(){return eo})),n.d(c,"translate",(function(){return no})),n.d(c,"scale",(function(){return ro})),n.d(c,"rotate",(function(){return ao})),n.d(c,"rotateX",(function(){return oo})),n.d(c,"rotateY",(function(){return io})),n.d(c,"rotateZ",(function(){return co})),n.d(c,"fromTranslation",(function(){return uo})),n.d(c,"fromScaling",(function(){return so})),n.d(c,"fromRotation",(function(){return lo})),n.d(c,"fromXRotation",(function(){return fo})),n.d(c,"fromYRotation",(function(){return ho})),n.d(c,"fromZRotation",(function(){return _o})),n.d(c,"fromRotationTranslation",(function(){return po})),n.d(c,"fromQuat2",(function(){return mo})),n.d(c,"getTranslation",(function(){return vo})),n.d(c,"getScaling",(function(){return bo})),n.d(c,"getRotation",(function(){return xo})),n.d(c,"fromRotationTranslationScale",(function(){return go})),n.d(c,"fromRotationTranslationScaleOrigin",(function(){return wo})),n.d(c,"fromQuat",(function(){return yo})),n.d(c,"frustum",(function(){return Mo})),n.d(c,"perspective",(function(){return jo})),n.d(c,"perspectiveFromFieldOfView",(function(){return Oo})),n.d(c,"ortho",(function(){return Eo})),n.d(c,"lookAt",(function(){return ko})),n.d(c,"targetTo",(function(){return To})),n.d(c,"str",(function(){return zo})),n.d(c,"frob",(function(){return So})),n.d(c,"add",(function(){return Ao})),n.d(c,"subtract",(function(){return Co})),n.d(c,"multiplyScalar",(function(){return Do})),n.d(c,"multiplyScalarAndAdd",(function(){return Ro})),n.d(c,"exactEquals",(function(){return Uo})),n.d(c,"equals",(function(){return Lo})),n.d(c,"mul",(function(){return Io})),n.d(c,"sub",(function(){return Po}));var u={};n.r(u),n.d(u,"create",(function(){return Fo})),n.d(u,"clone",(function(){return qo})),n.d(u,"length",(function(){return No})),n.d(u,"fromValues",(function(){return Xo})),n.d(u,"copy",(function(){return Bo})),n.d(u,"set",(function(){return Vo})),n.d(u,"add",(function(){return Wo})),n.d(u,"subtract",(function(){return Yo})),n.d(u,"multiply",(function(){return Ho})),n.d(u,"divide",(function(){return Go})),n.d(u,"ceil",(function(){return Ko})),n.d(u,"floor",(function(){return Jo})),n.d(u,"min",(function(){return Qo})),n.d(u,"max",(function(){return Zo})),n.d(u,"round",(function(){return $o})),n.d(u,"scale",(function(){return ti})),n.d(u,"scaleAndAdd",(function(){return ei})),n.d(u,"distance",(function(){return ni})),n.d(u,"squaredDistance",(function(){return ri})),n.d(u,"squaredLength",(function(){return ai})),n.d(u,"negate",(function(){return oi})),n.d(u,"inverse",(function(){return ii})),n.d(u,"normalize",(function(){return ci})),n.d(u,"dot",(function(){return ui})),n.d(u,"cross",(function(){return si})),n.d(u,"lerp",(function(){return li})),n.d(u,"hermite",(function(){return fi})),n.d(u,"bezier",(function(){return di})),n.d(u,"random",(function(){return hi})),n.d(u,"transformMat4",(function(){return _i})),n.d(u,"transformMat3",(function(){return pi})),n.d(u,"transformQuat",(function(){return mi})),n.d(u,"rotateX",(function(){return vi})),n.d(u,"rotateY",(function(){return bi})),n.d(u,"rotateZ",(function(){return xi})),n.d(u,"angle",(function(){return gi})),n.d(u,"zero",(function(){return wi})),n.d(u,"str",(function(){return yi})),n.d(u,"exactEquals",(function(){return Mi})),n.d(u,"equals",(function(){return ji})),n.d(u,"sub",(function(){return Oi})),n.d(u,"mul",(function(){return Ei})),n.d(u,"div",(function(){return ki})),n.d(u,"dist",(function(){return Ti})),n.d(u,"sqrDist",(function(){return zi})),n.d(u,"len",(function(){return Si})),n.d(u,"sqrLen",(function(){return Ai})),n.d(u,"forEach",(function(){return Ci}));var s={};n.r(s),n.d(s,"create",(function(){return Di})),n.d(s,"clone",(function(){return Ri})),n.d(s,"fromValues",(function(){return Ui})),n.d(s,"copy",(function(){return Li})),n.d(s,"set",(function(){return Ii})),n.d(s,"add",(function(){return Pi})),n.d(s,"subtract",(function(){return Fi})),n.d(s,"multiply",(function(){return qi})),n.d(s,"divide",(function(){return Ni})),n.d(s,"ceil",(function(){return Xi})),n.d(s,"floor",(function(){return Bi})),n.d(s,"min",(function(){return Vi})),n.d(s,"max",(function(){return Wi})),n.d(s,"round",(function(){return Yi})),n.d(s,"scale",(function(){return Hi})),n.d(s,"scaleAndAdd",(function(){return Gi})),n.d(s,"distance",(function(){return Ki})),n.d(s,"squaredDistance",(function(){return Ji})),n.d(s,"length",(function(){return Qi})),n.d(s,"squaredLength",(function(){return Zi})),n.d(s,"negate",(function(){return $i})),n.d(s,"inverse",(function(){return tc})),n.d(s,"normalize",(function(){return ec})),n.d(s,"dot",(function(){return nc})),n.d(s,"cross",(function(){return rc})),n.d(s,"lerp",(function(){return ac})),n.d(s,"random",(function(){return oc})),n.d(s,"transformMat4",(function(){return ic})),n.d(s,"transformQuat",(function(){return cc})),n.d(s,"zero",(function(){return uc})),n.d(s,"str",(function(){return sc})),n.d(s,"exactEquals",(function(){return lc})),n.d(s,"equals",(function(){return fc})),n.d(s,"sub",(function(){return dc})),n.d(s,"mul",(function(){return hc})),n.d(s,"div",(function(){return _c})),n.d(s,"dist",(function(){return pc})),n.d(s,"sqrDist",(function(){return mc})),n.d(s,"len",(function(){return vc})),n.d(s,"sqrLen",(function(){return bc})),n.d(s,"forEach",(function(){return xc}));var l={};n.r(l),n.d(l,"create",(function(){return gc})),n.d(l,"identity",(function(){return wc})),n.d(l,"setAxisAngle",(function(){return yc})),n.d(l,"getAxisAngle",(function(){return Mc})),n.d(l,"getAngle",(function(){return jc})),n.d(l,"multiply",(function(){return Oc})),n.d(l,"rotateX",(function(){return Ec})),n.d(l,"rotateY",(function(){return kc})),n.d(l,"rotateZ",(function(){return Tc})),n.d(l,"calculateW",(function(){return zc})),n.d(l,"exp",(function(){return Sc})),n.d(l,"ln",(function(){return Ac})),n.d(l,"pow",(function(){return Cc})),n.d(l,"slerp",(function(){return Dc})),n.d(l,"random",(function(){return Rc})),n.d(l,"invert",(function(){return Uc})),n.d(l,"conjugate",(function(){return Lc})),n.d(l,"fromMat3",(function(){return Ic})),n.d(l,"fromEuler",(function(){return Pc})),n.d(l,"str",(function(){return Fc})),n.d(l,"clone",(function(){return qc})),n.d(l,"fromValues",(function(){return Nc})),n.d(l,"copy",(function(){return Xc})),n.d(l,"set",(function(){return Bc})),n.d(l,"add",(function(){return Vc})),n.d(l,"mul",(function(){return Wc})),n.d(l,"scale",(function(){return Yc})),n.d(l,"dot",(function(){return Hc})),n.d(l,"lerp",(function(){return Gc})),n.d(l,"length",(function(){return Kc})),n.d(l,"len",(function(){return Jc})),n.d(l,"squaredLength",(function(){return Qc})),n.d(l,"sqrLen",(function(){return Zc})),n.d(l,"normalize",(function(){return $c})),n.d(l,"exactEquals",(function(){return tu})),n.d(l,"equals",(function(){return eu})),n.d(l,"rotationTo",(function(){return nu})),n.d(l,"sqlerp",(function(){return ru})),n.d(l,"setAxes",(function(){return au}));var f={};n.r(f),n.d(f,"create",(function(){return ou})),n.d(f,"clone",(function(){return iu})),n.d(f,"fromValues",(function(){return cu})),n.d(f,"copy",(function(){return uu})),n.d(f,"set",(function(){return su})),n.d(f,"add",(function(){return lu})),n.d(f,"subtract",(function(){return fu})),n.d(f,"multiply",(function(){return du})),n.d(f,"divide",(function(){return hu})),n.d(f,"ceil",(function(){return _u})),n.d(f,"floor",(function(){return pu})),n.d(f,"min",(function(){return mu})),n.d(f,"max",(function(){return vu})),n.d(f,"round",(function(){return bu})),n.d(f,"scale",(function(){return xu})),n.d(f,"scaleAndAdd",(function(){return gu})),n.d(f,"distance",(function(){return wu})),n.d(f,"squaredDistance",(function(){return yu})),n.d(f,"length",(function(){return Mu})),n.d(f,"squaredLength",(function(){return ju})),n.d(f,"negate",(function(){return Ou})),n.d(f,"inverse",(function(){return Eu})),n.d(f,"normalize",(function(){return ku})),n.d(f,"dot",(function(){return Tu})),n.d(f,"cross",(function(){return zu})),n.d(f,"lerp",(function(){return Su})),n.d(f,"random",(function(){return Au})),n.d(f,"transformMat2",(function(){return Cu})),n.d(f,"transformMat2d",(function(){return Du})),n.d(f,"transformMat3",(function(){return Ru})),n.d(f,"transformMat4",(function(){return Uu})),n.d(f,"rotate",(function(){return Lu})),n.d(f,"angle",(function(){return Iu})),n.d(f,"zero",(function(){return Pu})),n.d(f,"str",(function(){return Fu})),n.d(f,"exactEquals",(function(){return qu})),n.d(f,"equals",(function(){return Nu})),n.d(f,"len",(function(){return Xu})),n.d(f,"sub",(function(){return Bu})),n.d(f,"mul",(function(){return Vu})),n.d(f,"div",(function(){return Wu})),n.d(f,"dist",(function(){return Yu})),n.d(f,"sqrDist",(function(){return Hu})),n.d(f,"sqrLen",(function(){return Gu})),n.d(f,"forEach",(function(){return Ku}));var d=n(58),h=n(0),_=n.n(h),p=n(16),m=n.n(p),v=n(21),b=n(101),x=n(38),g=n(13),w=n(104),y=n(103),M=n(179),j=n(74),O=n(73),E=(n(127),{x:.5,y:.5,z:.5,c_idx:0,t_idx:0,shape_x:0,shape_y:0,shape_z:0,views:["slice","mip","vol"],shape_t:0,scale_x:1,scale_y:1,scale_z:1,LUT:{red:[0,150],green:[0,150],blue:[0,150]},selected_annotation:null,visible_worldlines:[],selected_worldline:null,active_provenance:"ANTT",fill_circles:!0,show_all_annotations:!1,rpc_list:[{name:"None found",default_args:"",docstring:""}],rpc_keybindings:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,0:0},rpc_args:{1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""}}),k=function(t,e,n){return Math.max(Math.min(t,n),0)},T={set_state:function(t,e){return e.payload},set_x:function(t,e){t.x=k(e.payload,0,1)},adjust_x:function(t,e){t.x=k(t.x+e.payload,0,1)},set_y:function(t,e){t.y=k(e.payload,0,1)},adjust_y:function(t,e){t.y=k(t.y+e.payload,0,1)},set_z:function(t,e){t.z=k(e.payload,0,1)},adjust_z:function(t,e){t.z=k(t.z+e.payload,0,1)},set_c_idx:function(t,e){t.c_idx=e.payload},adjust_c_idx:function(t,e){var n=t.c_idx+e.payload,r=t.views.length;t.c_idx=(n%r+r)%r},set_t_idx:function(t,e){t.t_idx=k(e.payload,0,t.shape_t-1)},set_scale_x:function(t,e){t.scale_x=e.payload},set_scale_y:function(t,e){t.scale_y=e.payload},set_scale_z:function(t,e){t.scale_z=e.payload},set_shape_x:function(t,e){t.shape_x=e.payload},set_shape_y:function(t,e){t.shape_y=e.payload},set_shape_z:function(t,e){t.shape_z=e.payload},set_LUT_color:function(t,e){t.LUT[e.payload[0]]=[e.payload[1],e.payload[2]]},set_selected_annotation_local:function(t,e){t.selected_annotation=e.payload},set_selected_worldline_local:function(t,e){t.selected_worldline=e.payload},set_active_provenance:function(t,e){t.active_provenance=e.payload},set_fill_circles:function(t,e){t.fill_circles=e.payload},toggle_fill_circles:function(t,e){t.fill_circles=!t.fill_circles},set_show_all_annotations:function(t,e){t.show_all_annotations=e.payload},toggle_all_annotations:function(t,e){t.show_all_annotations=!t.show_all_annotations},set_rpc_list:function(t,e){t.rpc_list=e.payload},set_rpc_keybinding:function(t,e){t.rpc_keybindings[e.payload[0]]=e.payload[1]},set_rpc_args:function(t,e){t.rpc_args=e.payload},set_rpc_arg:function(t,e){t.rpc_args[e.payload[0]]=e.payload[1]},center_on_annotation:function(t,e){t.x=Number(e.payload.x),t.y=Number(e.payload.y),t.z=Number(e.payload.z)}},z=Object(g.c)({name:"annotation_window",initialState:E,reducers:T}),S=z.actions,A=z.reducer,C=n(3),D=n.n(C),R=n(14),U=n(4),L=n(72),I=Symbol("newer"),P=Symbol("older");function F(t,e){"number"!==typeof t&&(e=t,t=0),this.size=0,this.limit=t,this.oldest=this.newest=void 0,this._keymap=new Map,e&&(this.assign(e),t<1&&(this.limit=this.size))}function q(t,e){this.key=t,this.value=e,this[I]=void 0,this[P]=void 0}function N(t){this.entry=t}function X(t){this.entry=t}function B(t){this.entry=t}F.prototype._markEntryAsUsed=function(t){t!==this.newest&&(t[I]&&(t===this.oldest&&(this.oldest=t[I]),t[I][P]=t[P]),t[P]&&(t[P][I]=t[I]),t[I]=void 0,t[P]=this.newest,this.newest&&(this.newest[I]=t),this.newest=t)},F.prototype.assign=function(t){var e,n=this.limit||Number.MAX_VALUE;this._keymap.clear();for(var r=t[Symbol.iterator](),a=r.next();!a.done;a=r.next()){var o=new q(a.value[0],a.value[1]);if(this._keymap.set(o.key,o),e?(e[I]=o,o[P]=e):this.oldest=o,e=o,0===n--)throw new Error("overflow")}this.newest=e,this.size=this._keymap.size},F.prototype.get=function(t){var e=this._keymap.get(t);if(e)return this._markEntryAsUsed(e),e.value},F.prototype.set=function(t,e){var n=this._keymap.get(t);return n?(n.value=e,this._markEntryAsUsed(n),this):(this._keymap.set(t,n=new q(t,e)),this.newest?(this.newest[I]=n,n[P]=this.newest):this.oldest=n,this.newest=n,++this.size,this.size>this.limit&&this.shift(),this)},F.prototype.shift=function(){var t=this.oldest;if(t)return this.oldest[I]?(this.oldest=this.oldest[I],this.oldest[P]=void 0):(this.oldest=void 0,this.newest=void 0),t[I]=t[P]=void 0,this._keymap.delete(t.key),--this.size,[t.key,t.value]},F.prototype.find=function(t){var e=this._keymap.get(t);return e?e.value:void 0},F.prototype.has=function(t){return this._keymap.has(t)},F.prototype.delete=function(t){var e=this._keymap.get(t);if(e)return this._keymap.delete(e.key),e[I]&&e[P]?(e[P][I]=e[I],e[I][P]=e[P]):e[I]?(e[I][P]=void 0,this.oldest=e[I]):e[P]?(e[P][I]=void 0,this.newest=e[P]):this.oldest=this.newest=void 0,this.size--,e.value},F.prototype.clear=function(){this.oldest=this.newest=void 0,this.size=0,this._keymap.clear()},N.prototype[Symbol.iterator]=function(){return this},N.prototype.next=function(){var t=this.entry;return t?(this.entry=t[I],{done:!1,value:[t.key,t.value]}):{done:!0,value:void 0}},X.prototype[Symbol.iterator]=function(){return this},X.prototype.next=function(){var t=this.entry;return t?(this.entry=t[I],{done:!1,value:t.key}):{done:!0,value:void 0}},B.prototype[Symbol.iterator]=function(){return this},B.prototype.next=function(){var t=this.entry;return t?(this.entry=t[I],{done:!1,value:t.value}):{done:!0,value:void 0}},F.prototype.keys=function(){return new X(this.oldest)},F.prototype.values=function(){return new B(this.oldest)},F.prototype.entries=function(){return this},F.prototype[Symbol.iterator]=function(){return new N(this.oldest)},F.prototype.forEach=function(t,e){"object"!==typeof e&&(e=this);for(var n=this.oldest;n;)t.call(e,n.value,n.key,this),n=n[I]},F.prototype.toJSON=function(){for(var t=new Array(this.size),e=0,n=this.oldest;n;)t[e++]={key:n.key,value:n.value},n=n[I];return t},F.prototype.toString=function(){for(var t="",e=this.oldest;e;)t+=String(e.key)+":"+e.value,(e=e[I])&&(t+=" < ");return t};var V=new F(5e3),W=new F(1e3),Y=function(){return fetch("/metadata").then((function(t){return t.json()}))};function H(t,e){return G.apply(this,arguments)}function G(){return(G=Object(L.a)(D.a.mark((function t(e,n){var r;return D.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!V.has(e)){t.next=4;break}if(void 0===(r=V.get(e))){t.next=4;break}return t.abrupt("return",r);case 4:return t.next=6,fetch(e,{signal:n}).then((function(t){return t.arrayBuffer()})).then((function(t){var n=new Uint8ClampedArray(t);return V.set(e,n),n})).catch((function(t){"AbortError"===t.name||console.error(t)}));case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var K=function(t){return fetch("/annotations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((function(t){return t.json()}))};function J(t){if(W.has(t)){var e=W.get(t);if(void 0!==e)return e}}function Q(t,e){return Z.apply(this,arguments)}function Z(){return(Z=Object(L.a)(D.a.mark((function t(e,n){return D.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("/t/".concat(e,"/annotations"),{signal:n}).then((function(t){return t.json()})).then((function(t){return W.set(e,t),t})).catch((function(t){"AbortError"===t.name||console.error(t)}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var $=function(t){return fetch("/annotations/".concat(t.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((function(t){return t.json()}))},tt=function(t){return fetch("/annotations/".concat(t),{method:"DELETE"})},et=function(){return fetch("/worldlines",{method:"POST"}).then((function(t){return t.json()}))},nt=function(){return fetch("/worldlines",{method:"GET"}).then((function(t){return t.json()}))},rt=function(t){return fetch("/worldlines/".concat(t.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((function(t){return t.json()}))},at=function(t){return fetch("/worldlines/".concat(t),{method:"DELETE"})},ot=function(){return fetch("/save",{method:"POST"}).then((function(t){return t.json()})).then((function(t){window.alert("Save successful: ".concat(t.path)),console.log("Saved to: ",t)})).catch((function(t){window.alert("Save failed. See console."),console.error("Error:",t)}))},it=function(){return fetch("/load",{method:"POST"}).then((function(t){return t.json()})).then((function(t){window.alert("Load successful: ".concat(t.path))})).catch((function(t){window.alert("Load failed. See console."),console.error("Error:",t)}))},ct=function(){return fetch("/rpc").then((function(t){return t.json()}))},ut=function(t,e,n){return fetch("/rpc",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({method:t,arg:e,state:n})}).then((function(t){return t.json()}))},st=Object(g.c)({name:"annotations",initialState:{},reducers:{set_state:function(t,e){return e.payload},set_annotation_local:function(t,e){t[e.payload.id]=e.payload},delete_annotation_local:function(t,e){delete t[e.payload]}}}),lt=st.actions,ft=st.reducer,dt=n(10),ht=function(t){return t.annotations},_t=function(t,e){return Math.max(Math.floor(t*e-1e-6),0)},pt=function(t,e){return 255/(e[1]-e[0])*(t-e[0])},mt=function(t){return t.annotation_window},vt=Object(dt.a)(mt,(function(t){return t.x})),bt=Object(dt.a)(mt,(function(t){return t.y})),xt=Object(dt.a)(mt,(function(t){return t.z})),gt=Object(dt.a)(mt,(function(t){return t.c_idx})),wt=Object(dt.a)(mt,(function(t){return t.t_idx})),yt=Object(dt.a)(mt,(function(t){return t.shape_x})),Mt=Object(dt.a)(mt,(function(t){return t.shape_y})),jt=Object(dt.a)(mt,(function(t){return t.shape_z})),Ot=Object(dt.a)(mt,(function(t){return t.shape_t})),Et=Object(dt.a)(mt,(function(t){return t.views})),kt=Object(dt.a)(mt,(function(t){return t.scale_x})),Tt=Object(dt.a)(mt,(function(t){return t.scale_y})),zt=Object(dt.a)(mt,(function(t){return t.scale_z})),St=Object(dt.a)(mt,(function(t){return t.LUT})),At=Object(dt.a)(mt,(function(t){return t.selected_annotation})),Ct=Object(dt.a)(mt,(function(t){return t.visible_worldlines})),Dt=Object(dt.a)(mt,(function(t){return t.selected_worldline})),Rt=Object(dt.a)(mt,(function(t){return t.active_provenance})),Ut=Object(dt.a)(mt,(function(t){return t.fill_circles})),Lt=Object(dt.a)(mt,(function(t){return t.show_all_annotations})),It=Object(dt.a)(mt,(function(t){return t.rpc_list})),Pt=Object(dt.a)(mt,(function(t){return t.rpc_keybindings})),Ft=Object(dt.a)([vt,yt],_t),qt=Object(dt.a)([bt,Mt],_t),Nt=Object(dt.a)([xt,jt],_t),Xt=Object(dt.a)(Et,gt,(function(t,e){return t[e]})),Bt=function(t){return Object(dt.a)(Xt,(function(e){switch(e){case"slice":return t;case"mip":return"mip_".concat(t);default:return t}}))},Vt=Bt("x"),Wt=Bt("y"),Yt=Bt("z"),Ht=function(t,e){return Object(dt.a)(Xt,e,(function(t,e){switch(t){case"slice":return e;case"mip":return 0;default:return e}}))},Gt=Ht(0,Ft),Kt=Ht(0,qt),Jt=Ht(0,Nt),Qt=function(t,e,n){return"/t/".concat(t,"/data/").concat(e,"/").concat(n)},Zt=Object(dt.a)(wt,Vt,Gt,Qt),$t=Object(dt.a)(wt,Wt,Kt,Qt),te=Object(dt.a)(wt,Yt,Jt,Qt),ee=Object(dt.a)(wt,(function(t){return Qt(t,"gvol",1)})),ne=n(27),re=n.n(ne),ae=function(t){return t.worldlines},oe=Object(dt.a)(ae,(function(t){return t.worldlines})),ie=Object(dt.a)(oe,(function(t){return Object.entries(t).filter((function(t){return t[1].visible})).map((function(t){return Number(t[0])}))})),ce=ht,ue=Object(dt.a)(ce,re.a.keys),se=Object(dt.a)(ce,(function(t){return re.a.values(re.a.mapValues("worldline_id")(t))})),le=Object(dt.a)(ce,(function(t){return Object.entries(t).map((function(t){return t[1]}))})),fe=Object(dt.a)(ce,ie,(function(t,e){return re.a.pickBy((function(t){return e.includes(t.worldline_id)}))(t)})),de=Object(dt.a)(ce,At,Dt,(function(t,e,n){return e&&e>0?e:n&&n>0?Number(re.a.findKey({worldline_id:n})(t)):null})),he=Object(dt.a)(ce,de,(function(t,e){return e?t[e]:null})),_e=function(t,e){return e.color},pe=Object(dt.a)(fe,ae,de,(function(t,e,n){return re.a.mapValues((function(t){var r,a=(r=t,e.worldlines[r.worldline_id]);return Object(R.a)({},t,{color:_e(0,a),selected:t.id===n})}))(t)})),me=Object(dt.a)(pe,re.a.mapValues(re.a.pick(["id","x","y","z","color","selected"]))),ve=function(t,e,n,r,a,o){var i=re.a.pickBy((function(t){return o-Math.abs(t[e]-a)>0}))(t);return re.a.mapValues((function(t){return{id:t.id,x:t[n],y:t[r],color:t.color,selected:t.selected,radius:4}}))(i)},be=Object(dt.a)(me,vt,Lt,(function(t,e,n){return ve(t,"x","z","y",e,n?2:.02)})),xe=Object(dt.a)(me,bt,Lt,(function(t,e,n){return ve(t,"y","x","z",e,n?2:.02)})),ge=Object(dt.a)(me,xt,Lt,(function(t,e,n){return ve(t,"z","x","y",e,n?2:.07)})),we=D.a.mark(Ue),ye=D.a.mark(Le),Me=D.a.mark(Pe),je=D.a.mark(Fe),Oe=D.a.mark(qe),Ee=D.a.mark(Ne),ke=D.a.mark(Xe),Te=D.a.mark(Be),ze=D.a.mark(Ve),Se=D.a.mark(We),Ae=D.a.mark(Ye),Ce="annotations/",De={insert_annotation:Ce+"insert_annotation",insert_annotation_here:Ce+"insert_annotation_here",get_annotations:Ce+"get_annotations",update_annotation:Ce+"update_annotation",delete_annotation:Ce+"delete_annotation"},Re={insert_annotation:Object(g.b)(De.insert_annotation),insert_annotation_here:Object(g.b)(De.insert_annotation_here),get_annotations:Object(g.b)(De.get_annotations),update_annotation:Object(g.b)(De.update_annotation),delete_annotation:Object(g.b)(De.delete_annotation)};function Ue(t){var e;return D.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(U.b)(K,t.payload);case 2:return e=n.sent,n.next=5,Object(U.d)(lt.set_annotation_local(e));case 5:return n.next=7,Object(U.d)(sr.set_selected_annotation(e.id));case 7:case"end":return n.stop()}}),we)}function Le(){var t,e,n,r,a,o,i,c,u,s;return D.a.wrap((function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,Object(U.f)();case 2:return t=l.sent,e=t.annotation_window,n=e.x,r=e.y,a=e.z,o=e.t_idx,i=e.selected_worldline,c=e.active_provenance,null===(u=i)&&(u=0),s={x:n,y:r,z:a,t_idx:o,worldline_id:u,provenance:c},l.next=9,Object(U.d)(Re.insert_annotation(s));case 9:case"end":return l.stop()}}),ye)}var Ie=new AbortController;function Pe(t){var e,n,r,a;return D.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(U.f)(wt);case 2:return e=t.sent,t.next=5,Object(U.b)(J,e);case 5:if(void 0===(n=t.sent)){t.next=9;break}return t.next=9,Object(U.d)(lt.set_state(n));case 9:return Ie.abort(),Ie=new AbortController,t.next=13,Object(U.b)(Q,e,Ie.signal);case 13:return r=t.sent,t.next=16,Object(U.d)(lt.set_state(r));case 16:return t.next=18,Object(U.d)(S.set_selected_annotation_local(null));case 18:return t.next=20,Object(U.f)(he);case 20:if(!(a=t.sent)){t.next=24;break}return t.next=24,Object(U.d)(S.center_on_annotation(a));case 24:case"end":return t.stop()}}),Me)}function Fe(t){var e;return D.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(U.b)($,t.payload);case 2:return e=n.sent,n.next=5,Object(U.d)(lt.set_annotation_local(e));case 5:return n.next=7,Object(U.d)(sr.set_selected_annotation(e.id));case 7:case"end":return n.stop()}}),je)}function qe(t){var e;return D.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(U.f)(de);case 2:return e=t.sent,t.next=5,Object(U.b)(tt,e);case 5:if(!t.sent.ok){t.next=11;break}return t.next=9,Object(U.d)(lt.delete_annotation_local(e));case 9:return t.next=11,Object(U.d)(S.set_selected_annotation_local(null));case 11:case"end":return t.stop()}}),Oe)}function Ne(){return D.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(U.g)(De.insert_annotation,Ue);case 2:case"end":return t.stop()}}),Ee)}function Xe(){return D.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(U.g)(De.insert_annotation_here,Le);case 2:case"end":return t.stop()}}),ke)}function Be(){return D.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(U.h)(De.get_annotations,Pe);case 2:case"end":return t.stop()}}),Te)}function Ve(){return D.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(U.h)("annotation_window/set_t_idx",Pe);case 2:case"end":return t.stop()}}),ze)}function We(){return D.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(U.g)(De.update_annotation,Fe);case 2:case"end":return t.stop()}}),Se)}function Ye(){return D.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(U.g)(De.delete_annotation,qe);case 2:case"end":return t.stop()}}),Ae)}var He=[Ne,Xe,Be,Ve,We,Ye],Ge=function(t){var e=Object.entries(t.annotations).map((function(e){return function(t){return _.a.createElement("circle",{key:t.id,cx:t.x*t.size_x,cy:t.y*t.size_y,r:t.selected?2*t.radius:t.radius,stroke:t.fill_circles?"white":t.color,strokeWidth:"1",fill:t.fill_circles?t.color:"none",onClick:function(e){t.selected?t.deselect(t.id):t.select(t.id),e.preventDefault(),e.stopPropagation()},onDoubleClick:function(t){t.preventDefault(),t.stopPropagation()}})}(Object(R.a)({},e[1],{size_x:t.size_x,size_y:t.size_y,select:t.select,deselect:t.deselect,fill_circles:t.fill_circles}))}));return _.a.createElement("g",null," ",e," ")},Ke=n(35),Je=n(32),Qe=n(17),Ze=n(182),$e=n(175),tn=n(176),en=n(177),nn=n(95),rn=n.n(nn),an=n(94),on=n.n(an),cn=Object(v.b)((function(t){return{annotation:he(t)}}),(function(t){return{saga_actions:Object(Qe.bindActionCreators)(Object(R.a)({},Re),t)}}))((function(t){var e=_.a.useState(t.annotation),n=Object(Je.a)(e,2),r=n[0],a=n[1];_.a.useEffect((function(){a(t.annotation)}),[t.annotation]);var o=[_.a.createElement("div",{key:"null",style:{position:"absolute"}},"select an annotation")];if(null!=r){var i=function(t,e){var n=t;return _.a.createElement(Ze.a,{type:"string",label:e,key:n,value:null!==r[n]?r[n]:"",onChange:function(t){return function(t,e){var n=Object(R.a)({},r,Object(Ke.a)({},t,e));console.log(t,e,n),a(n)}(n,t.target.value)},style:{position:"relative",width:"100px",height:"30px",margin:"10px"},InputProps:{style:{fontFamily:"monospace"}}})};o=[["x","x"],["y","y"],["z","z"],["t_idx","t"],["id","id"],["worldline_id","track"],["parent_id","parent_id"],["provenance","provenance"]].map((function(t){return i(t[0],t[1])}))}return _.a.createElement($e.a,{elevation:3,variant:"outlined",square:!0,style:{position:"absolute",left:t.left,top:t.top,width:"340px",height:"300px"}},_.a.createElement(tn.a,null,_.a.createElement("h3",null,"Annotation"),_.a.createElement(en.a,{"aria-label":"done",onClick:function(){return t.saga_actions.update_annotation(r)},style:{position:"absolute",left:"230px",top:"20px"}},_.a.createElement(on.a,{fontSize:"small"})),_.a.createElement(en.a,{"aria-label":"delete",onClick:t.saga_actions.delete_annotation,style:{position:"absolute",left:"280px",top:"20px"}},_.a.createElement(rn.a,{fontSize:"small"})),o))})),un={set_state:function(t,e){return e.payload},set_worldlines_local:function(t,e){t.worldlines=e.payload},set_worldline_lists_local:function(t,e){t.worldline_lists=e.payload,t.selected_lists=[]},set_worldline_local:function(t,e){t.worldlines[e.payload.id]=e.payload},update_worldline_local:function(t,e){void 0!==e.payload.id&&(t.worldlines[e.payload.id]=Object(R.a)({},t.worldlines[e.payload.id],{},e.payload))},delete_worldline_local:function(t,e){delete t.worldlines[e.payload]}},sn=Object(g.c)({name:"worldlines",initialState:{worldlines:{},worldline_lists:null,selected_lists:[]},reducers:un}),ln=sn.actions,fn=sn.reducer,dn=D.a.mark(jn),hn=D.a.mark(On),_n=D.a.mark(En),pn=D.a.mark(kn),mn=D.a.mark(Tn),vn=D.a.mark(zn),bn=D.a.mark(Sn),xn=D.a.mark(An),gn=D.a.mark(Cn),wn=D.a.mark(Dn),yn={create_worldline:"worldlines/create_worldline",get_worldlines:"worldlines/get_worldlines",update_worldline:"worldlines/update_worldline",delete_worldline:"worldlines/delete_worldline",set_all_visible:"worldlines/set_all_visible",set_all_invisible:"worldlines/set_all_invisible"},Mn={create_worldline:Object(g.b)(yn.create_worldline),get_worldlines:Object(g.b)(yn.get_worldlines),update_worldline:Object(g.b)(yn.update_worldline),delete_worldline:Object(g.b)(yn.delete_worldline),set_all_visible:Object(g.b)(yn.set_all_visible)};function jn(t){var e,n;return D.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(U.b)(et);case 2:return e=t.sent,n=Object(R.a)({},e,{visible:!0}),t.next=6,Object(U.d)(ln.set_worldline_local(n));case 6:case"end":return t.stop()}}),dn)}function On(t){var e,n,r,a,o;return D.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(U.b)(nt);case 2:for(e=t.sent,n={},r=0,a=Object.values(e);r<a.length;r++)o=a[r],n[Number(o.id)]={id:Number(o.id),name:String(o.name),color:String(o.color),visible:!0};return t.next=7,Object(U.d)(ln.set_worldlines_local(n));case 7:case"end":return t.stop()}}),hn)}function En(t){var e;return D.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(U.b)(rt,t.payload);case 2:return e=n.sent,n.next=5,Object(U.d)(ln.update_worldline_local(e));case 5:case"end":return n.stop()}}),_n)}function kn(t){var e;return D.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(U.b)(at,t.payload);case 2:if(!((e=n.sent)>=0)){n.next=6;break}return n.next=6,Object(U.d)(ln.delete_worldline_local(e));case 6:case"end":return n.stop()}}),pn)}function Tn(t){var e,n;return D.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Object(U.f)(oe);case 2:return e=r.sent,n=re.a.mapValues((function(e){return Object(R.a)({},e,{visible:t.payload})}))(e),r.next=6,Object(U.d)(ln.set_worldlines_local(n));case 6:case"end":return r.stop()}}),mn)}function zn(){return D.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(U.g)(yn.create_worldline,jn);case 2:case"end":return t.stop()}}),vn)}function Sn(){return D.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(U.g)(yn.get_worldlines,On);case 2:case"end":return t.stop()}}),bn)}function An(){return D.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(U.g)(yn.update_worldline,En);case 2:case"end":return t.stop()}}),xn)}function Cn(){return D.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(U.g)(yn.delete_worldline,kn);case 2:case"end":return t.stop()}}),gn)}function Dn(){return D.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(U.g)(yn.set_all_visible,Tn);case 2:case"end":return t.stop()}}),wn)}var Rn=[zn,Sn,An,Cn,Dn],Un=n(96),Ln=n.n(Un),In=n(178),Pn=function(t){var e=function(t){var e=t.worldline.name;return e&&"null"!==e?e:String(t.worldline.id)},n=Object(h.useState)(e(t)),r=Object(Je.a)(n,2),a=r[0],o=r[1];return _.a.useEffect((function(){o(e(t))}),[t]),_.a.createElement("div",{style:{float:"left",position:"relative",height:"30px",width:"100px"}},_.a.createElement("input",{type:"checkbox",checked:t.worldline.visible,onChange:function(e){return t.on_check(e.target.checked)},style:{float:"left",marginTop:"8px"}}),_.a.createElement("div",{style:{float:"left",fontFamily:"monospace",fontSize:"10px",color:"#C0C0C0",marginTop:"8px",border:"0px",width:"20px"}},t.worldline.id),_.a.createElement("input",{type:"text",onBlur:function(e){return t.on_rename(e.target.value)},onChange:function(t){return o(t.target.value)},value:a,style:{float:"left",marginTop:"5px",fontFamily:"monospace",color:"white",backgroundColor:"#666",border:"0px",width:"40px"}}),_.a.createElement("div",{style:{backgroundColor:t.worldline.color,float:"left",marginTop:"5px",border:"0px",padding:"0px",width:"16px",height:"18px"}},_.a.createElement("input",{type:"color",value:t.worldline.color,onChange:function(e){return t.on_recolor(e.target.value)},style:{float:"left",opacity:"0",marginTop:"5px",border:"0px",padding:"0px",width:"16px",height:"16px"}})))},Fn=Object(v.b)((function(t){return{state:ae(t)}}),(function(t){return{actions:Object(Qe.bindActionCreators)(Object(R.a)({},ln),t),saga_actions:Object(Qe.bindActionCreators)(Object(R.a)({},Mn),t),set_selected_worldline:Object(Qe.bindActionCreators)(sr.set_selected_worldline,t)}}))((function(t){var e=Object.values(t.state.worldlines).map((function(e){return _.a.createElement(Pn,{key:e.id,worldline:e,on_check:function(n){t.actions.update_worldline_local({id:e.id,visible:n}),n&&t.set_selected_worldline(e.id)},on_rename:function(n){return t.saga_actions.update_worldline({id:e.id,name:n})},on_recolor:function(n){return t.saga_actions.update_worldline({id:e.id,color:n})}})}));return _.a.createElement($e.a,{elevation:3,variant:"outlined",square:!0,style:{position:"absolute",left:t.left,top:t.top,width:"340px",height:"auto"}},_.a.createElement(tn.a,null,_.a.createElement("h3",null,"Tracks:"),_.a.createElement(In.a,{color:"default",onClick:function(e){return t.saga_actions.set_all_visible(!0)},style:{position:"absolute",left:"90px",top:"28px"}},"all"),_.a.createElement(In.a,{color:"default",onClick:function(e){return t.saga_actions.set_all_visible(!1)},style:{position:"absolute",left:"160px",top:"28px"}},"none"),e,_.a.createElement(en.a,{"aria-label":"add",onClick:function(){return t.saga_actions.create_worldline()},style:{position:"absolute",left:"220px",top:"25px"}},_.a.createElement(Ln.a,{fontSize:"small"}))))})),qn=D.a.mark(lr),Nn=D.a.mark(fr),Xn=D.a.mark(dr),Bn=D.a.mark(hr),Vn=D.a.mark(_r),Wn=D.a.mark(pr),Yn=D.a.mark(mr),Hn=D.a.mark(vr),Gn=D.a.mark(br),Kn=D.a.mark(xr),Jn=D.a.mark(gr),Qn=D.a.mark(wr),Zn=D.a.mark(yr),$n=D.a.mark(Mr),tr=D.a.mark(jr),er=D.a.mark(Or),nr=D.a.mark(Er),rr=D.a.mark(kr),ar=D.a.mark(Tr),or=D.a.mark(zr),ir=D.a.mark(Sr),cr=D.a.mark(Ar),ur={fetch_state:"annotation_window/fetch_state",set_selected_annotation:"annotation_window/set_selected_annotation",set_selected_worldline:"annotation_window/set_selected_worldline",center_on_current_annotation:"annotation_window/center_on_current_annotation",adjust_t:"annotation_window/adjust_t",click:"annotation_window/click",doubleclick:"annotation_window/doubleclick",save:"annotation_window/save",load:"annotation_window/load",rpc:"annotation_window/rpc",rpc_from_key:"annotation_window/rpc_from_key"},sr={fetch_state:Object(g.b)(ur.fetch_state),set_selected_annotation:Object(g.b)(ur.set_selected_annotation),set_selected_worldline:Object(g.b)(ur.set_selected_worldline),center_on_current_annotation:Object(g.b)(ur.center_on_current_annotation),adjust_t:Object(g.b)(ur.adjust_t),click:Object(g.b)(ur.click),doubleclick:Object(g.b)(ur.doubleclick),save:Object(g.b)(ur.save),load:Object(g.b)(ur.load),rpc:Object(g.b)(ur.rpc),rpc_from_key:Object(g.b)(ur.rpc_from_key)};function lr(){var t,e,n;return D.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Object(U.b)(Y);case 2:return t=r.sent,r.next=5,Object(U.b)(ct);case 5:return e=r.sent,n=Object(R.a)({},E,{shape_x:t.shape_x,shape_y:t.shape_y,shape_z:t.shape_z,shape_t:t.shape_t,scale_x:700/t.shape_x,scale_y:700/t.shape_x,scale_z:120/t.shape_z,rpc_list:e.payload}),r.next=9,Object(U.d)(S.set_state(n));case 9:case"end":return r.stop()}}),qn)}function fr(t){var e,n;return D.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.payload){r.next=7;break}return r.next=3,Object(U.d)(S.set_selected_annotation_local(null));case 3:return r.next=5,Object(U.d)(S.set_selected_worldline_local(null));case 5:r.next=21;break;case 7:return r.next=9,Object(U.f)(ht);case 9:if(e=r.sent,void 0!==(n=e[t.payload])){r.next=14;break}return console.error("Annotation ".concat(t.payload," not found.")),r.abrupt("return");case 14:return r.next=16,Object(U.d)(S.set_selected_annotation_local(n.id));case 16:if(!(n.worldline_id>0)){r.next=19;break}return r.next=19,Object(U.d)(S.set_selected_worldline_local(n.worldline_id));case 19:return r.next=21,Object(U.d)(sr.center_on_current_annotation());case 21:case"end":return r.stop()}}),Nn)}function dr(t){var e;return D.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(e=t.payload)){n.next=5;break}return n.next=4,Object(U.d)(S.set_selected_worldline_local(null));case 4:return n.abrupt("return");case 5:return n.next=7,Object(U.f)(a.get_worldlines);case 7:if(n.sent[e]){n.next=11;break}return window.alert("Bad track: ".concat(e,". Please select an existing one or ")+"create a new one."),n.abrupt("return");case 11:return n.next=13,Object(U.d)(S.set_selected_worldline_local(e));case 13:return n.next=15,Object(U.d)(S.set_selected_annotation_local(null));case 15:if(null===e){n.next=18;break}return n.next=18,Object(U.d)(ln.update_worldline_local({id:e,visible:!0}));case 18:return n.next=20,Object(U.d)(sr.center_on_current_annotation());case 20:case"end":return n.stop()}}),Xn)}function hr(){var t;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(U.f)(o.get_selected_annotation);case 2:if(null===(t=e.sent)||void 0===t){e.next=6;break}return e.next=6,Object(U.d)(S.center_on_annotation(t));case 6:case"end":return e.stop()}}),Bn)}function _r(t){var e;return D.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(U.f)(r.get_t_idx);case 2:return e=n.sent,n.next=5,Object(U.d)(S.set_t_idx(e+t.payload));case 5:case"end":return n.stop()}}),Vn)}function pr(t){return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.payload.x){e.next=3;break}return e.next=3,Object(U.d)(S.set_x(t.payload.x));case 3:if(!t.payload.y){e.next=6;break}return e.next=6,Object(U.d)(S.set_y(t.payload.y));case 6:if(!t.payload.z){e.next=9;break}return e.next=9,Object(U.d)(S.set_z(t.payload.z));case 9:case"end":return e.stop()}}),Wn)}function mr(t){return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(U.d)(sr.click(t.payload));case 2:return e.next=4,Object(U.d)(Re.insert_annotation_here());case 4:case"end":return e.stop()}}),Yn)}function vr(){return D.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(U.b)(ot);case 2:case"end":return t.stop()}}),Hn)}function br(){return D.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(U.b)(it);case 2:return t.next=4,Object(U.d)(Re.get_annotations());case 4:return t.next=6,Object(U.d)(Mn.get_worldlines());case 6:case"end":return t.stop()}}),Gn)}function xr(t){var e,n,a,o,i,c,u,s,l,f,d,h;return D.a.wrap((function(_){for(;;)switch(_.prev=_.next){case 0:return _.next=2,Object(U.f)(r.get_state);case 2:return e=_.sent,n=e.rpc_list[t.payload[0]],a=n.name,o=t.payload[1],_.next=8,Object(U.b)(ut,a,o,e);case 8:if(i=_.sent,console.log(i),"ok"!==i.status){_.next=43;break}c=!0,u=!1,s=void 0,_.prev=14,l=i.callbacks[Symbol.iterator]();case 16:if(c=(f=l.next()).done){_.next=27;break}return d=f.value,h=parseInt(d.payload),String(h)===d.payload&&(d.payload=h),_.next=22,Object(U.e)(d);case 22:return _.next=24,Object(U.c)(100);case 24:c=!0,_.next=16;break;case 27:_.next=33;break;case 29:_.prev=29,_.t0=_.catch(14),u=!0,s=_.t0;case 33:_.prev=33,_.prev=34,c||null==l.return||l.return();case 36:if(_.prev=36,!u){_.next=39;break}throw s;case 39:return _.finish(36);case 40:return _.finish(33);case 41:_.next=44;break;case 43:"error"===i.status&&(window.alert(i.exception),console.error(i.traceback));case 44:case"end":return _.stop()}}),Kn,null,[[14,29,33,41],[34,,36,40]])}function gr(t){var e,n,a;return D.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,Object(U.f)(r.get_state);case 2:return e=o.sent,n=e.rpc_keybindings[t.payload],a=e.rpc_args[t.payload],o.next=7,Object(U.d)(sr.rpc([n,a]));case 7:case"end":return o.stop()}}),Jn)}function wr(){return D.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(U.h)(ur.fetch_state,lr);case 2:case"end":return t.stop()}}),Qn)}function yr(){return D.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(U.h)(ur.set_selected_annotation,fr);case 2:case"end":return t.stop()}}),Zn)}function Mr(){return D.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(U.h)(ur.set_selected_worldline,dr);case 2:case"end":return t.stop()}}),$n)}function jr(){return D.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(U.h)(ur.center_on_current_annotation,hr);case 2:case"end":return t.stop()}}),tr)}function Or(){return D.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(U.h)(ur.adjust_t,_r);case 2:case"end":return t.stop()}}),er)}function Er(){return D.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(U.h)(ur.click,pr);case 2:case"end":return t.stop()}}),nr)}function kr(){return D.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(U.h)(ur.doubleclick,mr);case 2:case"end":return t.stop()}}),rr)}function Tr(){return D.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(U.h)(ur.save,vr);case 2:case"end":return t.stop()}}),ar)}function zr(){return D.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(U.h)(ur.load,br);case 2:case"end":return t.stop()}}),or)}function Sr(){return D.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(U.g)(ur.rpc,xr);case 2:case"end":return t.stop()}}),ir)}function Ar(){return D.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(U.g)(ur.rpc_from_key,gr);case 2:case"end":return t.stop()}}),cr)}var Cr=[wr,yr,Mr,jr,Or,Er,kr,Tr,zr,Sr,Ar],Dr=n(71),Rr=n(48),Ur=n(49),Lr=n(51),Ir=n(50),Pr=n(62),Fr=n(52),qr=function(t){function e(t){var n;return Object(Rr.a)(this,e),(n=Object(Lr.a)(this,Object(Ir.a)(e).call(this,t))).state={value:"0"},n.handleChange=n.handleChange.bind(Object(Pr.a)(n)),n.handleSubmit=n.handleSubmit.bind(Object(Pr.a)(n)),n}return Object(Fr.a)(e,t),Object(Ur.a)(e,[{key:"handleChange",value:function(t){this.setState({value:t.target.value})}},{key:"handleSubmit",value:function(t){this.props.action(this.props.input_parser(this.state.value)),t.preventDefault()}},{key:"render",value:function(){return _.a.createElement("form",{onSubmit:this.handleSubmit},_.a.createElement("input",{type:"submit",value:this.props.name}),_.a.createElement("input",{type:"text",defaultValue:this.state.value,onChange:this.handleChange}))}}]),e}(_.a.Component),Nr=function(t){return _.a.createElement(qr,Object.assign({},t,{input_parser:parseFloat}))},Xr=(Object(v.b)((function(t){return{state:mt(t),x_idx:Ft(t)}}),Object(R.a)({},S,{},sr))((function(t){var e=t.state,n=t.x_idx,r=Object(Dr.a)(t,["state","x_idx"]),a={bare_state:e,derived_state:{x_idx:n}},o=JSON.stringify(a,null,4);return _.a.createElement("div",null,_.a.createElement("pre",null,_.a.createElement("code",null,"annotation_window: ",o)),_.a.createElement("br",null),"Simple Actions:",_.a.createElement(Nr,{name:"set_shape_x",action:r.set_shape_x}),_.a.createElement(Nr,{name:"set_x",action:r.set_x}),_.a.createElement(Nr,{name:"adjust_x",action:r.adjust_x}),_.a.createElement(Nr,{name:"set_scale_x",action:r.set_scale_x}),_.a.createElement("br",null),"Async Actions:",_.a.createElement("br",null),_.a.createElement("button",{onClick:function(){return r.fetch_state()}},"fetch_state"))})),n(187)),Br=function(t){return{select:function(e){return t(sr.set_selected_annotation(e))},deselect:function(){return t(sr.set_selected_annotation(null))},click:function(e){return t(sr.click(e))},doubleclick:function(e){return t(sr.doubleclick(e))}}},Vr=Object(v.b)((function(t){return{height:r.get_shape_y(t),width:r.get_shape_z(t),height_scale:r.get_scale_y(t),width_scale:r.get_scale_z(t),data_url:r.get_x_url(t),x:r.get_z(t),y:r.get_y(t),x_dim:"z",y_dim:"y",annotations:o.get_x_annotations(t),fill_circles:r.get_fill_circles(t),LUT:r.get_LUT(t)}}),Br),Wr=Object(v.b)((function(t){return{height:r.get_shape_z(t),width:r.get_shape_x(t),height_scale:r.get_scale_z(t),width_scale:r.get_scale_x(t),data_url:r.get_y_url(t),x:r.get_x(t),y:r.get_z(t),x_dim:"x",y_dim:"z",annotations:o.get_y_annotations(t),fill_circles:r.get_fill_circles(t),LUT:r.get_LUT(t)}}),Br),Yr=Object(v.b)((function(t){return{height:r.get_shape_y(t),width:r.get_shape_x(t),height_scale:r.get_scale_y(t),width_scale:r.get_scale_x(t),data_url:r.get_z_url(t),x:r.get_x(t),y:r.get_y(t),x_dim:"x",y_dim:"y",annotations:o.get_z_annotations(t),fill_circles:r.get_fill_circles(t),LUT:r.get_LUT(t)}}),Br),Hr=function(t){function e(t){var n;return Object(Rr.a)(this,e),(n=Object(Lr.a)(this,Object(Ir.a)(e).call(this,t))).state=void 0,n.abort_controller=void 0,n.fetch_and_draw=function(){n.abort_controller.abort(),n.abort_controller=new AbortController,H(n.props.data_url,n.abort_controller.signal).then((function(t){return n.setState({data:t})})).then(n.draw_to_canvas)},n.draw_to_canvas=function(){if(null!=n.state.data&&n.props.width>0&&n.props.height>0){var t=(a=n.state.data,o=n.props.LUT,a.map((function(t,e){switch(e%4){case 0:return pt(t,o.red);case 1:return pt(t,o.green);case 2:return pt(t,o.blue);default:return t}}))),e=n.refs.canvas.getContext("2d"),r=new ImageData(t,n.props.width,n.props.height);null===e||void 0===e||e.putImageData(r,0,0)}var a,o},n.make_click_handler=function(t){return function(e){var r,a=e.target.getBoundingClientRect(),o=e.clientX-a.left,i=e.clientY-a.top,c=o/(n.props.width*n.props.width_scale),u=i/(n.props.height*n.props.height_scale);t((r={},Object(Ke.a)(r,n.props.x_dim,c),Object(Ke.a)(r,n.props.y_dim,u),r))}},n.handle_click=n.make_click_handler(n.props.click),n.handle_doubleclick=n.make_click_handler(n.props.doubleclick),n.abort_controller=new AbortController,n.state={data:null},n}return Object(Fr.a)(e,t),Object(Ur.a)(e,[{key:"componentDidMount",value:function(){this.fetch_and_draw()}},{key:"componentDidUpdate",value:function(t){this.props.data_url!==t.data_url?this.fetch_and_draw():this.props.LUT!==t.LUT&&this.draw_to_canvas()}},{key:"render",value:function(){var t=this.props.width*this.props.width_scale,e=this.props.height*this.props.height_scale,n=_.a.createElement("line",{x1:0,y1:this.props.y*e,x2:t,y2:this.props.y*e,strokeWidth:"0.4",stroke:"grey"}),r=_.a.createElement("line",{x1:this.props.x*t,y1:0,x2:this.props.x*t,y2:e,strokeWidth:"0.4",stroke:"grey"});return _.a.createElement("div",{style:{position:"relative",left:this.props.left,top:this.props.top,right:"0px"}},_.a.createElement("canvas",{ref:"canvas",width:this.props.width,height:this.props.height,style:{position:"absolute",left:"0px",top:"0px",zIndex:1,width:this.props.width*this.props.width_scale,height:this.props.height*this.props.height_scale}}),_.a.createElement("svg",{ref:"svg",width:this.props.width*this.props.width_scale,height:this.props.height*this.props.height_scale,onClick:this.handle_click,onDoubleClick:this.handle_doubleclick,style:{position:"absolute",left:"0px",top:"0px",zIndex:2}},_.a.createElement(Ge,{annotations:this.props.annotations,size_x:this.props.width*this.props.width_scale,size_y:this.props.height*this.props.height_scale,select:this.props.select,deselect:this.props.deselect,fill_circles:this.props.fill_circles}),n,r))}}]),e}(h.Component),Gr=Vr(Hr),Kr=Wr(Hr),Jr=Yr(Hr),Qr=n(65),Zr=n(75),$r=n(185),ta=n(7),ea=n(99),na=n.n(ea),ra=n(98),aa=n.n(ra),oa=n(184),ia=n(186),ca=n(173),ua=n(180),sa=Object(ta.a)({tooltip:{maxWidth:600,margin:10,padding:10,position:"absolute",top:-50}})($r.a),la=Object(v.b)((function(t){return{window_state:r.get_state(t)}}),(function(t){return{actions:Object(Qe.bindActionCreators)(Object(R.a)({},S),t),saga_actions:Object(Qe.bindActionCreators)(Object(R.a)({},sr),t)}}))((function(t){var e=_.a.useState(t.window_state),n=Object(Je.a)(e,2),r=n[0],a=n[1];_.a.useEffect((function(){a(Object(R.a)({},t.window_state,{x:parseFloat(t.window_state.x.toFixed(3)),y:parseFloat(t.window_state.y.toFixed(3)),z:parseFloat(t.window_state.z.toFixed(3))}))}),[t.window_state]);var o=function(){t.actions.set_x(r.x),t.actions.set_y(r.y),t.actions.set_z(r.z),t.actions.set_t_idx(r.t_idx);var e=r.selected_annotation;null===e||""===String(e)?t.saga_actions.set_selected_annotation(null):t.saga_actions.set_selected_annotation(Number(e));var n=r.selected_worldline;null===n||""===String(n)?t.saga_actions.set_selected_worldline(null):t.saga_actions.set_selected_worldline(Number(n)),t.actions.set_active_provenance(r.active_provenance),t.actions.set_rpc_args(r.rpc_args),t.actions.set_rpc_list(r.rpc_list)},i=function(t,e){var n=t;return _.a.createElement(Ze.a,{type:"string",label:e,key:n,value:null!==r[n]?r[n]:"",onChange:function(t){return function(t,e){var n=Object(R.a)({},r,Object(Ke.a)({},t,e));a(n)}(n,t.target.value)},onBlur:o,style:{position:"relative",width:"80px",margin:"10px"},InputLabelProps:{style:{fontSize:14}},InputProps:{style:{fontFamily:"monospace"}}})},c=[["x","x"],["y","y"],["z","z"],["t_idx","t"],["selected_annotation","anno."],["selected_worldline","track"],["active_provenance","prov"]].map((function(t){return i(t[0],t[1])})),u="1234567890".split("").map((function(e){var n,i=Object(Zr.get)(r.rpc_keybindings,e,0),c=Object(Zr.get)(r.rpc_list,i);return n=c?Object(Zr.get)(c,"docstring",""):"",_.a.createElement(_.a.Fragment,{key:e},_.a.createElement(sa,{interactive:!0,title:_.a.createElement("pre",{style:{fontSize:14}},n),placement:"right"},_.a.createElement(ca.a,{style:{width:810,margin:10,top:10,marginBottom:50}},_.a.createElement(oa.a,{id:"action-".concat(e,"-select-label")},"Key ",e),_.a.createElement(ua.a,{labelId:"action-".concat(e,"-select-label"),id:"action-".concat(e,"-select"),value:i,onChange:function(n){return function(e,n){t.actions.set_rpc_keybinding([e,n]),t.actions.set_rpc_arg([e,r.rpc_list[n].default_args])}(e,Number(n.target.value))},style:{width:250,position:"absolute",fontFamily:"monospace"}},t.window_state.rpc_list.map((function(t,e){return _.a.createElement(ia.a,{style:{fontFamily:"monospace"},value:e,key:e},t.name)}))),_.a.createElement(Ze.a,{type:"string",label:"arg",value:r.rpc_args[e],onChange:function(t){return function(t,e){var n=r.rpc_keybindings[t],o=Object(Qr.a)(r,(function(r){r.rpc_args[t]=e,r.rpc_list[n].default_args=e}));a(o)}(e,t.target.value)},onBlur:o,style:{position:"absolute",left:300,width:400},InputProps:{style:{fontFamily:"monospace"}}}))))}));return _.a.createElement($e.a,{elevation:3,variant:"outlined",square:!0,style:{position:"absolute",left:t.left,top:t.top,width:"840px",height:"1000px"}},_.a.createElement(tn.a,null,_.a.createElement("h3",null,"Annotation Window"),_.a.createElement($r.a,{title:"Load from disk"},_.a.createElement(en.a,{"aria-label":"load",onClick:function(){return t.saga_actions.load()},style:{position:"absolute",left:"650px",top:"5px"}},_.a.createElement(aa.a,{fontSize:"small"}))),_.a.createElement($r.a,{title:"Save to disk"},_.a.createElement(en.a,{"aria-label":"save",onClick:function(){return t.saga_actions.save()},style:{position:"absolute",left:"700px",top:"5px"}},_.a.createElement(na.a,{fontSize:"small"}))),c,_.a.createElement($r.a,{title:"Keyboard shortcut: o"},_.a.createElement("div",{style:{width:150,float:"left"}},_.a.createElement("input",{type:"checkbox",checked:t.window_state.fill_circles,id:"fill-circles-cb",onChange:function(e){return t.actions.set_fill_circles(e.target.checked)},style:{marginTop:"30px"}}),_.a.createElement("label",null,"Fill circles"))),_.a.createElement($r.a,{title:"Keyboard shortcut: a"},_.a.createElement("div",{style:{width:150,float:"left"}},_.a.createElement("input",{type:"checkbox",checked:t.window_state.show_all_annotations,id:"all-annotations-cb",onChange:function(e){return t.actions.set_show_all_annotations(e.target.checked)},style:{marginTop:"30px"}}),_.a.createElement("label",null,"Show all"))),u))})),fa="undefined"!==typeof Float32Array?Float32Array:Array,da=Math.random;Math.PI;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function ha(){var t=new fa(9);return fa!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function _a(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function pa(t){var e=new fa(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function ma(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function va(t,e,n,r,a,o,i,c,u){var s=new fa(9);return s[0]=t,s[1]=e,s[2]=n,s[3]=r,s[4]=a,s[5]=o,s[6]=i,s[7]=c,s[8]=u,s}function ba(t,e,n,r,a,o,i,c,u,s){return t[0]=e,t[1]=n,t[2]=r,t[3]=a,t[4]=o,t[5]=i,t[6]=c,t[7]=u,t[8]=s,t}function xa(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function ga(t,e){if(t===e){var n=e[1],r=e[2],a=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=a}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function wa(t,e){var n=e[0],r=e[1],a=e[2],o=e[3],i=e[4],c=e[5],u=e[6],s=e[7],l=e[8],f=l*i-c*s,d=-l*o+c*u,h=s*o-i*u,_=n*f+r*d+a*h;return _?(_=1/_,t[0]=f*_,t[1]=(-l*r+a*s)*_,t[2]=(c*r-a*i)*_,t[3]=d*_,t[4]=(l*n-a*u)*_,t[5]=(-c*n+a*o)*_,t[6]=h*_,t[7]=(-s*n+r*u)*_,t[8]=(i*n-r*o)*_,t):null}function ya(t,e){var n=e[0],r=e[1],a=e[2],o=e[3],i=e[4],c=e[5],u=e[6],s=e[7],l=e[8];return t[0]=i*l-c*s,t[1]=a*s-r*l,t[2]=r*c-a*i,t[3]=c*u-o*l,t[4]=n*l-a*u,t[5]=a*o-n*c,t[6]=o*s-i*u,t[7]=r*u-n*s,t[8]=n*i-r*o,t}function Ma(t){var e=t[0],n=t[1],r=t[2],a=t[3],o=t[4],i=t[5],c=t[6],u=t[7],s=t[8];return e*(s*o-i*u)+n*(-s*a+i*c)+r*(u*a-o*c)}function ja(t,e,n){var r=e[0],a=e[1],o=e[2],i=e[3],c=e[4],u=e[5],s=e[6],l=e[7],f=e[8],d=n[0],h=n[1],_=n[2],p=n[3],m=n[4],v=n[5],b=n[6],x=n[7],g=n[8];return t[0]=d*r+h*i+_*s,t[1]=d*a+h*c+_*l,t[2]=d*o+h*u+_*f,t[3]=p*r+m*i+v*s,t[4]=p*a+m*c+v*l,t[5]=p*o+m*u+v*f,t[6]=b*r+x*i+g*s,t[7]=b*a+x*c+g*l,t[8]=b*o+x*u+g*f,t}function Oa(t,e,n){var r=e[0],a=e[1],o=e[2],i=e[3],c=e[4],u=e[5],s=e[6],l=e[7],f=e[8],d=n[0],h=n[1];return t[0]=r,t[1]=a,t[2]=o,t[3]=i,t[4]=c,t[5]=u,t[6]=d*r+h*i+s,t[7]=d*a+h*c+l,t[8]=d*o+h*u+f,t}function Ea(t,e,n){var r=e[0],a=e[1],o=e[2],i=e[3],c=e[4],u=e[5],s=e[6],l=e[7],f=e[8],d=Math.sin(n),h=Math.cos(n);return t[0]=h*r+d*i,t[1]=h*a+d*c,t[2]=h*o+d*u,t[3]=h*i-d*r,t[4]=h*c-d*a,t[5]=h*u-d*o,t[6]=s,t[7]=l,t[8]=f,t}function ka(t,e,n){var r=n[0],a=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=a*e[3],t[4]=a*e[4],t[5]=a*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Ta(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function za(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=-n,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Sa(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Aa(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function Ca(t,e){var n=e[0],r=e[1],a=e[2],o=e[3],i=n+n,c=r+r,u=a+a,s=n*i,l=r*i,f=r*c,d=a*i,h=a*c,_=a*u,p=o*i,m=o*c,v=o*u;return t[0]=1-f-_,t[3]=l-v,t[6]=d+m,t[1]=l+v,t[4]=1-s-_,t[7]=h-p,t[2]=d-m,t[5]=h+p,t[8]=1-s-f,t}function Da(t,e){var n=e[0],r=e[1],a=e[2],o=e[3],i=e[4],c=e[5],u=e[6],s=e[7],l=e[8],f=e[9],d=e[10],h=e[11],_=e[12],p=e[13],m=e[14],v=e[15],b=n*c-r*i,x=n*u-a*i,g=n*s-o*i,w=r*u-a*c,y=r*s-o*c,M=a*s-o*u,j=l*p-f*_,O=l*m-d*_,E=l*v-h*_,k=f*m-d*p,T=f*v-h*p,z=d*v-h*m,S=b*z-x*T+g*k+w*E-y*O+M*j;return S?(S=1/S,t[0]=(c*z-u*T+s*k)*S,t[1]=(u*E-i*z-s*O)*S,t[2]=(i*T-c*E+s*j)*S,t[3]=(a*T-r*z-o*k)*S,t[4]=(n*z-a*E+o*O)*S,t[5]=(r*E-n*T-o*j)*S,t[6]=(p*M-m*y+v*w)*S,t[7]=(m*g-_*M-v*x)*S,t[8]=(_*y-p*g+v*b)*S,t):null}function Ra(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function Ua(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function La(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function Ia(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t}function Pa(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}function Fa(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t}function qa(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t}function Na(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function Xa(t,e){var n=t[0],r=t[1],a=t[2],o=t[3],i=t[4],c=t[5],u=t[6],s=t[7],l=t[8],f=e[0],d=e[1],h=e[2],_=e[3],p=e[4],m=e[5],v=e[6],b=e[7],x=e[8];return Math.abs(n-f)<=1e-6*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(r-d)<=1e-6*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(a-h)<=1e-6*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(o-_)<=1e-6*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(i-p)<=1e-6*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(c-m)<=1e-6*Math.max(1,Math.abs(c),Math.abs(m))&&Math.abs(u-v)<=1e-6*Math.max(1,Math.abs(u),Math.abs(v))&&Math.abs(s-b)<=1e-6*Math.max(1,Math.abs(s),Math.abs(b))&&Math.abs(l-x)<=1e-6*Math.max(1,Math.abs(l),Math.abs(x))}var Ba=ja,Va=Pa;function Wa(){var t=new fa(16);return fa!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function Ya(t){var e=new fa(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Ha(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Ga(t,e,n,r,a,o,i,c,u,s,l,f,d,h,_,p){var m=new fa(16);return m[0]=t,m[1]=e,m[2]=n,m[3]=r,m[4]=a,m[5]=o,m[6]=i,m[7]=c,m[8]=u,m[9]=s,m[10]=l,m[11]=f,m[12]=d,m[13]=h,m[14]=_,m[15]=p,m}function Ka(t,e,n,r,a,o,i,c,u,s,l,f,d,h,_,p,m){return t[0]=e,t[1]=n,t[2]=r,t[3]=a,t[4]=o,t[5]=i,t[6]=c,t[7]=u,t[8]=s,t[9]=l,t[10]=f,t[11]=d,t[12]=h,t[13]=_,t[14]=p,t[15]=m,t}function Ja(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Qa(t,e){if(t===e){var n=e[1],r=e[2],a=e[3],o=e[6],i=e[7],c=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=o,t[11]=e[14],t[12]=a,t[13]=i,t[14]=c}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Za(t,e){var n=e[0],r=e[1],a=e[2],o=e[3],i=e[4],c=e[5],u=e[6],s=e[7],l=e[8],f=e[9],d=e[10],h=e[11],_=e[12],p=e[13],m=e[14],v=e[15],b=n*c-r*i,x=n*u-a*i,g=n*s-o*i,w=r*u-a*c,y=r*s-o*c,M=a*s-o*u,j=l*p-f*_,O=l*m-d*_,E=l*v-h*_,k=f*m-d*p,T=f*v-h*p,z=d*v-h*m,S=b*z-x*T+g*k+w*E-y*O+M*j;return S?(S=1/S,t[0]=(c*z-u*T+s*k)*S,t[1]=(a*T-r*z-o*k)*S,t[2]=(p*M-m*y+v*w)*S,t[3]=(d*y-f*M-h*w)*S,t[4]=(u*E-i*z-s*O)*S,t[5]=(n*z-a*E+o*O)*S,t[6]=(m*g-_*M-v*x)*S,t[7]=(l*M-d*g+h*x)*S,t[8]=(i*T-c*E+s*j)*S,t[9]=(r*E-n*T-o*j)*S,t[10]=(_*y-p*g+v*b)*S,t[11]=(f*g-l*y-h*b)*S,t[12]=(c*O-i*k-u*j)*S,t[13]=(n*k-r*O+a*j)*S,t[14]=(p*x-_*w-m*b)*S,t[15]=(l*w-f*x+d*b)*S,t):null}function $a(t,e){var n=e[0],r=e[1],a=e[2],o=e[3],i=e[4],c=e[5],u=e[6],s=e[7],l=e[8],f=e[9],d=e[10],h=e[11],_=e[12],p=e[13],m=e[14],v=e[15],b=n*c-r*i,x=n*u-a*i,g=n*s-o*i,w=r*u-a*c,y=r*s-o*c,M=a*s-o*u,j=l*p-f*_,O=l*m-d*_,E=l*v-h*_,k=f*m-d*p,T=f*v-h*p,z=d*v-h*m;return t[0]=c*z-u*T+s*k,t[1]=a*T-r*z-o*k,t[2]=p*M-m*y+v*w,t[3]=d*y-f*M-h*w,t[4]=u*E-i*z-s*O,t[5]=n*z-a*E+o*O,t[6]=m*g-_*M-v*x,t[7]=l*M-d*g+h*x,t[8]=i*T-c*E+s*j,t[9]=r*E-n*T-o*j,t[10]=_*y-p*g+v*b,t[11]=f*g-l*y-h*b,t[12]=c*O-i*k-u*j,t[13]=n*k-r*O+a*j,t[14]=p*x-_*w-m*b,t[15]=l*w-f*x+d*b,t}function to(t){var e=t[0],n=t[1],r=t[2],a=t[3],o=t[4],i=t[5],c=t[6],u=t[7],s=t[8],l=t[9],f=t[10],d=t[11],h=t[12],_=t[13],p=t[14],m=e*i-n*o,v=e*c-r*o,b=n*c-r*i,x=s*_-l*h,g=s*p-f*h,w=l*p-f*_;return u*(e*w-n*g+r*x)-a*(o*w-i*g+c*x)+t[15]*(s*b-l*v+f*m)-d*(h*b-_*v+p*m)}function eo(t,e,n){var r=e[0],a=e[1],o=e[2],i=e[3],c=e[4],u=e[5],s=e[6],l=e[7],f=e[8],d=e[9],h=e[10],_=e[11],p=e[12],m=e[13],v=e[14],b=e[15],x=n[0],g=n[1],w=n[2],y=n[3];return t[0]=x*r+g*c+w*f+y*p,t[1]=x*a+g*u+w*d+y*m,t[2]=x*o+g*s+w*h+y*v,t[3]=x*i+g*l+w*_+y*b,x=n[4],g=n[5],w=n[6],y=n[7],t[4]=x*r+g*c+w*f+y*p,t[5]=x*a+g*u+w*d+y*m,t[6]=x*o+g*s+w*h+y*v,t[7]=x*i+g*l+w*_+y*b,x=n[8],g=n[9],w=n[10],y=n[11],t[8]=x*r+g*c+w*f+y*p,t[9]=x*a+g*u+w*d+y*m,t[10]=x*o+g*s+w*h+y*v,t[11]=x*i+g*l+w*_+y*b,x=n[12],g=n[13],w=n[14],y=n[15],t[12]=x*r+g*c+w*f+y*p,t[13]=x*a+g*u+w*d+y*m,t[14]=x*o+g*s+w*h+y*v,t[15]=x*i+g*l+w*_+y*b,t}function no(t,e,n){var r,a,o,i,c,u,s,l,f,d,h,_,p=n[0],m=n[1],v=n[2];return e===t?(t[12]=e[0]*p+e[4]*m+e[8]*v+e[12],t[13]=e[1]*p+e[5]*m+e[9]*v+e[13],t[14]=e[2]*p+e[6]*m+e[10]*v+e[14],t[15]=e[3]*p+e[7]*m+e[11]*v+e[15]):(r=e[0],a=e[1],o=e[2],i=e[3],c=e[4],u=e[5],s=e[6],l=e[7],f=e[8],d=e[9],h=e[10],_=e[11],t[0]=r,t[1]=a,t[2]=o,t[3]=i,t[4]=c,t[5]=u,t[6]=s,t[7]=l,t[8]=f,t[9]=d,t[10]=h,t[11]=_,t[12]=r*p+c*m+f*v+e[12],t[13]=a*p+u*m+d*v+e[13],t[14]=o*p+s*m+h*v+e[14],t[15]=i*p+l*m+_*v+e[15]),t}function ro(t,e,n){var r=n[0],a=n[1],o=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*a,t[5]=e[5]*a,t[6]=e[6]*a,t[7]=e[7]*a,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function ao(t,e,n,r){var a,o,i,c,u,s,l,f,d,h,_,p,m,v,b,x,g,w,y,M,j,O,E,k,T=r[0],z=r[1],S=r[2],A=Math.hypot(T,z,S);return A<1e-6?null:(T*=A=1/A,z*=A,S*=A,a=Math.sin(n),i=1-(o=Math.cos(n)),c=e[0],u=e[1],s=e[2],l=e[3],f=e[4],d=e[5],h=e[6],_=e[7],p=e[8],m=e[9],v=e[10],b=e[11],x=T*T*i+o,g=z*T*i+S*a,w=S*T*i-z*a,y=T*z*i-S*a,M=z*z*i+o,j=S*z*i+T*a,O=T*S*i+z*a,E=z*S*i-T*a,k=S*S*i+o,t[0]=c*x+f*g+p*w,t[1]=u*x+d*g+m*w,t[2]=s*x+h*g+v*w,t[3]=l*x+_*g+b*w,t[4]=c*y+f*M+p*j,t[5]=u*y+d*M+m*j,t[6]=s*y+h*M+v*j,t[7]=l*y+_*M+b*j,t[8]=c*O+f*E+p*k,t[9]=u*O+d*E+m*k,t[10]=s*O+h*E+v*k,t[11]=l*O+_*E+b*k,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function oo(t,e,n){var r=Math.sin(n),a=Math.cos(n),o=e[4],i=e[5],c=e[6],u=e[7],s=e[8],l=e[9],f=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*a+s*r,t[5]=i*a+l*r,t[6]=c*a+f*r,t[7]=u*a+d*r,t[8]=s*a-o*r,t[9]=l*a-i*r,t[10]=f*a-c*r,t[11]=d*a-u*r,t}function io(t,e,n){var r=Math.sin(n),a=Math.cos(n),o=e[0],i=e[1],c=e[2],u=e[3],s=e[8],l=e[9],f=e[10],d=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*a-s*r,t[1]=i*a-l*r,t[2]=c*a-f*r,t[3]=u*a-d*r,t[8]=o*r+s*a,t[9]=i*r+l*a,t[10]=c*r+f*a,t[11]=u*r+d*a,t}function co(t,e,n){var r=Math.sin(n),a=Math.cos(n),o=e[0],i=e[1],c=e[2],u=e[3],s=e[4],l=e[5],f=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*a+s*r,t[1]=i*a+l*r,t[2]=c*a+f*r,t[3]=u*a+d*r,t[4]=s*a-o*r,t[5]=l*a-i*r,t[6]=f*a-c*r,t[7]=d*a-u*r,t}function uo(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function so(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function lo(t,e,n){var r,a,o,i=n[0],c=n[1],u=n[2],s=Math.hypot(i,c,u);return s<1e-6?null:(i*=s=1/s,c*=s,u*=s,r=Math.sin(e),o=1-(a=Math.cos(e)),t[0]=i*i*o+a,t[1]=c*i*o+u*r,t[2]=u*i*o-c*r,t[3]=0,t[4]=i*c*o-u*r,t[5]=c*c*o+a,t[6]=u*c*o+i*r,t[7]=0,t[8]=i*u*o+c*r,t[9]=c*u*o-i*r,t[10]=u*u*o+a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function fo(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ho(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function _o(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function po(t,e,n){var r=e[0],a=e[1],o=e[2],i=e[3],c=r+r,u=a+a,s=o+o,l=r*c,f=r*u,d=r*s,h=a*u,_=a*s,p=o*s,m=i*c,v=i*u,b=i*s;return t[0]=1-(h+p),t[1]=f+b,t[2]=d-v,t[3]=0,t[4]=f-b,t[5]=1-(l+p),t[6]=_+m,t[7]=0,t[8]=d+v,t[9]=_-m,t[10]=1-(l+h),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function mo(t,e){var n=new fa(3),r=-e[0],a=-e[1],o=-e[2],i=e[3],c=e[4],u=e[5],s=e[6],l=e[7],f=r*r+a*a+o*o+i*i;return f>0?(n[0]=2*(c*i+l*r+u*o-s*a)/f,n[1]=2*(u*i+l*a+s*r-c*o)/f,n[2]=2*(s*i+l*o+c*a-u*r)/f):(n[0]=2*(c*i+l*r+u*o-s*a),n[1]=2*(u*i+l*a+s*r-c*o),n[2]=2*(s*i+l*o+c*a-u*r)),po(t,e,n),t}function vo(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function bo(t,e){var n=e[0],r=e[1],a=e[2],o=e[4],i=e[5],c=e[6],u=e[8],s=e[9],l=e[10];return t[0]=Math.hypot(n,r,a),t[1]=Math.hypot(o,i,c),t[2]=Math.hypot(u,s,l),t}function xo(t,e){var n=new fa(3);bo(n,e);var r=1/n[0],a=1/n[1],o=1/n[2],i=e[0]*r,c=e[1]*a,u=e[2]*o,s=e[4]*r,l=e[5]*a,f=e[6]*o,d=e[8]*r,h=e[9]*a,_=e[10]*o,p=i+l+_,m=0;return p>0?(m=2*Math.sqrt(p+1),t[3]=.25*m,t[0]=(f-h)/m,t[1]=(d-u)/m,t[2]=(c-s)/m):i>l&&i>_?(m=2*Math.sqrt(1+i-l-_),t[3]=(f-h)/m,t[0]=.25*m,t[1]=(c+s)/m,t[2]=(d+u)/m):l>_?(m=2*Math.sqrt(1+l-i-_),t[3]=(d-u)/m,t[0]=(c+s)/m,t[1]=.25*m,t[2]=(f+h)/m):(m=2*Math.sqrt(1+_-i-l),t[3]=(c-s)/m,t[0]=(d+u)/m,t[1]=(f+h)/m,t[2]=.25*m),t}function go(t,e,n,r){var a=e[0],o=e[1],i=e[2],c=e[3],u=a+a,s=o+o,l=i+i,f=a*u,d=a*s,h=a*l,_=o*s,p=o*l,m=i*l,v=c*u,b=c*s,x=c*l,g=r[0],w=r[1],y=r[2];return t[0]=(1-(_+m))*g,t[1]=(d+x)*g,t[2]=(h-b)*g,t[3]=0,t[4]=(d-x)*w,t[5]=(1-(f+m))*w,t[6]=(p+v)*w,t[7]=0,t[8]=(h+b)*y,t[9]=(p-v)*y,t[10]=(1-(f+_))*y,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function wo(t,e,n,r,a){var o=e[0],i=e[1],c=e[2],u=e[3],s=o+o,l=i+i,f=c+c,d=o*s,h=o*l,_=o*f,p=i*l,m=i*f,v=c*f,b=u*s,x=u*l,g=u*f,w=r[0],y=r[1],M=r[2],j=a[0],O=a[1],E=a[2],k=(1-(p+v))*w,T=(h+g)*w,z=(_-x)*w,S=(h-g)*y,A=(1-(d+v))*y,C=(m+b)*y,D=(_+x)*M,R=(m-b)*M,U=(1-(d+p))*M;return t[0]=k,t[1]=T,t[2]=z,t[3]=0,t[4]=S,t[5]=A,t[6]=C,t[7]=0,t[8]=D,t[9]=R,t[10]=U,t[11]=0,t[12]=n[0]+j-(k*j+S*O+D*E),t[13]=n[1]+O-(T*j+A*O+R*E),t[14]=n[2]+E-(z*j+C*O+U*E),t[15]=1,t}function yo(t,e){var n=e[0],r=e[1],a=e[2],o=e[3],i=n+n,c=r+r,u=a+a,s=n*i,l=r*i,f=r*c,d=a*i,h=a*c,_=a*u,p=o*i,m=o*c,v=o*u;return t[0]=1-f-_,t[1]=l+v,t[2]=d-m,t[3]=0,t[4]=l-v,t[5]=1-s-_,t[6]=h+p,t[7]=0,t[8]=d+m,t[9]=h-p,t[10]=1-s-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Mo(t,e,n,r,a,o,i){var c=1/(n-e),u=1/(a-r),s=1/(o-i);return t[0]=2*o*c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*u,t[6]=0,t[7]=0,t[8]=(n+e)*c,t[9]=(a+r)*u,t[10]=(i+o)*s,t[11]=-1,t[12]=0,t[13]=0,t[14]=i*o*2*s,t[15]=0,t}function jo(t,e,n,r,a){var o,i=1/Math.tan(e/2);return t[0]=i/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=a&&a!==1/0?(o=1/(r-a),t[10]=(a+r)*o,t[14]=2*a*r*o):(t[10]=-1,t[14]=-2*r),t}function Oo(t,e,n,r){var a=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),i=Math.tan(e.leftDegrees*Math.PI/180),c=Math.tan(e.rightDegrees*Math.PI/180),u=2/(i+c),s=2/(a+o);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=-(i-c)*u*.5,t[9]=(a-o)*s*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t}function Eo(t,e,n,r,a,o,i){var c=1/(e-n),u=1/(r-a),s=1/(o-i);return t[0]=-2*c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*s,t[11]=0,t[12]=(e+n)*c,t[13]=(a+r)*u,t[14]=(i+o)*s,t[15]=1,t}function ko(t,e,n,r){var a,o,i,c,u,s,l,f,d,h,_=e[0],p=e[1],m=e[2],v=r[0],b=r[1],x=r[2],g=n[0],w=n[1],y=n[2];return Math.abs(_-g)<1e-6&&Math.abs(p-w)<1e-6&&Math.abs(m-y)<1e-6?Ja(t):(l=_-g,f=p-w,d=m-y,a=b*(d*=h=1/Math.hypot(l,f,d))-x*(f*=h),o=x*(l*=h)-v*d,i=v*f-b*l,(h=Math.hypot(a,o,i))?(a*=h=1/h,o*=h,i*=h):(a=0,o=0,i=0),c=f*i-d*o,u=d*a-l*i,s=l*o-f*a,(h=Math.hypot(c,u,s))?(c*=h=1/h,u*=h,s*=h):(c=0,u=0,s=0),t[0]=a,t[1]=c,t[2]=l,t[3]=0,t[4]=o,t[5]=u,t[6]=f,t[7]=0,t[8]=i,t[9]=s,t[10]=d,t[11]=0,t[12]=-(a*_+o*p+i*m),t[13]=-(c*_+u*p+s*m),t[14]=-(l*_+f*p+d*m),t[15]=1,t)}function To(t,e,n,r){var a=e[0],o=e[1],i=e[2],c=r[0],u=r[1],s=r[2],l=a-n[0],f=o-n[1],d=i-n[2],h=l*l+f*f+d*d;h>0&&(l*=h=1/Math.sqrt(h),f*=h,d*=h);var _=u*d-s*f,p=s*l-c*d,m=c*f-u*l;return(h=_*_+p*p+m*m)>0&&(_*=h=1/Math.sqrt(h),p*=h,m*=h),t[0]=_,t[1]=p,t[2]=m,t[3]=0,t[4]=f*m-d*p,t[5]=d*_-l*m,t[6]=l*p-f*_,t[7]=0,t[8]=l,t[9]=f,t[10]=d,t[11]=0,t[12]=a,t[13]=o,t[14]=i,t[15]=1,t}function zo(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function So(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function Ao(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t}function Co(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}function Do(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t}function Ro(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t[9]=e[9]+n[9]*r,t[10]=e[10]+n[10]*r,t[11]=e[11]+n[11]*r,t[12]=e[12]+n[12]*r,t[13]=e[13]+n[13]*r,t[14]=e[14]+n[14]*r,t[15]=e[15]+n[15]*r,t}function Uo(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function Lo(t,e){var n=t[0],r=t[1],a=t[2],o=t[3],i=t[4],c=t[5],u=t[6],s=t[7],l=t[8],f=t[9],d=t[10],h=t[11],_=t[12],p=t[13],m=t[14],v=t[15],b=e[0],x=e[1],g=e[2],w=e[3],y=e[4],M=e[5],j=e[6],O=e[7],E=e[8],k=e[9],T=e[10],z=e[11],S=e[12],A=e[13],C=e[14],D=e[15];return Math.abs(n-b)<=1e-6*Math.max(1,Math.abs(n),Math.abs(b))&&Math.abs(r-x)<=1e-6*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(a-g)<=1e-6*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(o-w)<=1e-6*Math.max(1,Math.abs(o),Math.abs(w))&&Math.abs(i-y)<=1e-6*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(c-M)<=1e-6*Math.max(1,Math.abs(c),Math.abs(M))&&Math.abs(u-j)<=1e-6*Math.max(1,Math.abs(u),Math.abs(j))&&Math.abs(s-O)<=1e-6*Math.max(1,Math.abs(s),Math.abs(O))&&Math.abs(l-E)<=1e-6*Math.max(1,Math.abs(l),Math.abs(E))&&Math.abs(f-k)<=1e-6*Math.max(1,Math.abs(f),Math.abs(k))&&Math.abs(d-T)<=1e-6*Math.max(1,Math.abs(d),Math.abs(T))&&Math.abs(h-z)<=1e-6*Math.max(1,Math.abs(h),Math.abs(z))&&Math.abs(_-S)<=1e-6*Math.max(1,Math.abs(_),Math.abs(S))&&Math.abs(p-A)<=1e-6*Math.max(1,Math.abs(p),Math.abs(A))&&Math.abs(m-C)<=1e-6*Math.max(1,Math.abs(m),Math.abs(C))&&Math.abs(v-D)<=1e-6*Math.max(1,Math.abs(v),Math.abs(D))}var Io=eo,Po=Co;function Fo(){var t=new fa(3);return fa!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function qo(t){var e=new fa(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function No(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function Xo(t,e,n){var r=new fa(3);return r[0]=t,r[1]=e,r[2]=n,r}function Bo(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Vo(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function Wo(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function Yo(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function Ho(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function Go(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function Ko(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function Jo(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function Qo(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function Zo(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function $o(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function ti(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function ei(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t}function ni(t,e){var n=e[0]-t[0],r=e[1]-t[1],a=e[2]-t[2];return Math.hypot(n,r,a)}function ri(t,e){var n=e[0]-t[0],r=e[1]-t[1],a=e[2]-t[2];return n*n+r*r+a*a}function ai(t){var e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r}function oi(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function ii(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function ci(t,e){var n=e[0],r=e[1],a=e[2],o=n*n+r*r+a*a;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function ui(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function si(t,e,n){var r=e[0],a=e[1],o=e[2],i=n[0],c=n[1],u=n[2];return t[0]=a*u-o*c,t[1]=o*i-r*u,t[2]=r*c-a*i,t}function li(t,e,n,r){var a=e[0],o=e[1],i=e[2];return t[0]=a+r*(n[0]-a),t[1]=o+r*(n[1]-o),t[2]=i+r*(n[2]-i),t}function fi(t,e,n,r,a,o){var i=o*o,c=i*(2*o-3)+1,u=i*(o-2)+o,s=i*(o-1),l=i*(3-2*o);return t[0]=e[0]*c+n[0]*u+r[0]*s+a[0]*l,t[1]=e[1]*c+n[1]*u+r[1]*s+a[1]*l,t[2]=e[2]*c+n[2]*u+r[2]*s+a[2]*l,t}function di(t,e,n,r,a,o){var i=1-o,c=i*i,u=o*o,s=c*i,l=3*o*c,f=3*u*i,d=u*o;return t[0]=e[0]*s+n[0]*l+r[0]*f+a[0]*d,t[1]=e[1]*s+n[1]*l+r[1]*f+a[1]*d,t[2]=e[2]*s+n[2]*l+r[2]*f+a[2]*d,t}function hi(t,e){e=e||1;var n=2*da()*Math.PI,r=2*da()-1,a=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(n)*a,t[1]=Math.sin(n)*a,t[2]=r*e,t}function _i(t,e,n){var r=e[0],a=e[1],o=e[2],i=n[3]*r+n[7]*a+n[11]*o+n[15];return i=i||1,t[0]=(n[0]*r+n[4]*a+n[8]*o+n[12])/i,t[1]=(n[1]*r+n[5]*a+n[9]*o+n[13])/i,t[2]=(n[2]*r+n[6]*a+n[10]*o+n[14])/i,t}function pi(t,e,n){var r=e[0],a=e[1],o=e[2];return t[0]=r*n[0]+a*n[3]+o*n[6],t[1]=r*n[1]+a*n[4]+o*n[7],t[2]=r*n[2]+a*n[5]+o*n[8],t}function mi(t,e,n){var r=n[0],a=n[1],o=n[2],i=n[3],c=e[0],u=e[1],s=e[2],l=a*s-o*u,f=o*c-r*s,d=r*u-a*c,h=a*d-o*f,_=o*l-r*d,p=r*f-a*l,m=2*i;return l*=m,f*=m,d*=m,h*=2,_*=2,p*=2,t[0]=c+l+h,t[1]=u+f+_,t[2]=s+d+p,t}function vi(t,e,n,r){var a=[],o=[];return a[0]=e[0]-n[0],a[1]=e[1]-n[1],a[2]=e[2]-n[2],o[0]=a[0],o[1]=a[1]*Math.cos(r)-a[2]*Math.sin(r),o[2]=a[1]*Math.sin(r)+a[2]*Math.cos(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function bi(t,e,n,r){var a=[],o=[];return a[0]=e[0]-n[0],a[1]=e[1]-n[1],a[2]=e[2]-n[2],o[0]=a[2]*Math.sin(r)+a[0]*Math.cos(r),o[1]=a[1],o[2]=a[2]*Math.cos(r)-a[0]*Math.sin(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function xi(t,e,n,r){var a=[],o=[];return a[0]=e[0]-n[0],a[1]=e[1]-n[1],a[2]=e[2]-n[2],o[0]=a[0]*Math.cos(r)-a[1]*Math.sin(r),o[1]=a[0]*Math.sin(r)+a[1]*Math.cos(r),o[2]=a[2],t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function gi(t,e){var n=t[0],r=t[1],a=t[2],o=e[0],i=e[1],c=e[2],u=Math.sqrt(n*n+r*r+a*a)*Math.sqrt(o*o+i*i+c*c),s=u&&ui(t,e)/u;return Math.acos(Math.min(Math.max(s,-1),1))}function wi(t){return t[0]=0,t[1]=0,t[2]=0,t}function yi(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function Mi(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function ji(t,e){var n=t[0],r=t[1],a=t[2],o=e[0],i=e[1],c=e[2];return Math.abs(n-o)<=1e-6*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-i)<=1e-6*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(a-c)<=1e-6*Math.max(1,Math.abs(a),Math.abs(c))}var Oi=Yo,Ei=Ho,ki=Go,Ti=ni,zi=ri,Si=No,Ai=ai,Ci=function(){var t=Fo();return function(e,n,r,a,o,i){var c,u;for(n||(n=3),r||(r=0),u=a?Math.min(a*n+r,e.length):e.length,c=r;c<u;c+=n)t[0]=e[c],t[1]=e[c+1],t[2]=e[c+2],o(t,t,i),e[c]=t[0],e[c+1]=t[1],e[c+2]=t[2];return e}}();function Di(){var t=new fa(4);return fa!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Ri(t){var e=new fa(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Ui(t,e,n,r){var a=new fa(4);return a[0]=t,a[1]=e,a[2]=n,a[3]=r,a}function Li(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Ii(t,e,n,r,a){return t[0]=e,t[1]=n,t[2]=r,t[3]=a,t}function Pi(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function Fi(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function qi(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function Ni(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function Xi(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function Bi(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function Vi(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t}function Wi(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t}function Yi(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function Hi(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function Gi(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t}function Ki(t,e){var n=e[0]-t[0],r=e[1]-t[1],a=e[2]-t[2],o=e[3]-t[3];return Math.hypot(n,r,a,o)}function Ji(t,e){var n=e[0]-t[0],r=e[1]-t[1],a=e[2]-t[2],o=e[3]-t[3];return n*n+r*r+a*a+o*o}function Qi(t){var e=t[0],n=t[1],r=t[2],a=t[3];return Math.hypot(e,n,r,a)}function Zi(t){var e=t[0],n=t[1],r=t[2],a=t[3];return e*e+n*n+r*r+a*a}function $i(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function tc(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function ec(t,e){var n=e[0],r=e[1],a=e[2],o=e[3],i=n*n+r*r+a*a+o*o;return i>0&&(i=1/Math.sqrt(i)),t[0]=n*i,t[1]=r*i,t[2]=a*i,t[3]=o*i,t}function nc(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function rc(t,e,n,r){var a=n[0]*r[1]-n[1]*r[0],o=n[0]*r[2]-n[2]*r[0],i=n[0]*r[3]-n[3]*r[0],c=n[1]*r[2]-n[2]*r[1],u=n[1]*r[3]-n[3]*r[1],s=n[2]*r[3]-n[3]*r[2],l=e[0],f=e[1],d=e[2],h=e[3];return t[0]=f*s-d*u+h*c,t[1]=-l*s+d*i-h*o,t[2]=l*u-f*i+h*a,t[3]=-l*c+f*o-d*a,t}function ac(t,e,n,r){var a=e[0],o=e[1],i=e[2],c=e[3];return t[0]=a+r*(n[0]-a),t[1]=o+r*(n[1]-o),t[2]=i+r*(n[2]-i),t[3]=c+r*(n[3]-c),t}function oc(t,e){var n,r,a,o,i,c;e=e||1;do{i=(n=2*da()-1)*n+(r=2*da()-1)*r}while(i>=1);do{c=(a=2*da()-1)*a+(o=2*da()-1)*o}while(c>=1);var u=Math.sqrt((1-i)/c);return t[0]=e*n,t[1]=e*r,t[2]=e*a*u,t[3]=e*o*u,t}function ic(t,e,n){var r=e[0],a=e[1],o=e[2],i=e[3];return t[0]=n[0]*r+n[4]*a+n[8]*o+n[12]*i,t[1]=n[1]*r+n[5]*a+n[9]*o+n[13]*i,t[2]=n[2]*r+n[6]*a+n[10]*o+n[14]*i,t[3]=n[3]*r+n[7]*a+n[11]*o+n[15]*i,t}function cc(t,e,n){var r=e[0],a=e[1],o=e[2],i=n[0],c=n[1],u=n[2],s=n[3],l=s*r+c*o-u*a,f=s*a+u*r-i*o,d=s*o+i*a-c*r,h=-i*r-c*a-u*o;return t[0]=l*s+h*-i+f*-u-d*-c,t[1]=f*s+h*-c+d*-i-l*-u,t[2]=d*s+h*-u+l*-c-f*-i,t[3]=e[3],t}function uc(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function sc(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function lc(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function fc(t,e){var n=t[0],r=t[1],a=t[2],o=t[3],i=e[0],c=e[1],u=e[2],s=e[3];return Math.abs(n-i)<=1e-6*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(r-c)<=1e-6*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(a-u)<=1e-6*Math.max(1,Math.abs(a),Math.abs(u))&&Math.abs(o-s)<=1e-6*Math.max(1,Math.abs(o),Math.abs(s))}var dc=Fi,hc=qi,_c=Ni,pc=Ki,mc=Ji,vc=Qi,bc=Zi,xc=function(){var t=Di();return function(e,n,r,a,o,i){var c,u;for(n||(n=4),r||(r=0),u=a?Math.min(a*n+r,e.length):e.length,c=r;c<u;c+=n)t[0]=e[c],t[1]=e[c+1],t[2]=e[c+2],t[3]=e[c+3],o(t,t,i),e[c]=t[0],e[c+1]=t[1],e[c+2]=t[2],e[c+3]=t[3];return e}}();function gc(){var t=new fa(4);return fa!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function wc(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function yc(t,e,n){n*=.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function Mc(t,e){var n=2*Math.acos(e[3]),r=Math.sin(n/2);return r>1e-6?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),n}function jc(t,e){var n=Hc(t,e);return Math.acos(2*n*n-1)}function Oc(t,e,n){var r=e[0],a=e[1],o=e[2],i=e[3],c=n[0],u=n[1],s=n[2],l=n[3];return t[0]=r*l+i*c+a*s-o*u,t[1]=a*l+i*u+o*c-r*s,t[2]=o*l+i*s+r*u-a*c,t[3]=i*l-r*c-a*u-o*s,t}function Ec(t,e,n){n*=.5;var r=e[0],a=e[1],o=e[2],i=e[3],c=Math.sin(n),u=Math.cos(n);return t[0]=r*u+i*c,t[1]=a*u+o*c,t[2]=o*u-a*c,t[3]=i*u-r*c,t}function kc(t,e,n){n*=.5;var r=e[0],a=e[1],o=e[2],i=e[3],c=Math.sin(n),u=Math.cos(n);return t[0]=r*u-o*c,t[1]=a*u+i*c,t[2]=o*u+r*c,t[3]=i*u-a*c,t}function Tc(t,e,n){n*=.5;var r=e[0],a=e[1],o=e[2],i=e[3],c=Math.sin(n),u=Math.cos(n);return t[0]=r*u+a*c,t[1]=a*u-r*c,t[2]=o*u+i*c,t[3]=i*u-o*c,t}function zc(t,e){var n=e[0],r=e[1],a=e[2];return t[0]=n,t[1]=r,t[2]=a,t[3]=Math.sqrt(Math.abs(1-n*n-r*r-a*a)),t}function Sc(t,e){var n=e[0],r=e[1],a=e[2],o=e[3],i=Math.sqrt(n*n+r*r+a*a),c=Math.exp(o),u=i>0?c*Math.sin(i)/i:0;return t[0]=n*u,t[1]=r*u,t[2]=a*u,t[3]=c*Math.cos(i),t}function Ac(t,e){var n=e[0],r=e[1],a=e[2],o=e[3],i=Math.sqrt(n*n+r*r+a*a),c=i>0?Math.atan2(i,o)/i:0;return t[0]=n*c,t[1]=r*c,t[2]=a*c,t[3]=.5*Math.log(n*n+r*r+a*a+o*o),t}function Cc(t,e,n){return Ac(t,e),Yc(t,t,n),Sc(t,t),t}function Dc(t,e,n,r){var a,o,i,c,u,s=e[0],l=e[1],f=e[2],d=e[3],h=n[0],_=n[1],p=n[2],m=n[3];return(o=s*h+l*_+f*p+d*m)<0&&(o=-o,h=-h,_=-_,p=-p,m=-m),1-o>1e-6?(a=Math.acos(o),i=Math.sin(a),c=Math.sin((1-r)*a)/i,u=Math.sin(r*a)/i):(c=1-r,u=r),t[0]=c*s+u*h,t[1]=c*l+u*_,t[2]=c*f+u*p,t[3]=c*d+u*m,t}function Rc(t){var e=da(),n=da(),r=da(),a=Math.sqrt(1-e),o=Math.sqrt(e);return t[0]=a*Math.sin(2*Math.PI*n),t[1]=a*Math.cos(2*Math.PI*n),t[2]=o*Math.sin(2*Math.PI*r),t[3]=o*Math.cos(2*Math.PI*r),t}function Uc(t,e){var n=e[0],r=e[1],a=e[2],o=e[3],i=n*n+r*r+a*a+o*o,c=i?1/i:0;return t[0]=-n*c,t[1]=-r*c,t[2]=-a*c,t[3]=o*c,t}function Lc(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function Ic(t,e){var n,r=e[0]+e[4]+e[8];if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var a=0;e[4]>e[0]&&(a=1),e[8]>e[3*a+a]&&(a=2);var o=(a+1)%3,i=(a+2)%3;n=Math.sqrt(e[3*a+a]-e[3*o+o]-e[3*i+i]+1),t[a]=.5*n,n=.5/n,t[3]=(e[3*o+i]-e[3*i+o])*n,t[o]=(e[3*o+a]+e[3*a+o])*n,t[i]=(e[3*i+a]+e[3*a+i])*n}return t}function Pc(t,e,n,r){var a=.5*Math.PI/180;e*=a,n*=a,r*=a;var o=Math.sin(e),i=Math.cos(e),c=Math.sin(n),u=Math.cos(n),s=Math.sin(r),l=Math.cos(r);return t[0]=o*u*l-i*c*s,t[1]=i*c*l+o*u*s,t[2]=i*u*s-o*c*l,t[3]=i*u*l+o*c*s,t}function Fc(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var qc=Ri,Nc=Ui,Xc=Li,Bc=Ii,Vc=Pi,Wc=Oc,Yc=Hi,Hc=nc,Gc=ac,Kc=Qi,Jc=Kc,Qc=Zi,Zc=Qc,$c=ec,tu=lc,eu=fc,nu=function(){var t=Fo(),e=Xo(1,0,0),n=Xo(0,1,0);return function(r,a,o){var i=ui(a,o);return i<-.999999?(si(t,e,a),Si(t)<1e-6&&si(t,n,a),ci(t,t),yc(r,t,Math.PI),r):i>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(si(t,a,o),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=1+i,$c(r,r))}}(),ru=function(){var t=gc(),e=gc();return function(n,r,a,o,i,c){return Dc(t,r,i,c),Dc(e,a,o,c),Dc(n,t,e,2*c*(1-c)),n}}(),au=function(){var t=ha();return function(e,n,r,a){return t[0]=r[0],t[3]=r[1],t[6]=r[2],t[1]=a[0],t[4]=a[1],t[7]=a[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],$c(e,Ic(e,t))}}();function ou(){var t=new fa(2);return fa!=Float32Array&&(t[0]=0,t[1]=0),t}function iu(t){var e=new fa(2);return e[0]=t[0],e[1]=t[1],e}function cu(t,e){var n=new fa(2);return n[0]=t,n[1]=e,n}function uu(t,e){return t[0]=e[0],t[1]=e[1],t}function su(t,e,n){return t[0]=e,t[1]=n,t}function lu(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function fu(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function du(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function hu(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function _u(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function pu(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function mu(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t}function vu(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t}function bu(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function xu(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function gu(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t}function wu(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.hypot(n,r)}function yu(t,e){var n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r}function Mu(t){var e=t[0],n=t[1];return Math.hypot(e,n)}function ju(t){var e=t[0],n=t[1];return e*e+n*n}function Ou(t,e){return t[0]=-e[0],t[1]=-e[1],t}function Eu(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function ku(t,e){var n=e[0],r=e[1],a=n*n+r*r;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t}function Tu(t,e){return t[0]*e[0]+t[1]*e[1]}function zu(t,e,n){var r=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=r,t}function Su(t,e,n,r){var a=e[0],o=e[1];return t[0]=a+r*(n[0]-a),t[1]=o+r*(n[1]-o),t}function Au(t,e){e=e||1;var n=2*da()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t}function Cu(t,e,n){var r=e[0],a=e[1];return t[0]=n[0]*r+n[2]*a,t[1]=n[1]*r+n[3]*a,t}function Du(t,e,n){var r=e[0],a=e[1];return t[0]=n[0]*r+n[2]*a+n[4],t[1]=n[1]*r+n[3]*a+n[5],t}function Ru(t,e,n){var r=e[0],a=e[1];return t[0]=n[0]*r+n[3]*a+n[6],t[1]=n[1]*r+n[4]*a+n[7],t}function Uu(t,e,n){var r=e[0],a=e[1];return t[0]=n[0]*r+n[4]*a+n[12],t[1]=n[1]*r+n[5]*a+n[13],t}function Lu(t,e,n,r){var a=e[0]-n[0],o=e[1]-n[1],i=Math.sin(r),c=Math.cos(r);return t[0]=a*c-o*i+n[0],t[1]=a*i+o*c+n[1],t}function Iu(t,e){var n=t[0],r=t[1],a=e[0],o=e[1],i=Math.sqrt(n*n+r*r)*Math.sqrt(a*a+o*o),c=i&&(n*a+r*o)/i;return Math.acos(Math.min(Math.max(c,-1),1))}function Pu(t){return t[0]=0,t[1]=0,t}function Fu(t){return"vec2("+t[0]+", "+t[1]+")"}function qu(t,e){return t[0]===e[0]&&t[1]===e[1]}function Nu(t,e){var n=t[0],r=t[1],a=e[0],o=e[1];return Math.abs(n-a)<=1e-6*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-o)<=1e-6*Math.max(1,Math.abs(r),Math.abs(o))}var Xu=Mu,Bu=fu,Vu=du,Wu=hu,Yu=wu,Hu=yu,Gu=ju,Ku=function(){var t=ou();return function(e,n,r,a,o,i){var c,u;for(n||(n=2),r||(r=0),u=a?Math.min(a*n+r,e.length):e.length,c=r;c<u;c+=n)t[0]=e[c],t[1]=e[c+1],o(t,t,i),e[c]=t[0],e[c+1]=t[1];return e}}(),Ju=function(t,e,n){var r=this;this.program=Qu(t,e,n);var a=/uniform[^;]+[ ](\w+);/g,o=/uniform[^;]+[ ](\w+);/;this.uniforms={};var i=e.match(a),c=n.match(a);for(var u in i&&i.forEach((function(t){var e=t.match(o);r.uniforms[e[1]]=-1})),c&&c.forEach((function(t){var e=t.match(o);r.uniforms[e[1]]=-1})),this.uniforms)this.uniforms[u]=t.getUniformLocation(this.program,u)};Ju.prototype.use=function(t){t.useProgram(this.program)};var Qu=function(t,e,n){var r=t.createShader(t.VERTEX_SHADER);if(t.shaderSource(r,e),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))return alert("Vertex shader failed to compile, see console for log"),console.log(t.getShaderInfoLog(r)),null;var a=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(a,n),t.compileShader(a),!t.getShaderParameter(a,t.COMPILE_STATUS))return alert("Fragment shader failed to compile, see console for log"),console.log(t.getShaderInfoLog(a)),null;var o=t.createProgram();return t.attachShader(o,r),t.attachShader(o,a),t.linkProgram(o),t.getProgramParameter(o,t.LINK_STATUS)?o:(alert("Shader failed to link, see console for log"),console.log(t.getProgramInfoLog(o)),null)},Zu=function(t,e,n,r,a){var o=u.set(u.create(),t[0],t[1],t[2]),s=u.set(u.create(),e[0],e[1],e[2]),f=u.set(u.create(),n[0],n[1],n[2]);u.normalize(f,f);var d=u.sub(u.create(),s,o),h=u.len(d);u.normalize(d,d);var _=u.cross(u.create(),d,f);u.normalize(_,_);var p=u.cross(u.create(),_,d);u.normalize(p,p),u.cross(_,d,p),u.normalize(_,_),this.zoomSpeed=r,this.invScreen=[1/a[0],1/a[1]],this.centerTranslation=c.fromTranslation(c.create(),e),c.invert(this.centerTranslation,this.centerTranslation);var m=u.set(u.create(),0,0,-1*h);this.translation=c.fromTranslation(c.create(),m);var v=i.fromValues(_[0],_[1],_[2],p[0],p[1],p[2],-d[0],-d[1],-d[2]);i.transpose(v,v),this.rotation=l.fromMat3(l.create(),v),l.normalize(this.rotation,this.rotation),this.camera=c.create(),this.invCamera=c.create(),this.updateCameraMatrix()};Zu.prototype.rotate=function(t,e){var n=f.set(f.create(),ts(2*t[0]*this.invScreen[0]-1,-1,1),ts(1-2*t[1]*this.invScreen[1],-1,1)),r=f.set(f.create(),ts(2*e[0]*this.invScreen[0]-1,-1,1),ts(1-2*e[1]*this.invScreen[1],-1,1)),a=$u(n),o=$u(r);this.rotation=l.mul(this.rotation,a,this.rotation),this.rotation=l.mul(this.rotation,o,this.rotation),this.updateCameraMatrix()},Zu.prototype.zoom=function(t){var e=u.set(u.create(),0,0,t*this.invScreen[1]*this.zoomSpeed),n=c.fromTranslation(c.create(),e);this.translation=c.mul(this.translation,n,this.translation),this.translation[14]>=-.2&&(this.translation[14]=-.2),this.updateCameraMatrix()},Zu.prototype.pan=function(t){var e=s.set(s.create(),t[0]*this.invScreen[0]*Math.abs(this.translation[14]),t[1]*this.invScreen[1]*Math.abs(this.translation[14]),0,0),n=s.transformMat4(s.create(),e,this.invCamera),r=c.fromTranslation(c.create(),n);this.centerTranslation=c.mul(this.centerTranslation,r,this.centerTranslation),this.updateCameraMatrix()},Zu.prototype.updateCameraMatrix=function(){var t=c.fromQuat(c.create(),this.rotation);this.camera=c.mul(this.camera,t,this.centerTranslation),this.camera=c.mul(this.camera,this.translation,this.camera),this.invCamera=c.invert(this.invCamera,this.camera)},Zu.prototype.eyePos=function(){return[this.invCamera[12],this.invCamera[13],this.invCamera[14]]},Zu.prototype.eyeDir=function(){var t=s.set(s.create(),0,0,-1,0);return t=s.transformMat4(t,t,this.invCamera),[(t=s.normalize(t,t))[0],t[1],t[2]]},Zu.prototype.upDir=function(){var t=s.set(s.create(),0,1,0,0);return t=s.transformMat4(t,t,this.invCamera),[(t=s.normalize(t,t))[0],t[1],t[2]]};var $u=function(t){var e=f.dot(t,t);if(e<=1)return l.set(l.create(),t[0],t[1],Math.sqrt(1-e),0);var n=f.normalize(f.create(),t);return l.set(l.create(),n[0],n[1],0,0)},ts=function(t,e,n){return t<e?e:t>n?n:t},es=function(t,e){var n=[e[0]-t[0],e[1]-t[1]];return Math.sqrt(Math.pow(n[0],2)+Math.pow(n[1],2))},ns=function(t,e){this.len=0,this.capacity=t,"uint8"==e?this.buffer=new Uint8Array(t):"int8"==e?this.buffer=new Int8Array(t):"uint16"==e?this.buffer=new Uint16Array(t):"int16"==e?this.buffer=new Int16Array(t):"uint32"==e?this.buffer=new Uint32Array(t):"int32"==e?this.buffer=new Int32Array(t):"float32"==e?this.buffer=new Float32Array(t):"float64"==e?this.buffer=new Float64Array(t):console.log("ERROR: unsupported type "+e)};ns.prototype.append=function(t){if(this.len+t.length>=this.capacity){var e=Math.floor(1.5*this.capacity),n=new this.buffer.constructor(e);n.set(this.buffer),this.capacity=e,this.buffer=n}this.buffer.set(t,this.len),this.len+=t.length},ns.prototype.clear=function(){this.len=0},ns.prototype.stride=function(){return this.buffer.BYTES_PER_ELEMENT},ns.prototype.view=function(t,e){return new this.buffer.constructor(this.buffer.buffer,t,e)};var rs=function(t){this.camera=t,this.mousemove=null,this.press=null,this.wheel=null,this.twoFingerDrag=null,this.pinch=null};rs.prototype.registerForCanvas=function(t){var e=null,n=this;t.addEventListener("mousemove",(function(r){r.preventDefault();var a=t.getBoundingClientRect(),o=[r.clientX-a.left,r.clientY-a.top];e?n.mousemove&&n.mousemove(e,o,r):e=[r.clientX-a.left,r.clientY-a.top],e=o})),t.addEventListener("mousedown",(function(e){e.preventDefault();var r=t.getBoundingClientRect(),a=[e.clientX-r.left,e.clientY-r.top];n.press&&n.press(a,e)})),t.addEventListener("wheel",(function(t){t.preventDefault(),n.wheel&&n.wheel(-t.deltaY)})),t.oncontextmenu=function(t){t.preventDefault()};var r={};t.addEventListener("touchstart",(function(e){var a=t.getBoundingClientRect();e.preventDefault();for(var o=0;o<e.changedTouches.length;++o){var i=e.changedTouches[o];r[i.identifier]=[i.clientX-a.left,i.clientY-a.top],1==e.changedTouches.length&&n.press&&n.press(r[i.identifier],e)}})),t.addEventListener("touchmove",(function(e){e.preventDefault();var a=t.getBoundingClientRect();if(1==Object.keys(r).length){if(n.mousemove){var o=e.changedTouches[0],i=r[o.identifier],c=[o.clientX-a.left,o.clientY-a.top];e.buttons=1,n.mousemove(i,c,e)}}else{for(var u={},s=0;s<e.changedTouches.length;++s){u[(o=e.changedTouches[s]).identifier]=[o.clientX-a.left,o.clientY-a.top]}var l=[];for(o in r)o in u||(u[o]=r[o]),l.push(r[o]);var d=[];for(o in u)d.push(u[o]);var h=[f.set(f.create(),d[0][0]-l[0][0],d[0][1]-l[0][1]),f.set(f.create(),d[1][0]-l[1][0],d[1][1]-l[1][1])],_=[f.create(),f.create()];f.normalize(_[0],h[0]),f.normalize(_[1],h[1]);var p=f.set(f.create(),l[1][0]-l[0][0],l[1][1]-l[0][1]);f.normalize(p,p);var m=f.lerp(f.create(),h[0],h[1],.5);f.normalize(m,m);var v=[f.dot(p,_[0]),f.dot(p,_[1])],b=[f.dot(m,_[0]),f.dot(m,_[1])];if(n.pinch&&Math.abs(v[0])>.5&&Math.abs(v[1])>.5&&Math.sign(v[0])!=Math.sign(v[1])){var x=es(l[0],l[1]),g=es(d[0],d[1]);n.pinch(g-x)}else if(n.twoFingerDrag&&Math.abs(b[0])>.5&&Math.abs(b[1])>.5&&Math.sign(b[0])==Math.sign(b[1])){var w=f.lerp(f.create(),h[0],h[1],.5);w[1]=-w[1],n.twoFingerDrag(w)}}for(s=0;s<e.changedTouches.length;++s){o=e.changedTouches[s];r[o.identifier]=[o.clientX-a.left,o.clientY-a.top]}}));var a=function(t){t.preventDefault();for(var e=0;e<t.changedTouches.length;++e){var n=t.changedTouches[e];delete r[n.identifier]}};t.addEventListener("touchcancel",a),t.addEventListener("touchend",a)};var as=[1,1,0,0,1,0,1,1,1,0,1,1,0,0,1,0,1,0,0,0,0,1,1,0,1,0,0,1,1,1,1,0,1,0,0,1,1,0,0,0,0,0],os=Object(v.b)((function(t){return{shape_x:r.get_shape_x(t),shape_y:r.get_shape_y(t),shape_z:r.get_shape_z(t),scale_x:r.get_scale_x(t),scale_y:r.get_scale_y(t),scale_z:r.get_scale_z(t),height:r.get_shape_y(t)*r.get_scale_y(t)+r.get_shape_z(t)*r.get_scale_z(t),width:r.get_shape_x(t)*r.get_scale_x(t)+r.get_shape_z(t)*r.get_scale_z(t),data_url:r.get_vol_url(t),x:r.get_x(t),y:r.get_y(t),z:r.get_z(t),LUT:r.get_LUT(t)}})),is=function(t){function e(t){var n;return Object(Rr.a)(this,e),(n=Object(Lr.a)(this,Object(Ir.a)(e).call(this,t))).state=void 0,n.abort_controller=void 0,n.canvas=null,n.gl=null,n.shader=null,n.volumeTexture=null,n.proj=c.create(),n.camera=new Zu(u.create(),u.create(),u.create(),2,[500,500]),n.projView=c.create(),n.targetFrameTime=50,n.samplingRate=1,n.WIDTH=640,n.HEIGHT=480,n.fetch_and_draw=function(){n.abort_controller.abort(),n.abort_controller=new AbortController,H(n.props.data_url,n.abort_controller.signal).then((function(t){return n.setState({data:t})})).then(n.draw_to_canvas)},n.draw_to_canvas=function(){if(null!==n.state.data&&void 0!==n.state.data&&0!==n.props.width&&0!==n.props.height&&null!==n.gl&&null!==n.camera){var t,e,r=n.gl,a=[n.props.shape_x,n.props.shape_y,n.props.shape_z],o=(t=n.state.data,e=n.props.LUT,t.map((function(t){return pt(t,e.green)}))),i=r.createTexture();r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_3D,i),r.texStorage3D(r.TEXTURE_3D,1,r.R8,a[0],a[1],a[2]),r.texParameteri(r.TEXTURE_3D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_3D,r.TEXTURE_WRAP_R,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_3D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_3D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texSubImage3D(r.TEXTURE_3D,0,0,0,0,a[0],a[1],a[2],r.RED,r.UNSIGNED_BYTE,o);var u=Math.max(a[0],Math.max(a[1],a[2])),s=[a[0]/u*n.props.scale_x,a[1]/u*n.props.scale_y,a[2]/u*n.props.scale_z];r.uniform3iv(n.shader.uniforms.volume_dims,a),r.uniform3fv(n.shader.uniforms.volume_scale,s),n.volumeTexture?(r.deleteTexture(n.volumeTexture),n.volumeTexture=i):(n.volumeTexture=i,setInterval((function(){if(!document.hidden){var t=new Date;r.clearColor(0,0,0,1),r.clear(r.COLOR_BUFFER_BIT),n.projView=c.mul(n.projView,n.proj,n.camera.camera),r.uniformMatrix4fv(n.shader.uniforms.proj_view,!1,n.projView);var e=[n.camera.invCamera[12],n.camera.invCamera[13],n.camera.invCamera[14]];r.uniform3fv(n.shader.uniforms.eye_pos,e),r.drawArrays(r.TRIANGLE_STRIP,0,as.length/3),r.finish();var a=((new Date).getTime()-t.getTime())/n.targetFrameTime;n.samplingRate<a&&(n.samplingRate=.8*n.samplingRate+.2*a,r.uniform1f(n.shader.uniforms.dt_scale,n.samplingRate))}}),n.targetFrameTime))}},n.abort_controller=new AbortController,n.state={data:null},n.WIDTH=t.width,n.HEIGHT=t.height,n.proj=c.perspective(c.create(),60*Math.PI/180,n.WIDTH/n.HEIGHT,.1,100),n.camera=new Zu(e.defaultEye,e.center,e.up,2,[n.WIDTH,n.HEIGHT]),n}return Object(Fr.a)(e,t),Object(Ur.a)(e,[{key:"componentDidMount",value:function(){this.canvas=this.refs.canvas,this.gl=this.canvas.getContext("webgl2");var t=this.gl,e=new rs(this.camera);e.mousemove=function(t,e,n){1===n.buttons?this.camera.rotate(t,e):2===n.buttons&&this.camera.pan([e[0]-t[0],t[1]-e[1]])},e.wheel=function(t){this.camera.zoom(t)},e.pinch=e.wheel,e.twoFingerDrag=function(t){this.camera.pan(t)},e.registerForCanvas(this.canvas);var n=t.createVertexArray();t.bindVertexArray(n);var r=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,new Float32Array(as),t.STATIC_DRAW),t.enableVertexAttribArray(0),t.vertexAttribPointer(0,3,t.FLOAT,!1,0,0),this.shader=new Ju(t,"#version 300 es\n#line 4\nlayout(location=0) in vec3 pos;\nuniform mat4 proj_view;\nuniform vec3 eye_pos;\nuniform vec3 volume_scale;\n\nout vec3 vray_dir;\nflat out vec3 transformed_eye;\n\nvoid main(void) {\n\t// TODO: For non-uniform size volumes we need to transform them differently as well\n\t// to center them properly\n\tvec3 volume_translation = vec3(0.5) - volume_scale * 0.5;\n\tgl_Position = proj_view * vec4(pos * volume_scale + volume_translation, 1);\n\ttransformed_eye = (eye_pos - volume_translation) / volume_scale;\n\tvray_dir = pos - transformed_eye;\n}","#version 300 es\n#line 24\nprecision highp int;\nprecision highp float;\nuniform highp sampler3D volume;\nuniform highp sampler2D colormap;\nuniform ivec3 volume_dims;\nuniform float dt_scale;\n\nin vec3 vray_dir;\nflat in vec3 transformed_eye;\nout vec4 color;\n\nvec2 intersect_box(vec3 orig, vec3 dir) {\n\tconst vec3 box_min = vec3(0);\n\tconst vec3 box_max = vec3(1);\n\tvec3 inv_dir = 1.0 / dir;\n\tvec3 tmin_tmp = (box_min - orig) * inv_dir;\n\tvec3 tmax_tmp = (box_max - orig) * inv_dir;\n\tvec3 tmin = min(tmin_tmp, tmax_tmp);\n\tvec3 tmax = max(tmin_tmp, tmax_tmp);\n\tfloat t0 = max(tmin.x, max(tmin.y, tmin.z));\n\tfloat t1 = min(tmax.x, min(tmax.y, tmax.z));\n\treturn vec2(t0, t1);\n}\n\n// Pseudo-random number gen from\n// http://www.reedbeta.com/blog/quick-and-easy-gpu-random-numbers-in-d3d11/\n// with some tweaks for the range of values\nfloat wang_hash(int seed) {\n\tseed = (seed ^ 61) ^ (seed >> 16);\n\tseed *= 9;\n\tseed = seed ^ (seed >> 4);\n\tseed *= 0x27d4eb2d;\n\tseed = seed ^ (seed >> 15);\n\treturn float(seed % 2147483647) / float(2147483647);\n}\n\nfloat linear_to_srgb(float x) {\n\tif (x <= 0.0031308f) {\n\t\treturn 12.92f * x;\n\t}\n\treturn 1.055f * pow(x, 1.f / 2.4f) - 0.055f;\n}\n\nvoid main(void) {\n\tvec3 ray_dir = normalize(vray_dir);\n\tvec2 t_hit = intersect_box(transformed_eye, ray_dir);\n\tif (t_hit.x > t_hit.y) {\n\t\tdiscard;\n\t}\n\tt_hit.x = max(t_hit.x, 0.0);\n\tvec3 dt_vec = 1.0 / (vec3(volume_dims) * abs(ray_dir));\n\tfloat dt = dt_scale * min(dt_vec.x, min(dt_vec.y, dt_vec.z));\n\tfloat offset = wang_hash(int(gl_FragCoord.x + 640.0 * gl_FragCoord.y));\n\tvec3 p = transformed_eye + (t_hit.x + offset * dt) * ray_dir;\n\tfor (float t = t_hit.x; t < t_hit.y; t += dt) {\n\t\tfloat val = texture(volume, p).r;\n\t\tvec4 val_color = vec4(texture(colormap, vec2(val, 0.5)).rgb, val);\n\t\t// Opacity correction\n\t\tval_color.a = 1.0 - pow(1.0 - val_color.a, dt_scale);\n\t\tcolor.rgb += (1.0 - color.a) * val_color.a * val_color.rgb;\n\t\tcolor.a += (1.0 - color.a) * val_color.a;\n\t\tif (color.a >= 0.95) {\n\t\t\tbreak;\n\t\t}\n\t\tp += ray_dir * dt;\n\t}\n    color.r = linear_to_srgb(color.r);\n    color.g = linear_to_srgb(color.g);\n    color.b = linear_to_srgb(color.b);\n}"),this.shader.use(t),t.uniform1i(this.shader.uniforms.volume,0),t.uniform1i(this.shader.uniforms.colormap,1),t.uniform1f(this.shader.uniforms.dt_scale,this.samplingRate),t.enable(t.CULL_FACE),t.cullFace(t.FRONT),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA);var a=new Image;a.onload=function(t,e){return function(){var n=t.createTexture();t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,n),t.texStorage2D(t.TEXTURE_2D,1,t.SRGB8_ALPHA8,180,1),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_R,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,180,1,t.RGBA,t.UNSIGNED_BYTE,a),e()}}(t,this.draw_to_canvas),a.src="webgl_colormaps/samsel-linear-green.png",this.fetch_and_draw()}},{key:"componentDidUpdate",value:function(t){this.props.data_url!==t.data_url?this.fetch_and_draw():this.props.LUT!==t.LUT&&this.draw_to_canvas()}},{key:"render",value:function(){return _.a.createElement("div",{style:{position:"relative",left:this.props.left,top:this.props.top,right:"0px"}},_.a.createElement("canvas",{ref:"canvas",width:this.props.width,height:this.props.height,style:{position:"absolute",left:"0px",top:"0px",zIndex:1}}))}}]),e}(h.Component);is.defaultEye=u.set(u.create(),.5,.5,1.5),is.center=u.set(u.create(),.5,.5,.5),is.up=u.set(u.create(),0,1,0);var cs=os(is),us=function(t){return _.a.createElement(Xr.a,{style:{position:"absolute",left:t.left,top:t.top,width:"horizontal"===t.orientation?t.length:0,height:"vertical"===t.orientation?t.length:0},color:"primary",orientation:t.orientation,defaultValue:.5,value:t.flip?1-t.val:t.val,min:0,max:1,step:1e-4,track:!1,scale:t.flip?function(t){return 1-t}:function(t){return t},onChange:function(e,n){return t.handler(t.flip?1-n:n)}})},ss=function(t){return _.a.createElement(Xr.a,{style:{position:"absolute",left:t.left,top:t.top,width:t.length},color:"secondary",orientation:"horizontal",defaultValue:0,value:t.val,min:0,max:t.max_val,track:!1,step:1,onChange:function(e,n){return t.handler(n)}})},ls=function(t){var e=_.a.useState([0,255]),n=Object(Je.a)(e,2),r=n[0],a=n[1];return _.a.createElement(Xr.a,{style:{position:"absolute",left:t.left,top:t.top,width:t.length,color:t.color},value:r,min:0,max:255,onChange:function(e,n){a(n),t.handler(n)},valueLabelDisplay:"auto"})},fs=Object(v.b)((function(t){return{window_state:mt(t),annotations_z:o.get_z_annotations(t),annotations_3D:o.get_annotations_view3D(t),size_x:yt(t)*kt(t),size_y:Mt(t)*Tt(t),size_z:jt(t)*zt(t),x:vt(t),y:bt(t),z:xt(t),t_idx:wt(t),shape_t:Ot(t),LUT:St(t),view:Xt(t)}}),(function(t){return{actions:Object(Qe.bindActionCreators)(Object(R.a)({},S),t),saga_actions:Object(Qe.bindActionCreators)(Object(R.a)({},sr),t),delete_annotation:function(){return t(Re.delete_annotation())}}}))((function(t){var e,n=20+t.size_x+10,r=20+t.size_y+10,a=r+t.size_z,o=n+t.size_z+20,i=n,c=a,u=o,s=20+r-20,l=a+20,f=t.size_x+t.size_z+10,d=o+50,h=f/3-20,p=l+50,m=20+h+50,v=m+h+50,b=p+50,x=d;e="vol"===t.view?_.a.createElement(cs,{left:20,top:20}):_.a.createElement(_.a.Fragment,null,_.a.createElement(Jr,{left:20,top:20}),_.a.createElement(Gr,{left:n,top:20}),_.a.createElement(Kr,{left:20,top:r}));var g=_.a.createElement(us,{left:20,top:a,length:t.size_x,orientation:"horizontal",flip:!1,val:t.x,handler:t.actions.set_x}),w=_.a.createElement(us,{left:o,top:20,length:t.size_y,orientation:"vertical",flip:!0,val:t.y,handler:t.actions.set_y}),y=_.a.createElement(us,{left:i,top:c,length:t.size_z,orientation:"horizontal",flip:!1,val:t.z,handler:t.actions.set_z}),M=_.a.createElement(us,{left:u,top:s,length:t.size_z,orientation:"vertical",flip:!0,val:t.z,handler:t.actions.set_z}),j=_.a.createElement(ss,{left:20,top:l,length:f,val:t.t_idx,max_val:t.shape_t-1,handler:t.actions.set_t_idx}),O=_.a.createElement(ls,{left:20,top:p,length:h,val:t.LUT.red,color:"red",handler:function(e){var n=Object(Je.a)(e,2),r=n[0],a=n[1];return t.actions.set_LUT_color(["red",r,a])}}),E=_.a.createElement(ls,{left:m,top:p,length:h,val:t.LUT.green,color:"green",handler:function(e){var n=Object(Je.a)(e,2),r=n[0],a=n[1];return t.actions.set_LUT_color(["green",r,a])}}),k=_.a.createElement(ls,{left:v,top:p,length:h,val:t.LUT.blue,color:"blue",handler:function(e){var n=Object(Je.a)(e,2),r=n[0],a=n[1];return t.actions.set_LUT_color(["blue",r,a])}});return _.a.createElement("div",{style:{position:"absolute"}},_.a.createElement("div",{tabIndex:0,onKeyDown:function(e){var n=String.fromCharCode(e.which),r=e.ctrlKey,a=e.shiftKey;switch(n){case"F":a?t.saga_actions.adjust_t(10):t.saga_actions.adjust_t(1);break;case"D":a?t.saga_actions.adjust_t(-10):t.saga_actions.adjust_t(-1);break;case"V":a?t.actions.set_z(t.z+.2):r?t.actions.set_z(t.z+.02):t.actions.set_z(t.z+.05);break;case"C":a?t.actions.set_z(t.z-.2):r?t.actions.set_z(t.z-.01):t.actions.set_z(t.z-.05);break;case"R":t.actions.adjust_c_idx(1);break;case"E":t.actions.adjust_c_idx(-1);break;case".":t.delete_annotation();break;case"S":r&&t.saga_actions.save();break;case"O":t.actions.toggle_fill_circles();break;case"A":t.actions.toggle_all_annotations();break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"0":r||a||t.saga_actions.rpc_from_key(n)}e.preventDefault()},onKeyUp:function(t){}},e,g,w,y,M,j,O,E,k),_.a.createElement(cn,{left:d,top:20}),_.a.createElement(la,{left:20,top:b}),_.a.createElement(Fn,{left:x,top:350}))})),ds=function(){return _.a.createElement("div",null,_.a.createElement(fs,null))},hs=n(100),_s=n.n(hs),ps={annotation_window:S,annotations:lt,worldlines:ln},ms=Object(Qe.combineReducers)({annotation_window:A,annotations:ft,worldlines:fn}),vs=D.a.mark(bs);function bs(){return D.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(U.a)([].concat(Object(d.a)(Cr),Object(d.a)(He),Object(d.a)(Rn)).map((function(t){return t()})));case 2:case"end":return t.stop()}}),vs)}var xs={annotation_window:sr,annotations:Re,worldlines:Mn},gs=Object(v.b)((function(t){return{state:t,x_idx:Ft(t)}}),Object(R.a)({},ps.annotation_window,{},ps.annotations,{},xs.annotation_window,{},xs.annotations))((function(t){var e=t.state,n=t.x_idx,r=Object(Dr.a)(t,["state","x_idx"]),a={bare_state:e,derived_state:{x_idx:n}};return _.a.createElement("div",null,_.a.createElement(_s.a,{theme:"monokai",src:a}),_.a.createElement("br",null),"Simple Actions:",_.a.createElement(Nr,{name:"set_shape_x",action:r.set_shape_x}),_.a.createElement(Nr,{name:"set_x",action:r.set_x}),_.a.createElement(Nr,{name:"set_t_idx",action:r.set_t_idx}),_.a.createElement(Nr,{name:"adjust_x",action:r.adjust_x}),_.a.createElement(Nr,{name:"set_scale_x",action:r.set_scale_x}),_.a.createElement("br",null),"Async Actions:",_.a.createElement("br",null),_.a.createElement("button",{onClick:function(){return r.fetch_state()}},"fetch_state"),_.a.createElement("button",{onClick:function(){return r.insert_annotation_here()}},"insert_annotation"),_.a.createElement(Nr,{name:"fetch_annotations",action:r.get_annotations}))}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var ws=Object(w.a)(),ys=[].concat(Object(d.a)(Object(g.d)({thunk:!1})),[ws]),Ms=Object(g.a)({reducer:ms,middleware:ys});ws.run(bs);var js=Object(y.a)({palette:{type:"dark",primary:j.a,secondary:O.a},typography:{fontFamily:["source-code-pro","-apple-system","BlinkMacSystemFont",'"Segoe UI"',"Roboto",'"Helvetica Neue"',"Arial","sans-serif",'"Apple Color Emoji"','"Segoe UI Emoji"','"Segoe UI Symbol"'].join(",")}});m.a.render(_.a.createElement(v.a,{store:Ms},_.a.createElement(M.a,{theme:js},_.a.createElement(b.a,null,_.a.createElement(x.c,null,_.a.createElement(x.a,{exact:!0,path:"/",component:ds}),_.a.createElement(x.a,{path:"/AppTest",component:gs}))))),document.getElementById("root")),Ms.dispatch(xs.annotation_window.fetch_state()),Ms.dispatch(xs.worldlines.get_worldlines()),Ms.dispatch(xs.annotations.get_annotations()),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))}},[[118,1,2]]]);
//# sourceMappingURL=main.43fa28ce.chunk.js.map